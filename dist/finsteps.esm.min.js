var C=class{extractIdFromPatterns(t,e){for(let s of e){let n=t.match(s);if(n&&n[1])return n[1]}return null}getElementClassName(t){return typeof t.className=="string"?t.className:t.className.baseVal}hasTargetableClass(t){let e=this.getElementClassName(t);return this.getTargetableClasses().some(n=>e.includes(n))}escapeSelector(t){return typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(t):t.replace(/[^a-zA-Z0-9_-]/g,"\\$&")}};var K=class extends C{getDiagramType(){return"flowchart"}getTargetableClasses(){return["node"]}getTargetableTags(){return["g"]}extractNodeIds(t){let e=new Map,s=[/^[a-zA-Z0-9-]+-([A-Za-z0-9_]+)-\d+$/,/^[a-zA-Z0-9-]+-\d+-([A-Za-z0-9_]+)$/,/^node-([A-Za-z0-9_]+)$/,/^flowchart-([A-Za-z0-9_]+)-/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&c.includes("node")){l=a;break}}a=a.parentElement}l?e.set(i,l):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.node[data-id="${e}"]`,`g[class*="node"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n;try{let c=t.getBBox(),p=t.getAttribute("transform");if(p&&p.includes("translate")){let u=p.match(/translate\s*\(\s*([-\d.]+)\s*[, ]\s*([-\d.]+)\s*\)/);if(u){let d=parseFloat(u[1]),m=parseFloat(u[2]);n=new DOMRect(c.x+d,c.y+m,c.width,c.height)}else n=c}else n=c}catch{return[]}let o=n.x+n.width/2,i=n.y+n.height/2,a=Array.from(e.querySelectorAll('path.edge, path[class*="edge"], g.edge path, path[id*="edge"]')),l=new Set;for(let c of a)try{let p=c.getBBox(),u=p.x+p.width/2,d=p.y+p.height/2,m=Math.max(n.width,n.height)*1.5,f=Math.sqrt(Math.pow(u-o,2)+Math.pow(d-i,2)),D=p.x<n.x+n.width&&p.x+p.width>n.x&&p.y<n.y+n.height&&p.y+p.height>n.y,k=c.getAttribute("d"),w=!1;if(k){let h=k.match(/[ML]\s*([-\d.]+)\s+([-\d.]+)/g);if(h)for(let b of h){let y=b.match(/[ML]\s*([-\d.]+)\s+([-\d.]+)/);if(y){let E=parseFloat(y[1]),T=parseFloat(y[2]);if(Math.sqrt(Math.pow(E-o,2)+Math.pow(T-i,2))<m){w=!0;break}}}}if(D||w||f<m){let h=Array.from(e.querySelectorAll("g.node[data-id]"));for(let b of h)if(b!==t&&!l.has(b))try{let y=b.getBBox(),E=b.getAttribute("transform"),T=y;if(E&&E.includes("translate")){let N=E.match(/translate\s*\(\s*([-\d.]+)\s*[, ]\s*([-\d.]+)\s*\)/);if(N){let g=parseFloat(N[1]),v=parseFloat(N[2]);T=new DOMRect(y.x+g,y.y+v,y.width,y.height)}}let M=T.x+T.width/2,V=T.y+T.height/2,A=Math.sqrt(Math.pow(M-u,2)+Math.pow(V-d,2));(T.x<p.x+p.width&&T.x+T.width>p.x&&T.y<p.y+p.height&&T.y+T.height>p.y||A<m)&&l.add(b)}catch{continue}}}catch{continue}return Array.from(l)}};var De={linear:r=>r,ease:r=>r<.5?2*r*r:-1+(4-2*r)*r,easeIn:r=>r*r,easeOut:r=>r*(2-r),easeInOut:r=>r<.5?2*r*r:-1+(4-2*r)*r,cubicIn:r=>r*r*r,cubicOut:r=>--r*r*r+1,cubicInOut:r=>r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1,quadIn:r=>r*r,quadOut:r=>r*(2-r),quadInOut:r=>r<.5?2*r*r:-1+(4-2*r)*r,quartIn:r=>r*r*r*r,quartOut:r=>1- --r*r*r*r,quartInOut:r=>r<.5?8*r*r*r*r:1-8*--r*r*r*r,quintIn:r=>r*r*r*r*r,quintOut:r=>1+--r*r*r*r*r,quintInOut:r=>r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r,sineIn:r=>1-Math.cos(r*Math.PI/2),sineOut:r=>Math.sin(r*Math.PI/2),sineInOut:r=>-(Math.cos(Math.PI*r)-1)/2,expoIn:r=>r===0?0:Math.pow(2,10*(r-1)),expoOut:r=>r===1?1:1-Math.pow(2,-10*r),expoInOut:r=>r===0?0:r===1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2,circIn:r=>1-Math.sqrt(1-r*r),circOut:r=>Math.sqrt(1- --r*r),circInOut:r=>r<.5?(1-Math.sqrt(1-4*r*r))/2:(Math.sqrt(1-4*(r-1)*(r-1))+1)/2,backIn:r=>2.70158*r*r*r-1.70158*r*r,backOut:r=>1+2.70158*Math.pow(r-1,3)+1.70158*Math.pow(r-1,2),backInOut:r=>{let e=2.5949095;return r<.5?Math.pow(2*r,2)*((e+1)*2*r-e)/2:(Math.pow(2*r-2,2)*((e+1)*(r*2-2)+e)+2)/2}};function qe(r){return De[r]||De.easeOut}function Se(r,t){if(r instanceof SVGGraphicsElement)try{let a=r.getBBox();if(a.width>0&&a.height>0)return a}catch{}let e=r.getBoundingClientRect(),s=t.getBoundingClientRect(),n=t.viewBox.baseVal;if(!n||s.width===0||s.height===0)return new DOMRect(0,0,0,0);let o=n.width/s.width,i=n.height/s.height;return new DOMRect((e.left-s.left)*o+n.x,(e.top-s.top)*i+n.y,e.width*o,e.height*i)}var ke=r=>{let t=r.viewBox?.baseVal;return t&&t.width&&t.height?`${t.x} ${t.y} ${t.width} ${t.height}`:r.getAttribute("viewBox")};function ze(r,t,e){return r instanceof SVGGraphicsElement?e.findAdjacentElements(r,t):[]}var be=(r,t=40)=>{let e=r.getAttribute("data-initial-viewbox");if(e)return e;let s=null;for(let h of Array.from(r.children))if(h instanceof SVGGElement){s=h;break}let n=1/0,o=1/0,i=-1/0,a=-1/0;if(s)try{let h=s.getBBox();n=h.x,o=h.y,i=h.x+h.width,a=h.y+h.height}catch{}let l=i-n,c=a-o,p=ke(r),u={width:0,height:0};if(p){let h=p.split(" ").map(Number);h.length===4&&(u={width:h[2],height:h[3]})}let d={width:0,height:0};if(e){let h=e.split(" ").map(Number);h.length===4&&(d={width:h[2],height:h[3]})}if(!isFinite(n)||!isFinite(o)||!isFinite(i)||!isFinite(a)||l<10||c<10||u.width>0&&l<u.width*.1||d.width>0&&l<d.width*.5){let h=[];for(let b of Array.from(r.children))b instanceof SVGGraphicsElement&&h.push(b);h.length===0&&h.push(...Array.from(r.querySelectorAll("g, rect, circle, ellipse, line, polyline, polygon, path, text"))),n=1/0,o=1/0,i=-1/0,a=-1/0;for(let b of h)try{let y=b.getBBox();isFinite(y.x)&&isFinite(y.y)&&isFinite(y.width)&&isFinite(y.height)&&y.width>0&&y.height>0&&(n=Math.min(n,y.x),o=Math.min(o,y.y),i=Math.max(i,y.x+y.width),a=Math.max(a,y.y+y.height))}catch{continue}}let f=i-n,D=a-o,k=d.width>0&&f<d.width*.7;if(!isFinite(n)||!isFinite(o)||!isFinite(i)||!isFinite(a)||f<10||D<10||u.width>0&&f<u.width*.1||k){if(e&&d.width>0&&d.height>0)return e;if(p)return p;let h=r.getAttribute("width"),b=r.getAttribute("height");if(h&&b){let y=parseFloat(h)||1e3,E=parseFloat(b)||1e3;return`0 0 ${y} ${E}`}return null}let w={x:n-t,y:o-t,width:f+t*2,height:D+t*2};return`${w.x} ${w.y} ${w.width} ${w.height}`};function Le(r){if(!r)return null;let t=r.split(" ").map(Number);return t.length!==4||t.some(isNaN)?null:{x:t[0],y:t[1],width:t[2],height:t[3]}}function Fe(r,t,e,s,n){return new Promise(o=>{if(!t){r.setAttribute("viewBox",`${e.x} ${e.y} ${e.width} ${e.height}`),o();return}let i=performance.now(),a=l=>{let c=l-i,p=Math.min(c/s,1),u=n(p),d={x:t.x+(e.x-t.x)*u,y:t.y+(e.y-t.y)*u,width:t.width+(e.width-t.width)*u,height:t.height+(e.height-t.height)*u};r.setAttribute("viewBox",`${d.x} ${d.y} ${d.width} ${d.height}`),p<1?requestAnimationFrame(a):(r.setAttribute("viewBox",`${e.x} ${e.y} ${e.width} ${e.height}`),o())};requestAnimationFrame(a)})}var Te=r=>{let t=r.getRoot(),e=r.getContainer(),s=ke(t),n=!1,o=0,i=0,a=(d,m)=>{let f=t.viewBox?.baseVal;if(!f||!f.width||!f.height)return;let D={x:f.x,y:f.y,width:f.width,height:f.height},k=t.clientWidth||f.width,w=t.clientHeight||f.height,h=D.width/k,b=D.height/w,y=D.x-d*h,E=D.y-m*b;t.setAttribute("viewBox",`${y} ${E} ${D.width} ${D.height}`)},l=d=>{d.button===0&&(d.target?.closest("button")||d.target?.closest(".nav-btn")||d.target?.closest(".dataid-chip")||d.target?.closest("a")||(n=!0,o=d.clientX,i=d.clientY,e.style.cursor="grabbing",e.style.userSelect="none",d.preventDefault()))},c=d=>{if(!n)return;let m=d.clientX-o,f=d.clientY-i;a(m,f),o=d.clientX,i=d.clientY,d.preventDefault()},p=()=>{n&&(n=!1,e.style.cursor="grab",e.style.userSelect="")},u=()=>{n&&(n=!1,e.style.cursor="grab",e.style.userSelect="")};return e.style.cursor="grab",e.addEventListener("mousedown",l),document.addEventListener("mousemove",c),document.addEventListener("mouseup",p),e.addEventListener("mouseleave",u),{fit(d,m){if(d)try{let f=Se(d,t),D=d instanceof SVGElement?d.getAttribute("transform"):null;if(d instanceof SVGGraphicsElement&&D&&D.includes("translate"))try{let N=D.match(/translate\s*\(\s*([-\d.]+)\s*[, ]\s*([-\d.]+)\s*\)/);if(N){let g=parseFloat(N[1]),v=parseFloat(N[2]);f=new DOMRect(f.x+g,f.y+v,f.width,f.height)}}catch{}let k=m?.padding??16,w=40;f.height<w&&(f=new DOMRect(f.x,f.y-w/2,f.width||w,w)),f.width<w&&(f=new DOMRect(f.x-w/2,f.y,w,f.height||w));let h=r.getStrategy?.()||new K,b=ze(d,t,h),y=f;for(let N of b)try{let g=Se(N,t),v=Math.min(y.x,g.x),G=Math.min(y.y,g.y),I=Math.max(y.x+y.width,g.x+g.width),B=Math.max(y.y+y.height,g.y+g.height);y=new DOMRect(v,G,I-v,B-G)}catch{continue}if(f=y,!isFinite(f.width)||!isFinite(f.height)||f.width<=0||f.height<=0){let N=d.parentElement;if(N){let g=Se(N,t);if(isFinite(g.width)&&isFinite(g.height)&&g.width>0&&g.height>0){let v={x:g.x-k,y:g.y-k,width:g.width+k*2,height:g.height+k*2};t.setAttribute("viewBox",`${v.x} ${v.y} ${v.width} ${v.height}`);return}}return}let E=null;try{let N=Array.from(t.children).find(g=>g instanceof SVGGElement);N&&(E=N.getBBox())}catch{}if(E&&(f.x<E.x||f.y<E.y||f.x+f.width>E.x+E.width||f.y+f.height>E.y+E.height)){let N=Math.min(y.x,E.x),g=Math.min(y.y,E.y),v=Math.max(y.x+y.width,E.x+E.width),G=Math.max(y.y+y.height,E.y+E.height);y=new DOMRect(N,g,v-N,G-g)}let T=y,M={x:T.x-k,y:T.y-k,width:T.width+k*2,height:T.height+k*2},V=`${M.x} ${M.y} ${M.width} ${M.height}`,A=m?.duration??0,S=m?.easing??"easeOut";if(A<=0)t.setAttribute("viewBox",V);else{let N=Le(t.getAttribute("viewBox")),g=M,v=qe(S);return Fe(t,N,g,A,v)}}catch(f){console.warn("Failed to get bounding box for camera.fit:",f)}},reset(){let d=be(t);d?t.setAttribute("viewBox",d):s&&t.setAttribute("viewBox",s)},zoom(d,m){let f=t.viewBox?.baseVal;if(!f||!f.width||!f.height)return;let D={x:f.x,y:f.y,width:f.width,height:f.height},k=m??{x:D.x+D.width/2,y:D.y+D.height/2},w=D.width/d,h=D.height/d,b=k.x-w/2,y=k.y-h/2;t.setAttribute("viewBox",`${b} ${y} ${w} ${h}`)},pan(d,m){let f=t.viewBox?.baseVal;if(!f||!f.width||!f.height)return;let D={x:f.x,y:f.y,width:f.width,height:f.height},k=t.clientWidth||f.width,w=t.clientHeight||f.height,h=D.width/k,b=D.height/w,y=D.x+d*h,E=D.y+m*b;t.setAttribute("viewBox",`${y} ${E} ${D.width} ${D.height}`)},fitAll(d=40){let m=be(t,d);m&&t.setAttribute("viewBox",m)},destroy(){e.removeEventListener("mousedown",l),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",p),e.removeEventListener("mouseleave",u),e.style.cursor="",e.style.userSelect="";let d=be(t);d?t.setAttribute("viewBox",d):s&&t.setAttribute("viewBox",s)}}};var Ie=()=>{let r=document.createElement("div");r.className="finsteps-overlay",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="0",r.style.height="0",r.style.pointerEvents="none",document.body.appendChild(r);let t=new Map,e=()=>{for(let o of t.values()){let i=o.target.getBoundingClientRect(),a=o.element.getBoundingClientRect(),l=Math.max(8,i.top-a.height-8),c=Math.max(8,i.left+i.width/2-a.width/2);o.element.style.top=`${l}px`,o.element.style.left=`${c}px`}},s=()=>e(),n=()=>e();return window.addEventListener("scroll",s,!0),window.addEventListener("resize",n),{showBubble({id:o="default",target:i,text:a}){let l=t.get(o);if(!l){let c=document.createElement("div");c.className="finsteps-bubble",c.style.position="fixed",c.style.padding="8px 12px",c.style.borderRadius="8px",c.style.background="rgba(15, 23, 42, 0.95)",c.style.color="#fff",c.style.font="14px/1.4 sans-serif",c.style.maxWidth="240px",c.style.pointerEvents="none",r.appendChild(c),l={id:o,element:c,target:i},t.set(o,l)}l.target=i,l.element.textContent=a,requestAnimationFrame(e)},hideBubble(o="default"){let i=t.get(o);i&&(i.element.remove(),t.delete(o))},destroy(){window.removeEventListener("scroll",s,!0),window.removeEventListener("resize",n);for(let o of t.values())o.element.remove();t.clear(),r.remove()}}};function Ke(r,t){switch(r){case"MPF_INVALID_PRESENT_OPTIONS":return['Ensure you provide either "ast" or both "mpdText" and "options.parseMpd"',"Example: presentMermaid({ mermaidText, mpdText, mountEl, options: { parseMpd } })","See API documentation: https://github.com/cablepull/finsteps#cdn-usage-jsdelivr"];case"MPF_MERMAID_UNAVAILABLE":return["Load Mermaid.js before importing Finsteps",'Add <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js"><\/script> in your HTML',"Ensure mermaid.initialize() is called before presentMermaid()"];case"MPF_MERMAID_RENDER_FAILED":return["Check your Mermaid diagram syntax is valid","Test your diagram at https://mermaid.live/","Verify the mermaidText is a valid string and not empty"];case"MPF_OVERLAY_DESTROYED":return["Do not call overlay methods after controller.destroy()","Check that the controller is still active before showing overlays","Ensure lifecycle hooks are not accessing destroyed overlays"];case"MPF_OVERLAY_TARGET_MISSING":return[`Verify the target element exists in the diagram${t?.target?` Target: ${JSON.stringify(t.target)}`:""}`,"Check that dataId, selector, or id matches an element in the rendered SVG","Use the live editor to see available data-id values: https://cablepull.github.io/finsteps/examples/editor/"];case"MPF_ACTION_UNKNOWN":return[`Check that the action type is spelled correctly${t?.actionType?` Action: ${t.actionType}`:""}`,"Common actions: camera.fit, camera.reset, overlay.bubble, style.highlight, nav.next, nav.prev","See grammar documentation: https://cablepull.github.io/finsteps/grammar.html"];case"MPF_ACTION_INVALID_ARGS":return["Verify the action payload structure matches the expected format",'Check required fields (e.g., camera.fit requires "target" in payload)',"Review action documentation in grammar: https://cablepull.github.io/finsteps/grammar.html"];case"MPF_PARSE_ERROR":return["Use formatDiagnostics(result.diagnostics) to see detailed parse errors","Check your MPD syntax against the EBNF grammar: https://cablepull.github.io/finsteps/ebnf/mpd.ebnf","Validate MPD with parseMPD() before passing to presentMermaid()"];default:return[]}}var L=class extends Error{constructor(t,e,s){super(t),this.name="MPFError",this.code=e,this.context=s,this.suggestions=Ke(e,s)}},we=class extends L{constructor(t,e="MPF_PARSE_ERROR"){super(t,e),this.name="ParseError"}},Z=class extends L{constructor(t,e="MPF_ACTION_INVALID_ARGS",s){super(t,e,s),this.name="ActionError"}};var Ce=r=>typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(r):r.replace(/[^a-zA-Z0-9_-]/g,"\\$&"),F=(r,t)=>{if(!t)return null;if(t.element)return t.element;let e=r.getRoot(),s=null;if(t.selector)s=e.querySelector(t.selector),!s&&typeof document<"u"&&(s=document.querySelector(t.selector));else if(t.id)s=e.querySelector(`#${Ce(t.id)}`);else if(t.dataId){let o=(r.getStrategy?.()||new K).getTargetSelectors(t.dataId);for(let i of o)if(s=e.querySelector(i),s)break;!s&&e instanceof Element&&e.getAttribute("data-id")===t.dataId&&(s=e)}if(!s)return null;if(!(s instanceof SVGGraphicsElement)||s.tagName==="text"||s instanceof SVGElement&&(typeof s.className=="string"&&s.className.includes("flowchart-label")||typeof s.className!="string"&&s.className.baseVal.includes("flowchart-label"))){let n=s;for(;n;){let o=n.parentElement;if(!o||o===e)break;if(o instanceof SVGGraphicsElement){if(o.tagName==="g"){if((o instanceof SVGElement?typeof o.className=="string"?o.className:o.className.baseVal:"").includes("node")&&o!==e&&o.getAttribute("data-id")===t?.dataId)return o;let a=o.parentElement;if(a===e||a&&a.tagName==="svg"){n=o;continue}}if(o===e)break}n=o}if(n instanceof SVGGraphicsElement&&n!==e){let o=n.parentElement;if(o&&o.tagName!=="svg")return n}}if(s instanceof SVGGraphicsElement&&s.tagName!=="g"){let n=s.parentElement;if(n instanceof SVGGraphicsElement&&n.tagName==="g"&&(n instanceof SVGElement?typeof n.className=="string"?n.className:n.className.baseVal:"").includes("node")&&n.getAttribute("data-id")===t?.dataId)return n}if(s.tagName==="g"){let n=s.parentElement;if(n===e||n&&n.tagName==="svg"){let o=s.getAttribute("data-id"),i=s instanceof SVGElement?typeof s.className=="string"?s.className:s.className.baseVal:"";if(o!==t?.dataId||!i.includes("node")){let a=t?.dataId?Ce(t.dataId):"",l=e.querySelector(`g.node[data-id="${a}"], [data-id="${a}"]`);if(l&&l!==s)return l}}}return s};function Y(r){let t=r.trim(),e=t.split(`
`).map(o=>o.trim()),s=0;if(e[0]==="---"){for(let o=1;o<e.length;o++)if(e[o]==="---"){let i=o+1;for(;i<e.length&&e[i]==="";)i++;s=i;break}}let n=(e[s]||"").toLowerCase();return n.startsWith("flowchart")?"flowchart":n.startsWith("sequenceDiagram")||n.startsWith("sequencediagram")?"sequenceDiagram":n.startsWith("classDiagram")||n.startsWith("classdiagram")?"classDiagram":n.startsWith("stateDiagram-v2")||n.startsWith("statediagram-v2")?"stateDiagram-v2":n.startsWith("stateDiagram")||n.startsWith("statediagram")?"stateDiagram":n.startsWith("erDiagram")||n.startsWith("erdiagram")?"erDiagram":n.startsWith("gantt")?"gantt":n.startsWith("pie")?"pie":n.startsWith("journey")?"journey":n.startsWith("gitGraph")||n.startsWith("gitgraph")?"gitGraph":n.startsWith("timeline")?"timeline":n.startsWith("quadrantChart")||n.startsWith("quadrantchart")?"quadrantChart":n.startsWith("requirement")?"requirement":n.startsWith("C4Context")||n.startsWith("c4context")?"c4Context":n.startsWith("C4Container")||n.startsWith("c4container")?"c4Container":n.startsWith("C4Component")||n.startsWith("c4component")?"c4Component":n.startsWith("block-beta")||n.startsWith("blockBeta")||n.startsWith("blockbeta")||n.startsWith("blockDiagram")||n.startsWith("blockdiagram")?"block":n.startsWith("mindmap")?"mindmap":n.startsWith("kanban")?"kanban":n.startsWith("packet")?"packet":n.startsWith("radar")?"radar":n.startsWith("sankey")||n.startsWith("sankey-beta")||n.startsWith("sankeybeta")?"sankey":n.startsWith("treemap")||n.startsWith("treemap-beta")||n.startsWith("treemapbeta")?"treemap":n.startsWith("xychart")||n.startsWith("xychart-beta")||n.startsWith("xychartbeta")||n.startsWith("xy")?"xychart":n.startsWith("zenuml")?"zenuml":t.includes("graph")||t.includes("-->")||t.includes("---")?"flowchart":"unknown"}var ve=class{constructor(){this.strategies=new Map;this.defaultStrategy=null}register(t,e){this.strategies.set(t,e)}get(t){return this.strategies.get(t)}getOrDefault(t){let e=this.strategies.get(t);if(e)return e;if(this.defaultStrategy)return this.defaultStrategy;throw new Error(`No strategy found for diagram type: ${t} and no default strategy set`)}setDefault(t){this.defaultStrategy=t}has(t){return this.strategies.has(t)}getRegisteredTypes(){return Array.from(this.strategies.keys())}},P=new ve;var X=class extends C{getDiagramType(){return"gantt"}getTargetableClasses(){return["task","milestone","section"]}getTargetableTags(){return["g","rect","polygon"]}extractNodeIds(t){let e=new Map,s=[/^[a-zA-Z0-9-]+-([A-Za-z0-9_]+)-\d+$/,/^gantt-([A-Za-z0-9_]+)-/,/^task-([A-Za-z0-9_]+)/,/^([A-Za-z0-9_]+)$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(!i){let a=this.getElementClassName(n);a&&(a.includes("task")||a.includes("milestone"))&&!o.endsWith("-text")&&!o.endsWith("-Text")&&(i=o)}if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("task")||c.includes("milestone")||c.includes("section"))){l=a;break}}a=a.parentElement}if(l)e.set(i,l);else if(n.tagName==="g"&&this.hasTargetableClass(n))e.set(i,n);else if(n.tagName==="rect"){let c=this.getElementClassName(n);c&&(c.includes("task")||c.includes("milestone"))&&e.set(i,n)}else if(n.tagName==="polygon"){let c=this.getElementClassName(n);c&&c.includes("milestone")&&e.set(i,n)}}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.task[data-id="${e}"]`,`g.milestone[data-id="${e}"]`,`g[class*="task"][data-id="${e}"]`,`g[class*="milestone"][data-id="${e}"]`,`g[class*="section"][data-id="${e}"]`,`rect.task[data-id="${e}"]`,`rect[class*="task"][data-id="${e}"]`,`polygon.milestone[data-id="${e}"]`,`polygon[class*="milestone"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&n.includes("milestone"))return Array.from(e.querySelectorAll("[data-id]")).filter(p=>p!==t&&p instanceof SVGGraphicsElement);let i=null,a=t;for(;a&&a!==e;){if(a.tagName==="g"&&a instanceof SVGElement){let c=a,p=this.getElementClassName(c);if(p&&p.includes("section")){i=c;break}}a=a.parentElement}return i?Array.from(i.querySelectorAll('[data-id], g[class*="task"][data-id], polygon[class*="milestone"][data-id]')).filter(c=>c!==t):Array.from(e.querySelectorAll('[data-id], g[class*="task"][data-id], polygon[class*="milestone"][data-id]')).filter(p=>p!==t)}};var J=class extends C{getDiagramType(){return"sequenceDiagram"}getTargetableClasses(){return["participant","message","activation","note"]}getTargetableTags(){return["g","rect","text"]}extractNodeIds(t){let e=new Map,s=[/^participant-([A-Za-z0-9_]+)-\d+$/,/^actor-([A-Za-z0-9_]+)-\d+$/,/^message-([A-Za-z0-9_]+)-\d+$/,/^activation-([A-Za-z0-9_]+)-\d+$/,/^note-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("participant")||c.includes("actor")||c.includes("message")||c.includes("activation")||c.includes("note"))){l=a;break}}a=a.parentElement}l?e.set(i,l):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.participant[data-id="${e}"]`,`g.actor[data-id="${e}"]`,`g.message[data-id="${e}"]`,`g.activation[data-id="${e}"]`,`g.note[data-id="${e}"]`,`line[data-id="${e}"]`,`text[data-id="${e}"]`,`g[class*="participant"][data-id="${e}"]`,`g[class*="actor"][data-id="${e}"]`,`g[class*="message"][data-id="${e}"]`,`g[class*="activation"][data-id="${e}"]`,`g[class*="note"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("participant")||n.includes("actor"))){let o=Array.from(e.querySelectorAll('g[class*="message"][data-id]')),i=[];for(let a of o)try{let l=t.getBBox(),c=a.getBBox();c.x<l.x+l.width&&c.x+c.width>l.x&&c.y<l.y+l.height&&c.y+c.height>l.y&&i.push(a)}catch{continue}return i}if(n&&n.includes("message")){let o=Array.from(e.querySelectorAll('g[class*="participant"][data-id], g[class*="actor"][data-id]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();a.x<c.x+c.width&&a.x+a.width>c.x&&a.y<c.y+c.height&&a.y+a.height>c.y&&i.push(l)}catch{continue}}catch{return[]}return i}if(n&&n.includes("activation")){let o=t.parentElement;for(;o&&o!==e;){if(o instanceof SVGGraphicsElement){let i=this.getElementClassName(o);if(i&&(i.includes("participant")||i.includes("actor")))return[o]}o=o.parentElement}}return[]}};var Q=class extends C{getDiagramType(){return"classDiagram"}getTargetableClasses(){return["class","classBox","relation","edge"]}getTargetableTags(){return["g","rect","path"]}extractNodeIds(t){let e=new Map,s=[/^class-([A-Za-z0-9_]+)-\d+$/,/^classBox-([A-Za-z0-9_]+)-\d+$/,/^relation-([A-Za-z0-9_]+)-\d+$/,/^edge-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("class")||c.includes("classBox")||c.includes("relation")||c.includes("edge"))){l=a;break}}a=a.parentElement}l?e.set(i,l):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.class[data-id="${e}"]`,`g.classBox[data-id="${e}"]`,`g.relation[data-id="${e}"]`,`g.edge[data-id="${e}"]`,`g[class*="class"][data-id="${e}"]`,`g[class*="relation"][data-id="${e}"]`,`g[class*="edge"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("class")||n.includes("classBox"))){let o=Array.from(e.querySelectorAll('g[class*="relation"][data-id], g[class*="edge"][data-id], path[class*="edge"]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();if(c.x<a.x+a.width&&c.x+c.width>a.x&&c.y<a.y+a.height&&c.y+c.height>a.y){let u=Array.from(e.querySelectorAll('g[class*="class"][data-id], g[class*="classBox"][data-id]'));for(let d of u)if(d!==t&&!i.includes(d))try{let m=d.getBBox();c.x<m.x+m.width&&c.x+c.width>m.x&&c.y<m.y+m.height&&c.y+c.height>m.y&&i.push(d)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&(n.includes("relation")||n.includes("edge"))){let o=Array.from(e.querySelectorAll('g[class*="class"][data-id], g[class*="classBox"][data-id]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();a.x<c.x+c.width&&a.x+a.width>c.x&&a.y<c.y+c.height&&a.y+a.height>c.y&&i.push(l)}catch{continue}}catch{return[]}return i}return[]}};var j=class extends C{getDiagramType(){return"stateDiagram"}getTargetableClasses(){return["state","stateNode","transition","edge"]}getTargetableTags(){return["g","rect","ellipse","path"]}extractNodeIds(t){let e=new Map,s=[/^stateDiagram-([A-Za-z0-9_]+)-\d+$/,/^state-([A-Za-z0-9_]+)-\d+$/,/^stateNode-([A-Za-z0-9_]+)-\d+$/,/^node-([A-Za-z0-9_]+)-\d+$/,/^stateDiagram-([A-Za-z0-9_]+)$/,/^state-([A-Za-z0-9_]+)$/,/^([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)$/],n=t.querySelectorAll('g[class*="state"], g[class*="node"]');for(let i=0;i<n.length;i++){let a=n[i];if(!this.getElementClassName(a))continue;let c=a.querySelectorAll("text");for(let p=0;p<c.length;p++){let u=c[p],d=u.textContent?.trim();if(d&&/^[A-Za-z][A-Za-z0-9_]*$/.test(d)){let m=a;u.parentElement&&u.parentElement instanceof SVGElement&&(m=u.parentElement);let f=this.getElementClassName(m);f&&!f.includes("edgeLabel")&&!f.includes("label")&&(e.has(d)||e.set(d,a))}}}let o=[];for(let i of Array.from(t.querySelectorAll("[id]"))){let a=i.getAttribute("id");if(!a)continue;o.push(a);let l=this.extractIdFromPatterns(a,s);if(l&&!e.has(l)){let c=i,p=null;for(;c&&c!==t;){if(c instanceof SVGElement&&c.tagName==="g"){let u=this.getElementClassName(c);if(u&&(u.includes("state")||u.includes("node")||u.includes("transition")||u.includes("edge"))){p=c;break}}c=c.parentElement}p?e.set(l,p):i.tagName==="g"&&this.hasTargetableClass(i)&&e.set(l,i)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.state[data-id="${e}"]`,`g.stateNode[data-id="${e}"]`,`g.node[data-id="${e}"]`,`g.transition[data-id="${e}"]`,`g.edge[data-id="${e}"]`,`g[class*="state"][data-id="${e}"]`,`g[class*="node"][data-id="${e}"]`,`g[class*="transition"][data-id="${e}"]`,`g[class*="edge"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("state")||n.includes("stateNode"))){let o=Array.from(e.querySelectorAll('g[class*="transition"][data-id], g[class*="edge"][data-id], path[class*="edge"]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();if(c.x<a.x+a.width&&c.x+c.width>a.x&&c.y<a.y+a.height&&c.y+c.height>a.y){let u=Array.from(e.querySelectorAll('g[class*="state"][data-id], g[class*="stateNode"][data-id]'));for(let d of u)if(d!==t&&!i.includes(d))try{let m=d.getBBox();c.x<m.x+m.width&&c.x+c.width>m.x&&c.y<m.y+m.height&&c.y+c.height>m.y&&i.push(d)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&(n.includes("transition")||n.includes("edge"))){let o=Array.from(e.querySelectorAll('g[class*="state"][data-id], g[class*="stateNode"][data-id]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();a.x<c.x+c.width&&a.x+a.width>c.x&&a.y<c.y+c.height&&a.y+a.height>c.y&&i.push(l)}catch{continue}}catch{return[]}return i}return[]}};var ee=class extends C{getDiagramType(){return"erDiagram"}getTargetableClasses(){return["entity","relationship","attribute","edge"]}getTargetableTags(){return["g","rect","path"]}extractNodeIds(t){let e=new Map,s=[/^entity-([A-Za-z0-9_]+)-\d+$/,/^relationship-([A-Za-z0-9_]+)-\d+$/,/^attribute-([A-Za-z0-9_]+)-\d+$/,/^edge-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("entity")||c.includes("relationship")||c.includes("attribute")||c.includes("edge"))){l=a;break}}a=a.parentElement}l?e.set(i,l):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.entity[data-id="${e}"]`,`g.relationship[data-id="${e}"]`,`g.attribute[data-id="${e}"]`,`g.edge[data-id="${e}"]`,`g[class*="entity"][data-id="${e}"]`,`g[class*="relationship"][data-id="${e}"]`,`g[class*="attribute"][data-id="${e}"]`,`g[class*="edge"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&n.includes("entity")){let o=Array.from(e.querySelectorAll('g[class*="relationship"][data-id], g[class*="edge"][data-id], path[class*="edge"]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();if(c.x<a.x+a.width&&c.x+c.width>a.x&&c.y<a.y+a.height&&c.y+c.height>a.y){let u=Array.from(e.querySelectorAll('g[class*="entity"][data-id]'));for(let d of u)if(d!==t&&!i.includes(d))try{let m=d.getBBox();c.x<m.x+m.width&&c.x+c.width>m.x&&c.y<m.y+m.height&&c.y+c.height>m.y&&i.push(d)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&(n.includes("relationship")||n.includes("edge"))){let o=Array.from(e.querySelectorAll('g[class*="entity"][data-id]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();a.x<c.x+c.width&&a.x+a.width>c.x&&a.y<c.y+c.height&&a.y+a.height>c.y&&i.push(l)}catch{continue}}catch{return[]}return i}return[]}};var te=class extends C{getDiagramType(){return"pie"}getTargetableClasses(){return["slice","pie"]}getTargetableTags(){return["g","path","text"]}extractNodeIds(t){let e=new Map,s=[/^slice-([A-Za-z0-9_]+)-\d+$/,/^pie-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("slice")||c.includes("pie"))){l=a;break}}a=a.parentElement}l?e.set(i,l):(n.tagName==="g"&&this.hasTargetableClass(n)||n.tagName==="path"&&this.hasTargetableClass(n))&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.slice[data-id="${e}"]`,`g.pie[data-id="${e}"]`,`path.slice[data-id="${e}"]`,`path.pie[data-id="${e}"]`,`g[class*="slice"][data-id="${e}"]`,`g[class*="pie"][data-id="${e}"]`,`path[class*="slice"][data-id="${e}"]`,`path[class*="pie"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){return[]}};var ne=class extends C{getDiagramType(){return"journey"}getTargetableClasses(){return["step","task","section"]}getTargetableTags(){return["g","rect","text"]}extractNodeIds(t){let e=new Map,s=[/^step-([A-Za-z0-9_]+)-\d+$/,/^task-([A-Za-z0-9_]+)-\d+$/,/^section-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("step")||c.includes("task")||c.includes("section"))){l=a;break}}a=a.parentElement}l?e.set(i,l):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.step[data-id="${e}"]`,`g.task[data-id="${e}"]`,`g.section[data-id="${e}"]`,`g[class*="step"][data-id="${e}"]`,`g[class*="task"][data-id="${e}"]`,`g[class*="section"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=Array.from(e.querySelectorAll('g[class*="step"][data-id], g[class*="task"][data-id]')),o=n.indexOf(t);if(o===-1)return[];let i=[];return o>0&&i.push(n[o-1]),o<n.length-1&&i.push(n[o+1]),i}};var se=class extends C{getDiagramType(){return"gitGraph"}getTargetableClasses(){return["commit","branch","merge"]}getTargetableTags(){return["g","circle","path","text"]}extractNodeIds(t){let e=new Map,s=[/^commit-([A-Za-z0-9_]+)-\d+$/,/^branch-([A-Za-z0-9_]+)-\d+$/,/^merge-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("commit")||c.includes("branch")||c.includes("merge"))){l=a;break}}a=a.parentElement}l?e.set(i,l):(n.tagName==="g"&&this.hasTargetableClass(n)||n.tagName==="circle"&&this.hasTargetableClass(n))&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.commit[data-id="${e}"]`,`g.branch[data-id="${e}"]`,`g.merge[data-id="${e}"]`,`circle.commit[data-id="${e}"]`,`circle.branch[data-id="${e}"]`,`g[class*="commit"][data-id="${e}"]`,`g[class*="branch"][data-id="${e}"]`,`g[class*="merge"][data-id="${e}"]`,`circle[class*="commit"][data-id="${e}"]`,`circle[class*="branch"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&n.includes("commit")){let o=Array.from(e.querySelectorAll('g[class*="branch"][data-id], path[class*="branch"], path[class*="edge"]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();if(c.x<a.x+a.width&&c.x+c.width>a.x&&c.y<a.y+a.height&&c.y+c.height>a.y){let u=Array.from(e.querySelectorAll('g[class*="commit"][data-id], circle[class*="commit"][data-id]'));for(let d of u)if(d!==t&&!i.includes(d))try{let m=d.getBBox();c.x<m.x+m.width&&c.x+m.width>m.x&&c.y<m.y+m.height&&c.y+m.height>m.y&&i.push(d)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&n.includes("branch")){let o=Array.from(e.querySelectorAll('g[class*="commit"][data-id], circle[class*="commit"][data-id]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();a.x<c.x+c.width&&a.x+a.width>c.x&&a.y<c.y+c.height&&a.y+c.height>c.y&&i.push(l)}catch{continue}}catch{return[]}return i}return[]}};var re=class extends C{getDiagramType(){return"timeline"}getTargetableClasses(){return["section","event","timeline"]}getTargetableTags(){return["g","rect","text"]}extractNodeIds(t){let e=new Map,s=[/^section-([A-Za-z0-9_]+)-\d+$/,/^event-([A-Za-z0-9_]+)-\d+$/,/^timeline-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("section")||c.includes("event")||c.includes("timeline"))){l=a;break}}a=a.parentElement}l?e.set(i,l):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.section[data-id="${e}"]`,`g.event[data-id="${e}"]`,`g.timeline[data-id="${e}"]`,`g[class*="section"][data-id="${e}"]`,`g[class*="event"][data-id="${e}"]`,`g[class*="timeline"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&n.includes("section"))return Array.from(t.querySelectorAll('g[class*="event"][data-id]'));if(n&&n.includes("event")){let o=t.parentElement;for(;o&&o!==e;){let a=this.getElementClassName(o);if(a&&a.includes("section"))return Array.from(o.querySelectorAll('g[class*="event"][data-id]')).filter(c=>c!==t);o=o.parentElement}return Array.from(e.querySelectorAll('g[class*="event"][data-id]')).filter(a=>a!==t)}return[]}};var ae=class extends C{getDiagramType(){return"quadrantChart"}getTargetableClasses(){return["quadrant","point","data"]}getTargetableTags(){return["g","circle","rect","text"]}extractNodeIds(t){let e=new Map,s=[/^quadrant-([A-Za-z0-9_]+)-\d+$/,/^point-([A-Za-z0-9_]+)-\d+$/,/^data-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("quadrant")||c.includes("point")||c.includes("data"))){l=a;break}}a=a.parentElement}l?e.set(i,l):(n.tagName==="g"&&this.hasTargetableClass(n)||n.tagName==="circle"&&this.hasTargetableClass(n))&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.quadrant[data-id="${e}"]`,`g.point[data-id="${e}"]`,`g.data[data-id="${e}"]`,`circle.quadrant[data-id="${e}"]`,`circle.point[data-id="${e}"]`,`circle.data[data-id="${e}"]`,`g[class*="quadrant"][data-id="${e}"]`,`g[class*="point"][data-id="${e}"]`,`g[class*="data"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("point")||n.includes("data")))try{let o=t.getBBox(),i=o.x+o.width/2,a=o.y+o.height/2,l=Array.from(e.querySelectorAll('g[class*="quadrant"]'));for(let c of l)try{let p=c.getBBox();if(i>=p.x&&i<=p.x+p.width&&a>=p.y&&a<=p.y+p.height)return Array.from(c.querySelectorAll('g[class*="point"][data-id], circle[class*="point"][data-id], g[class*="data"][data-id], circle[class*="data"][data-id]')).filter(d=>d!==t)}catch{continue}}catch{return Array.from(e.querySelectorAll('g[class*="point"][data-id], circle[class*="point"][data-id], g[class*="data"][data-id], circle[class*="data"][data-id]')).filter(i=>i!==t)}return n&&n.includes("quadrant")?Array.from(t.querySelectorAll('g[class*="point"][data-id], circle[class*="point"][data-id], g[class*="data"][data-id], circle[class*="data"][data-id]')):[]}};var ie=class extends C{getDiagramType(){return"requirement"}getTargetableClasses(){return["requirement","function","relationship"]}getTargetableTags(){return["g","rect","path"]}extractNodeIds(t){let e=new Map,s=[/^requirement-([A-Za-z0-9_]+)-\d+$/,/^function-([A-Za-z0-9_]+)-\d+$/,/^relationship-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("requirement")||c.includes("function")||c.includes("relationship"))){l=a;break}}a=a.parentElement}l?e.set(i,l):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.requirement[data-id="${e}"]`,`g.function[data-id="${e}"]`,`g.relationship[data-id="${e}"]`,`g[class*="requirement"][data-id="${e}"]`,`g[class*="function"][data-id="${e}"]`,`g[class*="relationship"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("requirement")||n.includes("function"))){let o=Array.from(e.querySelectorAll('g[class*="relationship"][data-id], path[class*="relationship"]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();if(c.x<a.x+a.width&&c.x+c.width>a.x&&c.y<a.y+a.height&&c.y+c.height>a.y){let u=Array.from(e.querySelectorAll('g[class*="requirement"][data-id], g[class*="function"][data-id]'));for(let d of u)if(d!==t&&!i.includes(d))try{let m=d.getBBox();c.x<m.x+m.width&&c.x+c.width>m.x&&c.y<m.y+m.height&&c.y+c.height>m.y&&i.push(d)}catch{continue}}}catch{continue}}catch{return[]}return i}return[]}};var H=class extends C{constructor(t){super(),this.diagramType=t}getDiagramType(){return this.diagramType}getTargetableClasses(){return["c4","element","relationship","boundary"]}getTargetableTags(){return["g","rect","path","text"]}extractNodeIds(t){let e=new Map,s=[/^c4-([A-Za-z0-9_]+)-\d+$/,/^element-([A-Za-z0-9_]+)-\d+$/,/^relationship-([A-Za-z0-9_]+)-\d+$/,/^boundary-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)$/],n=[],o=Array.from(t.querySelectorAll("[id]"));for(let i of o){let a=i.getAttribute("id");if(!a)continue;n.push(a);let l=this.extractIdFromPatterns(a,s);if(l&&!e.has(l)){let c=i,p=null;for(;c&&c!==t;){if(c instanceof SVGElement&&c.tagName==="g"){let u=this.getElementClassName(c);if(u&&(u.includes("c4")||u.includes("element")||u.includes("relationship")||u.includes("boundary"))){p=c;break}}c=c.parentElement}p?e.set(l,p):i.tagName==="g"&&this.hasTargetableClass(i)&&e.set(l,i)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.c4[data-id="${e}"]`,`g.element[data-id="${e}"]`,`g.relationship[data-id="${e}"]`,`g.boundary[data-id="${e}"]`,`g[class*="c4"][data-id="${e}"]`,`g[class*="element"][data-id="${e}"]`,`g[class*="relationship"][data-id="${e}"]`,`g[class*="boundary"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("c4")||n.includes("element"))){let o=Array.from(e.querySelectorAll('g[class*="relationship"][data-id], path[class*="relationship"]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();if(c.x<a.x+a.width&&c.x+c.width>a.x&&c.y<a.y+a.height&&c.y+c.height>a.y){let u=Array.from(e.querySelectorAll('g[class*="c4"][data-id], g[class*="element"][data-id]'));for(let d of u)if(d!==t&&!i.includes(d))try{let m=d.getBBox();c.x<m.x+m.width&&c.x+c.width>m.x&&c.y<m.y+m.height&&c.y+c.height>m.y&&i.push(d)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&n.includes("relationship")){let o=Array.from(e.querySelectorAll('g[class*="c4"][data-id], g[class*="element"][data-id]')),i=[];try{let a=t.getBBox();for(let l of o)try{let c=l.getBBox();a.x<c.x+c.width&&a.x+a.width>c.x&&a.y<c.y+c.height&&a.y+a.height>c.y&&i.push(l)}catch{continue}}catch{return[]}return i}return[]}};var oe=class extends C{getDiagramType(){return"block"}getTargetableClasses(){return["block","node","edge"]}getTargetableTags(){return["g","rect","path"]}extractNodeIds(t){let e=new Map,s=[/^block-([A-Za-z0-9_]+)-\d+$/,/^node-([A-Za-z0-9_]+)-\d+$/,/^edge-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,l=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let c=this.getElementClassName(a);if(c&&(c.includes("block")||c.includes("node")||c.includes("edge"))){l=a;break}}a=a.parentElement}l?e.set(i,l):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.block[data-id="${e}"]`,`g.node[data-id="${e}"]`,`g.edge[data-id="${e}"]`,`g[class*="block"][data-id="${e}"]`,`g[class*="node"][data-id="${e}"]`,`g[class*="edge"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("block")||n.includes("node"))){let o=Array.from(e.querySelectorAll('path.edge, path[class*="edge"], g.edge path, path[id*="edge"]')),i=[];try{let a=t.getBBox(),l=a.x+a.width/2,c=a.y+a.height/2;for(let p of o)try{let u=p.getBBox(),d=u.x+u.width/2,m=u.y+u.height/2,f=Math.max(a.width,a.height)*1.5,D=Math.sqrt(Math.pow(d-l,2)+Math.pow(m-c,2));if(u.x<a.x+a.width&&u.x+u.width>a.x&&u.y<a.y+a.height&&u.y+u.height>a.y||D<f){let w=Array.from(e.querySelectorAll("g.block[data-id], g.node[data-id]"));for(let h of w)if(h!==t&&!i.includes(h))try{let b=h.getBBox(),y=b.x+b.width/2,E=b.y+b.height/2,T=Math.sqrt(Math.pow(y-d,2)+Math.pow(E-m,2));(u.x<b.x+b.width&&u.x+u.width>b.x&&u.y<b.y+b.height&&u.y+u.height>b.y||T<f)&&i.push(h)}catch{continue}}}catch{continue}}catch{return[]}return i}return[]}};var Ze=r=>/^-?\d+(\.\d+)?$/.test(r),He=r=>{let t=r.trim();return t&&t.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_-]/g,"")||""},R=class extends C{constructor(e,s={}){super();this.diagramType=e;this.options=s}getDiagramType(){return this.diagramType}extractNodeIds(e){let s=new Map,n=new Map,o=this.options.maxTargets,i=Array.from(e.querySelectorAll("text"));for(let a of i){let l=(a.textContent??"").trim();if(!l||this.options.skipNumericLabels&&Ze(l))continue;let c=He(l);if(!c)continue;let p=this.findTargetGroupForText(a,e);if(!p)continue;let u=c,d=(n.get(u)??0)+1;if(n.set(u,d),d>1&&(c=`${u}_${d}`),s.has(c)||s.set(c,p),typeof o=="number"&&s.size>=o)break}return s}getTargetSelectors(e){let s=this.escapeSelector(e);return[`g[data-id="${s}"]`,`.node[data-id="${s}"]`,`.participant[data-id="${s}"]`,`.message[data-id="${s}"]`,`[data-id="${s}"]`]}findAdjacentElements(e,s){return[]}getTargetableClasses(){return["node","label","item","task","bar","slice"]}getTargetableTags(){return["g","rect","circle","ellipse","polygon","path","text"]}findTargetGroupForText(e,s){let n=e;for(;n&&n!==s;){let o=n.parentElement;if(!o||o===s)break;if(o.tagName.toLowerCase()==="g"){let i=o,a=typeof i.className=="string"?i.className:i.className.baseVal;if(!!o.querySelector("rect,circle,ellipse,polygon,path")||a.includes("node"))return i}n=o}for(n=e;n&&n!==s;){let o=n.parentElement;if(!o||o===s)break;let i=o.tagName.toLowerCase();if(i==="g"||i==="rect"||i==="circle"||i==="ellipse"||i==="polygon"||i==="path")return o;n=o}return null}};var ce=class extends R{constructor(){super("mindmap",{skipNumericLabels:!0,maxTargets:200})}};var le=class extends R{constructor(){super("xychart",{skipNumericLabels:!0,maxTargets:200})}};var de=class extends R{constructor(){super("kanban",{skipNumericLabels:!0,maxTargets:300})}};var ue=class extends R{constructor(){super("packet",{skipNumericLabels:!0,maxTargets:300})}};var pe=class extends R{constructor(){super("radar",{skipNumericLabels:!0,maxTargets:300})}};var me=class extends R{constructor(){super("sankey",{skipNumericLabels:!0,maxTargets:300})}};var he=class extends R{constructor(){super("treemap",{skipNumericLabels:!0,maxTargets:300})}};var ge=class extends R{constructor(){super("zenuml",{skipNumericLabels:!0,maxTargets:300})}extractNodeIds(t){let e=new Map,s=Array.from(t.querySelectorAll("foreignObject"));for(let n of s){let o=Array.from(n.querySelectorAll(".participant, .message, .alias, .group"));for(let i of o){let a=(i.textContent??"").trim();if(!a||a.length>100)continue;let l=a.replace(/[«»<>]/g,"").trim(),c=new Set;c.add(a.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_-]/g,"")),c.add(l.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_-]/g,""));for(let p of c)!p||e.has(p)||e.set(p,i)}}return e.size===0?super.extractNodeIds(t):e}};P.register("flowchart",new K);P.register("gantt",new X);P.register("sequenceDiagram",new J);P.register("classDiagram",new Q);P.register("stateDiagram",new j);P.register("stateDiagram-v2",new j);P.register("erDiagram",new ee);P.register("pie",new te);P.register("journey",new ne);P.register("gitGraph",new se);P.register("timeline",new re);P.register("quadrantChart",new ae);P.register("requirement",new ie);P.register("c4Context",new H("c4Context"));P.register("c4Container",new H("c4Container"));P.register("c4Component",new H("c4Component"));P.register("block",new oe);P.register("mindmap",new ce);P.register("xychart",new le);P.register("kanban",new de);P.register("packet",new ue);P.register("radar",new pe);P.register("sankey",new me);P.register("treemap",new he);P.register("zenuml",new ge);P.setDefault(new K);function We(r,t,e){let s=t.extractNodeIds(r),n=t.getDiagramType(),o=e?Ue(e):new Set,i=new Set;if(n==="classDiagram"&&e){let w=/class\s+([A-Za-z0-9_]+)\s*[<{]/g,h;for(;(h=w.exec(e))!==null;)i.add(h[1]);let b=/class\s+([A-Za-z0-9_]+)(?:\s|$)/g;for(b.lastIndex=0;(h=b.exec(e))!==null;)i.add(h[1])}let a=new Set;if(n==="erDiagram"&&e){let w=/([A-Z][A-Z0-9_]+)\s*\{/g,h;for(;(h=w.exec(e))!==null;)a.add(h[1]);let b=/([A-Z][A-Z0-9_]+)\s*[|o]+--[|o]+/g;for(b.lastIndex=0;(h=b.exec(e))!==null;)a.add(h[1]);let y=/[|o]+--[|o]+\s*([A-Z][A-Z0-9_]+)/g;for(y.lastIndex=0;(h=y.exec(e))!==null;)a.add(h[1])}let l=new Set;if(n==="gitGraph"&&e){let w=/branch\s+([A-Za-z0-9_]+)/g,h;for(;(h=w.exec(e))!==null;)l.add(h[1]);let b=/checkout\s+([A-Za-z0-9_]+)/g;for(b.lastIndex=0;(h=b.exec(e))!==null;)l.add(h[1]);let y=/commit\s+id:\s*"([^"]+)"/g;for(y.lastIndex=0;(h=y.exec(e))!==null;)l.add(h[1]);let E=/merge\s+([A-Za-z0-9_]+)/g;for(E.lastIndex=0;(h=E.exec(e))!==null;)l.add(h[1]);l.add("merge")}let c=new Set;if(n==="journey"&&e){let w=e.split(`
`);for(let h of w){if(h.trim().startsWith("title")||h.trim().startsWith("section"))continue;let b=h.match(/^\s+([^:]+):\s*\d+:/);if(b&&b[1]){let y=b[1].trim();y&&!y.includes(`
`)&&c.add(y)}}}let p=new Set;if(n==="pie"&&e){let w=/"([^"]+)"\s*:\s*\d+\.?\d*/g,h;for(w.lastIndex=0;(h=w.exec(e))!==null;){let b=h[1].trim();b&&p.add(b)}}let u=new Set;if(n==="quadrantChart"&&e){let w=/"?([^":\n]+)"?\s*:\s*\[?[\d.]+\s*,\s*[\d.]+\]?/g,h;for(w.lastIndex=0;(h=w.exec(e))!==null;){let b=h[1].trim();b&&u.add(b)}}let d=new Set;if(n==="requirement"&&e){let w=/requirement\s+([A-Za-z0-9_]+)\s*\{/g,h;for(w.lastIndex=0;(h=w.exec(e))!==null;){let E=h[1].trim();E&&d.add(E)}let b=/element\s+([A-Za-z0-9_]+)\s*\{/g,y;for(b.lastIndex=0;(y=b.exec(e))!==null;){let E=y[1].trim();E&&d.add(E)}}let m=new Set;if(n==="sequenceDiagram"&&e){let w=/(?:participant|actor)\s+([A-Za-z0-9_]+)/g,h;for(w.lastIndex=0;(h=w.exec(e))!==null;){let E=h[1].trim();E&&m.add(E)}let b=/(?:->>|->|-->>|-->)\s*[A-Za-z0-9_]+\s*:\s*([^\n]+)/g,y;for(b.lastIndex=0;(y=b.exec(e))!==null;){let E=y[1].trim();E&&m.add(E)}}let f=new Set;if(n==="timeline"&&e){let w=/section\s+([^\n]+)/g,h;for(w.lastIndex=0;(h=w.exec(e))!==null;){let b=h[1].trim();b&&f.add(b)}}if(e&&((n==="c4Component"||n==="c4Container"||n==="c4Context")&&(s.size===0||s.size<o.size)||n==="classDiagram"&&(s.size===0||s.size<i.size)||n==="erDiagram"&&(s.size===0||s.size<a.size)||n==="gitGraph"&&(s.size===0||s.size<l.size)||n==="journey"&&(s.size===0||s.size<c.size)||n==="pie"&&(s.size===0||s.size<p.size)||n==="quadrantChart"&&(s.size===0||s.size<u.size)||n==="requirement"&&(s.size===0||s.size<d.size)||n==="sequenceDiagram"&&(s.size===0||s.size<m.size)||n==="timeline"&&(s.size===0||s.size<f.size))){let w={};if(n==="c4Container"||n==="c4Context"){let y=/(?:Container_Boundary|System_Boundary)\s*\(\s*([A-Za-z0-9_]+)\s*,[\s\S]*?\{([\s\S]*?)\}/g,E;for(y.lastIndex=0;(E=y.exec(e))!==null;){let T=E[1],M=E[2],V=[/Container\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/Component\s*\(\s*([A-Za-z0-9_]+)\s*,/g],A=[];for(let S of V){S.lastIndex=0;let N;for(;(N=S.exec(M))!==null;)A.push(N[1])}A.length>0&&(w[T]=A)}}let h=n==="classDiagram"?i:n==="erDiagram"?a:n==="gitGraph"?l:n==="journey"?c:n==="pie"?p:n==="quadrantChart"?u:n==="requirement"?d:n==="sequenceDiagram"?m:n==="timeline"?f:o,b=n==="erDiagram"||n==="gitGraph"||n==="journey"||n==="pie"||n==="quadrantChart"||n==="requirement"||n==="sequenceDiagram"?Array.from(h).sort((y,E)=>E.length!==y.length?E.length-y.length:y.localeCompare(E)):Array.from(h);for(let y of b){if(s.has(y)||w[y])continue;let E=y.toLowerCase(),M=Array.from(r.querySelectorAll("*")).filter(A=>{let S=A.textContent?.toLowerCase()||"";if(n==="erDiagram"){let v=y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${v.replace(/_/g,"\\_")}\\b`,"i").test(S))return!0;let B=y.replace(/_/g,"").toLowerCase();if(S.trim().startsWith(B)||S.trim().endsWith(B)||new RegExp(`\\b${B}\\b`,"i").test(S)||S.trim().startsWith(E)||S.trim().endsWith(E))return!0}if(n==="gitGraph"){let v=y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${v}\\b`,"i").test(S)||S.trim().startsWith(E)||S.trim().endsWith(E))return!0}if(n==="journey"){let v=y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(v.replace(/\s+/g,"\\s+"),"i").test(S)||new RegExp(`\\b${v.replace(/\s+/g,"\\s+")}\\b`,"i").test(S)||S.trim().startsWith(E)||S.trim().endsWith(E))return!0}if(n==="timeline"){let v=S.replace(/\s+/g," ").trim().toLowerCase(),G=E.replace(/\s+/g," ").trim();if(v.includes(G))return!0;let I=y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(I.replace(/\s+/g,"\\s+"),"i").test(S)||v.startsWith(G)||v.endsWith(G))return!0}if(n==="classDiagram"&&(new RegExp(`\\b${y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(S)||S.trim().startsWith(E)||S.trim().endsWith(E)))return!0;let N=E==="db"?/<<system_db>>/i:null;if(N&&N.test(S)||S.includes(E)&&(S.startsWith(E)||S.includes(" "+E)||S.includes(E+" ")||S.includes("<<"+E)||S.includes(E+">>")))return!0;let g=y.replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase();if(g!==E&&g.includes(" ")){let v=g.split(" ");if(v.length>1&&v.every(G=>S.includes(G))){let G=v.join("");if(S.includes(G)||v.every((I,B)=>{if(B===0)return S.includes(I);let $=v[B-1];return S.includes($+" "+I)||S.includes($+I)}))return!0}}if(E.length>3){let v=["app","api","ui","db","service","system","user"];for(let G of v)if(E.endsWith(G)&&E.length>G.length){let I=E.slice(0,-G.length);if(S.includes(I)&&(S.includes(G)||S.includes(G+"lication")||S.includes(G+"i"))&&(S.includes(I+" "+G)||S.includes(I+G)||S.includes(I)&&S.includes(G+"lication")))return!0}}return!1}),V=!1;for(let A of M){let S=A,N=null;if(n==="pie"){let g=null,v=A;for(;v&&v!==r;){if(v instanceof SVGElement&&v.tagName==="g"){let G=typeof v.className=="string"?v.className:v.className.baseVal;if(G&&G.includes("legend")){g=v;break}}v=v.parentElement}if(g){let G=Array.from(r.querySelectorAll("path")),I=Array.from(r.querySelectorAll("g")).filter(_=>{let q=typeof _.className=="string"?_.className:_.className.baseVal;return q&&q.includes("legend")}),B=g?I.indexOf(g):-1,$=G.filter(_=>{let q=_.getAttribute("d");return q&&q.includes("M")&&(q.includes("A")||q.includes("L"))});if(B>=0&&B<$.length){let _=$[B];if(_ instanceof SVGGraphicsElement){let q=String(y);if(!s.has(q)){s.set(q,_),V=!0;continue}}}}}if(n==="sequenceDiagram"&&A instanceof SVGElement){let g=typeof A.className=="string"?A.className:A.className.baseVal;if(g&&g.includes("message")){let v=null;try{if(A instanceof SVGGraphicsElement){let I=A.getBBox(),B=Array.from(r.querySelectorAll("line, path"));for(let $ of B)try{let _=$.getBBox();if(Math.sqrt(Math.pow(I.x+I.width/2-(_.x+_.width/2),2)+Math.pow(I.y+I.height/2-(_.y+_.height/2),2))<150){let z=$.parentElement;for(;z&&z!==r;){if(z instanceof SVGElement&&z.tagName==="g"){let Ge=typeof z.className=="string"?z.className:z.className.baseVal;if(Ge&&(Ge.includes("message")||z.contains(A))){v=z;break}}z=z.parentElement}if(v)break;v=$;break}}catch{continue}}}catch{}let G=A;for(;G&&G!==r&&!v;){if(G instanceof SVGElement&&G.tagName==="g"){let I=typeof G.className=="string"?G.className:G.className.baseVal;if(I&&I.includes("message")){v=G;break}}G=G.parentElement}if(v?N=v:A instanceof SVGGraphicsElement&&(N=A),N){V=!0;let I=String(y),B=null;for(let[$,_]of s.entries())if($===I){B=_;break}B&&B!==N&&s.delete(I),s.has(I)||s.set(I,N);continue}}}if(n==="quadrantChart"){let g=A;for(;g&&g!==r;){if(g instanceof SVGElement&&g.tagName==="g"){let v=typeof g.className=="string"?g.className:g.className.baseVal;if(v&&v.includes("data-point")&&!v.includes("data-points")&&!v.includes("main")&&g.querySelector("circle")){N=g,V=!0;let G=String(y),I=null;for(let[$,_]of s.entries())if($===G){I=_;break}if(I){let $=typeof I.className=="string"?I.className:I.className.baseVal;$&&($.includes("main")||$.includes("data-points"))&&s.delete(G)}let B=null;for(let[$,_]of s.entries())if(_===N){B=$;break}if(B&&G.length<=B.length){V=!1;break}B&&s.delete(B),s.set(G,N);break}}g=g.parentElement}if(V&&N)continue}for(;S&&S!==r;){if(S instanceof SVGElement&&S.tagName==="g"){let g=S instanceof SVGElement?typeof S.className=="string"?S.className:S.className.baseVal:"",v=S.querySelector("rect, circle, ellipse, polygon, path");if(n==="pie"&&g&&g.includes("legend")){S=S.parentElement;continue}if(n==="quadrantChart"&&g&&(g.includes("main")||g.includes("data-points"))){S=S.parentElement;continue}if(n==="quadrantChart"&&g&&(g.includes("point")||g.includes("quadrant")||g.includes("data"))){if(g&&g.includes("data-point")&&!g.includes("data-points")){if(N=S,S.querySelector("circle"))break}else if(!N&&!g.includes("main")&&!g.includes("data-points")&&(N=S,S.querySelector("circle")))break}if((g&&(g.includes("c4")||g.includes("element")||g.includes("component")||g.includes("container")||g.includes("relationship")||g.includes("boundary")||g.includes("branch")||g.includes("commit")||g.includes("merge")||g.includes("branchLabel")||g.includes("label")||g.includes("step")||g.includes("task")||g.includes("section")||g.includes("journey")||g.includes("slice")||g.includes("segment")||g.includes("pie")||g.includes("quadrant")||g.includes("point")||g.includes("timeline")||g.includes("event"))||v||!N)&&(N=S,v||g&&(g.includes("branchLabel")||g.includes("label")||g.includes("step")||g.includes("task")||g.includes("slice")||g.includes("point")||g.includes("quadrant"))))break}S=S.parentElement}if(N){let g=String(y);if(n==="quadrantChart"){let v=s.get(g);if(v){let G=typeof v.className=="string"?v.className:v.className.baseVal;if(G&&(G.includes("main")||G.includes("data-points"))||G&&G.includes("data-point")&&!G.includes("data-points"))continue}}if(n==="erDiagram"||n==="gitGraph"||n==="journey"||n==="pie"||n==="quadrantChart"){let v=null;for(let[G,I]of s.entries())if(I===N){v=G;break}if(v&&g.length<=v.length)continue;v&&s.delete(v)}s.has(g)||(s.set(g,N),V=!0);break}}}for(let[y,E]of Object.entries(w)){if(s.has(y))continue;let T=[];for(let M of E)if(s.has(M))T.push(s.get(M));else{let V=r.querySelector(`[data-id="${M}"]`);V&&V instanceof SVGElement&&T.push(V)}if(T.length>=Math.min(2,E.length)){let M=Array.from(r.querySelectorAll("g")),V=[];for(let S of M){let N=!0;for(let g of T)if(!S.contains(g)){N=!1;break}N&&V.push(S)}let A=null;if(V.length===0){let S=!0;for(let N of T)if(!r.contains(N)){S=!1;break}S&&(A=r)}else for(let S of V){let N=S instanceof SVGElement?typeof S.className=="string"?S.className:S.className.baseVal:"";if(!!S.querySelector("rect, circle, ellipse, polygon, path")||N.includes("boundary")||N.includes("container")||N.includes("system")){A=S;break}A||(A=S)}A&&!s.has(y)&&s.set(y,A)}}}let k=new Map;if(n==="gitGraph"&&e){let w=/merge\s+([A-Za-z0-9_]+)/g,h=e.split(`
`);w.lastIndex=0;let b;for(;(b=w.exec(e))!==null;){let y=h.findIndex(E=>E.includes(b[0]));if(y>=0&&y<h.length-1){let T=h[y+1].match(/commit\s+id:\s*"([^"]+)"/);T&&T[1]&&s.has(T[1])&&(k.has("merge")||k.set("merge",T[1]))}}}for(let[w,h]of s)h.setAttribute("data-id",w);for(let[w,h]of k.entries()){let b=s.get(h);b&&(s.set(w,b),b.setAttribute("data-id",w))}for(let[w,h]of k.entries()){let b=s.get(h);b&&(b.setAttribute("data-id-merge",w),s.has(w)||(s.set(w,b),b.setAttribute("data-id",w)))}}var je=(r,t,e)=>({getRoot:()=>t,getContainer:()=>r,resolveTarget:s=>F({getRoot:()=>t,getStrategy:()=>e},s),getStrategy:()=>e,destroy:()=>{r.innerHTML=""}});function Ue(r){let t=new Set,e=[/Component\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/Container\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/Person\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/System\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/System_Ext\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/SystemDb\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/Container_Boundary\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/System_Boundary\s*\(\s*([A-Za-z0-9_]+)\s*,/g];for(let s of e){s.lastIndex=0;let n;for(;(n=s.exec(r))!==null;)t.add(n[1])}return t}var Ve=()=>({async render({mountEl:r,mermaidText:t}){let e=window.mermaid;if(!e||typeof e.render!="function")throw new L("Mermaid is not available on window.mermaid","MPF_MERMAID_UNAVAILABLE",{mermaidAvailable:typeof window.mermaid<"u"});let s=`finsteps-${Math.random().toString(36).slice(2,8)}`,n;if(Y(t)==="zenuml"){console.log("[MermaidAdapter] ZenUML detected, checking registry...");let d=e.diagrams||{};console.log("[MermaidAdapter] Registered diagrams:",Object.keys(d))}try{n=await e.render(s,t)}catch(d){let m=Y(t);throw new L(`Failed to render Mermaid diagram (type: ${m}): ${d}`,"MPF_MERMAID_RENDER_FAILED",{mermaidTextLength:t?.length||0,detectedType:m,errorMessage:d instanceof Error?d.message:String(d)})}let{svg:o}=n;r.innerHTML="";let i=document.createElement("div");i.className="finsteps-diagram",i.tabIndex=0,i.setAttribute("role","application"),i.innerHTML=o,r.appendChild(i);let a=i.querySelector("svg");if(!a)throw new L("Mermaid render did not return an SVG element","MPF_MERMAID_RENDER_FAILED");let l=Y(t),c=P.getOrDefault(l);l==="zenuml"&&await new Promise(d=>setTimeout(d,100)),We(a,c,t),a.removeAttribute("width"),a.removeAttribute("height"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.getAttribute("preserveAspectRatio")||a.setAttribute("preserveAspectRatio","xMidYMid meet");let p=a.getAttribute("viewBox"),u=p;if(!p||p==="0 0 0 0"){let d=a.querySelector("g");if(d)try{let m=d.getBBox();m.width>0&&m.height>0&&(u=`${m.x-40} ${m.y-40} ${m.width+40*2} ${m.height+40*2}`,a.setAttribute("viewBox",u))}catch{let m=a.getAttribute("width"),f=a.getAttribute("height");if(m&&f){let D=parseFloat(m)||1e3,k=parseFloat(f)||1e3;u=`0 0 ${D} ${k}`,a.setAttribute("viewBox",u)}}}return u&&a.setAttribute("data-initial-viewbox",u),je(i,a,c)}});var fe=class{constructor(t){this.handlers=t}async run(t,e,s){let n=[];for(let o of t){let i=this.handlers[o.type];if(!i){let a=new Z(`Unknown action: ${o.type}`,"MPF_ACTION_UNKNOWN",{actionType:o.type});if(s==="haltOnError")throw a;n.push(a);continue}try{await i(e,o)}catch(a){if(a instanceof Error){if(s==="haltOnError")throw a;n.push(a)}else if(s==="haltOnError")throw a}}return n}};var Pe=(r,t,e)=>{for(let s of r.elements)s.classList.remove(r.className);r.elements.clear(),r.className=e;for(let s of t)s.classList.add(e),r.elements.add(s)},Ye=(r,t)=>{if(!t)return[];let e=F(r.diagram,t);return e?[e]:[]},Be=()=>{let r={className:"finsteps-highlight",elements:new Set};return{"nav.next":async({controller:e})=>{await e.next()},"nav.prev":async({controller:e})=>{await e.prev()},"nav.goto":async({controller:e},s)=>{let n=s.payload?.index,o=s.payload?.id;if(typeof n=="number"){await e.goto(n);return}if(typeof o=="string"){await e.goto(o);return}throw new Z("nav.goto requires index or id","MPF_ACTION_INVALID_ARGS")},"nav.reset":async({controller:e})=>{await e.reset()},"camera.fit":async(e,s)=>{if(!e.camera)return;let n=s.payload?.target,o=F(e.diagram,n);if(!o)throw new Z("camera.fit missing target","MPF_ACTION_INVALID_ARGS",{target:n?JSON.stringify(n):void 0});let a=s.payload?.durationMs??s.payload?.duration,l=s.payload?.easing;await e.camera.fit(o,{padding:typeof s.payload?.padding=="number"?s.payload.padding:void 0,duration:typeof a=="number"?a:void 0,easing:typeof l=="string"?l:void 0})},"camera.reset":({camera:e})=>{e?.reset()},"camera.fitAll":(e,s)=>{if(!e.camera)return;let n=typeof s.payload?.padding=="number"?s.payload.padding:void 0;e.camera.fitAll?e.camera.fitAll(n):e.camera.reset&&e.camera.reset()},"overlay.bubble":(e,s)=>{if(!e.overlay)return;let n=s.payload?.target,o=F(e.diagram,n);if(!o)throw new Z("overlay.bubble missing target","MPF_ACTION_INVALID_ARGS",{target:n?JSON.stringify(n):void 0});let i=String(s.payload?.text??"");e.overlay.showBubble({id:typeof s.payload?.id=="string"?s.payload.id:void 0,target:o,text:i})},"overlay.hide":(e,s)=>{e.overlay?.hideBubble(typeof s.payload?.id=="string"?s.payload.id:void 0)},"style.highlight":(e,s)=>{let n=s.payload?.target,o=typeof s.payload?.className=="string"?s.payload.className:"finsteps-highlight",i=Ye(e,n);Pe(r,i,o)},"style.clear":()=>{Pe(r,[],r.className)},wait:async(e,s)=>{let n=typeof s.payload?.ms=="number"?s.payload.ms:0;await new Promise(o=>window.setTimeout(o,n))}}};var U=class{constructor(){this.disposers=[];this.timeouts=[]}bind(t,e){for(let s of t){if(s.event==="timer"){let l=window.setTimeout(async()=>{let c=await e.actionEngine.run(s.actions,{controller:e.controller,diagram:e.diagram,event:{type:"timer",target:null,currentTarget:null,originalEvent:null,timeStamp:Date.now()},camera:e.camera,overlay:e.overlay},e.errorPolicy);for(let p of c)e.onError(p)},s.delayMs??0);this.timeouts.push(l);continue}let n=s.event==="key"?e.diagram.getContainer():e.diagram.getRoot(),o=F(e.diagram,s.target)??n,i=s.event==="click"?"click":s.event==="hover"?"mouseenter":s.event==="key"?"keydown":s.eventName??s.event,a=async l=>{if(s.event==="key"&&s.key&&l.key!==s.key)return;let c=Xe(l,i),p=await e.actionEngine.run(s.actions,{controller:e.controller,diagram:e.diagram,event:c,camera:e.camera,overlay:e.overlay},e.errorPolicy);for(let u of p)e.onError(u)};o.addEventListener(i,a),this.disposers.push(()=>o.removeEventListener(i,a))}}destroy(){for(let t of this.disposers)t();for(let t of this.timeouts)window.clearTimeout(t);this.disposers=[],this.timeouts=[]}},Xe=(r,t)=>r instanceof MouseEvent?{type:t,target:r.target,currentTarget:r.currentTarget,clientX:r.clientX,clientY:r.clientY,timeStamp:r.timeStamp,originalEvent:r}:r instanceof KeyboardEvent?{type:t,target:r.target,currentTarget:r.currentTarget,key:r.key,timeStamp:r.timeStamp,originalEvent:r}:{type:t,target:r.target,currentTarget:r.currentTarget,timeStamp:r.timeStamp,originalEvent:r};var ye=class{constructor(){this.listeners=new Map}on(t,e){let s=this.listeners.get(t)??new Set;return s.add(e),this.listeners.set(t,s),()=>{s.delete(e)}}emit(t,e){let s=this.listeners.get(t);if(s)for(let n of s)n(e)}clear(){this.listeners.clear()}};var xe=class{constructor(t){this.deps=t;this.emitter=new ye;this.bindingEngine=new U;this.stepBindingEngine=new U;this.currentStepIndex=-1;this.previousStepIndex=-1;this.lastError=null;this.failedStepIndex=null;this.executionContext={};let e={...Be(),...t.actionHandlers??{}};this.actionEngine=new fe(e),this.steps=t.ast.steps??[]}async init(t){if(t&&this.emitter.emit("render",t),this.deps.ast.bindings?.length&&this.bindingEngine.bind(this.deps.ast.bindings,{diagram:this.deps.diagram,actionEngine:this.actionEngine,errorPolicy:this.deps.errorPolicy,controller:this,camera:this.deps.camera,overlay:this.deps.overlay,onError:e=>this.emitActionError(e)}),this.steps.length>0&&await this.goto(0),this.deps.hooks?.onInit)try{await this.deps.hooks.onInit(this)}catch(e){console.warn("[MermaidController] onInit hook error:",e)}}async next(){await this.goto(this.currentStepIndex+1)}async prev(){await this.goto(this.currentStepIndex-1)}async goto(t){let e=typeof t=="number"?t:this.steps.findIndex(p=>p.id===t);if(e<0||e>=this.steps.length)return;let s=this.steps[e],n=s.errorPolicy??this.deps.errorPolicy;this.previousStepIndex=this.currentStepIndex;let o=this.previousStepIndex>=0?this.steps[this.previousStepIndex]:void 0;this.executionContext.previousStep=o,this.executionContext.currentStep=s,this.stepBindingEngine.destroy(),this.deps.overlay?.clear&&this.deps.overlay.clear();let i=s.actions.length>0&&(s.actions[0].type==="camera.fit"||s.actions[0].type==="camera.reset"||s.actions[0].type==="camera.fitAll");this.deps.camera&&!i&&this.deps.camera.reset(),await this.actionEngine.run([{type:"style.clear"}],{controller:this,diagram:this.deps.diagram,camera:this.deps.camera,overlay:this.deps.overlay},"continueOnError"),await new Promise(p=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>p())})});let a=[],l=!1;try{for(let u of s.actions){this.executionContext.currentAction=u;let d={action:{...u},step:{...s},context:this.getExecutionContext()};if(this.emitter.emit("actionstart",d),this.deps.hooks?.onActionStart)try{this.deps.hooks.onActionStart(u,s)}catch(m){console.warn("[MermaidController] onActionStart hook error:",m)}}let p=await this.actionEngine.run(s.actions,{controller:this,diagram:this.deps.diagram,camera:this.deps.camera,overlay:this.deps.overlay},n);a=p;for(let u of s.actions){let d=p.find(D=>D instanceof Error&&D.message.includes(u.type)),m={success:!d,error:d},f={action:{...u},result:m,step:{...s},context:this.getExecutionContext()};if(this.emitter.emit("actioncomplete",f),this.deps.hooks?.onActionComplete)try{this.deps.hooks.onActionComplete(u,m)}catch(D){console.warn("[MermaidController] onActionComplete hook error:",D)}}for(let u of p)this.emitActionError(u,s)}catch(p){l=!0;let u=p instanceof Error?p:new Error(String(p));if(this.lastError=u,this.failedStepIndex=e,this.emitActionError(u,s),n==="haltOnError"){this.currentStepIndex=e,this.emitter.emit("stepchange",{state:this.getState(),previousState:{stepIndex:this.previousStepIndex,stepId:this.steps[this.previousStepIndex]?.id,stepCount:this.steps.length},step:{...s},previousStep:o?{...o}:void 0});return}}!l&&a.length===0&&(this.lastError=null,this.failedStepIndex=null),this.currentStepIndex=e,s.bindings?.length&&this.stepBindingEngine.bind(s.bindings,{diagram:this.deps.diagram,actionEngine:this.actionEngine,errorPolicy:n,controller:this,camera:this.deps.camera,overlay:this.deps.overlay,onError:p=>this.emitActionError(p,s)}),this.executionContext.currentAction=void 0;let c={state:this.getState(),previousState:{stepIndex:this.previousStepIndex,stepId:this.steps[this.previousStepIndex]?.id,stepCount:this.steps.length},step:{...s},previousStep:o?{...o}:void 0};if(this.emitter.emit("stepchange",c),this.deps.hooks?.onStepChange)try{await this.deps.hooks.onStepChange(this.getState(),s)}catch(p){console.warn("[MermaidController] onStepChange hook error:",p)}}async reset(){await this.goto(0)}async retry(){this.failedStepIndex!==null&&this.failedStepIndex>=0?await this.goto(this.failedStepIndex):this.currentStepIndex>=0&&await this.goto(this.currentStepIndex)}clearError(){this.lastError=null,this.failedStepIndex=null}async updateAst(t,e){let s=e?.preserveState??!1,n=this.getState(),o=this.steps[this.currentStepIndex]?.id;if(this.deps.ast=t,this.steps=t.steps??[],this.bindingEngine.destroy(),t.bindings?.length&&this.bindingEngine.bind(t.bindings,{diagram:this.deps.diagram,actionEngine:this.actionEngine,errorPolicy:this.deps.errorPolicy,controller:this,camera:this.deps.camera,overlay:this.deps.overlay,onError:i=>this.emitActionError(i)}),s&&o){let i=this.steps.findIndex(a=>a.id===o);i>=0?(this.currentStepIndex=i,await this.goto(i)):this.steps.length>0?await this.goto(0):this.currentStepIndex=-1}else this.steps.length>0?await this.goto(0):this.currentStepIndex=-1;this.emitter.emit("astchange",{previousState:n,newState:this.getState(),previousSteps:n.stepCount,newSteps:this.steps.length})}destroy(){this.bindingEngine.destroy(),this.stepBindingEngine.destroy(),this.deps.camera?.destroy(),this.deps.overlay?.destroy(),this.deps.diagram.destroy(),this.emitter.clear()}getState(){return{stepIndex:this.currentStepIndex,stepId:this.steps[this.currentStepIndex]?.id,stepCount:this.steps.length,errorState:this.lastError?{hasError:!0,lastError:this.lastError,failedStep:this.failedStepIndex??void 0}:void 0}}getExecutionContext(){return{currentAction:this.executionContext.currentAction?{...this.executionContext.currentAction}:void 0,currentStep:this.executionContext.currentStep?{...this.executionContext.currentStep}:void 0,previousStep:this.executionContext.previousStep?{...this.executionContext.previousStep}:void 0}}async setState(t){if(typeof t.stepIndex=="number"){await this.goto(t.stepIndex);return}typeof t.stepId=="string"&&await this.goto(t.stepId)}on(t,e){return this.emitter.on(t,e)}getDeps(){return{diagram:this.deps.diagram,camera:this.deps.camera,overlay:this.deps.overlay}}getSteps(){return this.steps.map(t=>({...t}))}getCurrentStep(){return this.currentStepIndex<0||this.currentStepIndex>=this.steps.length?null:{...this.steps[this.currentStepIndex]}}getActionEngine(){return this.actionEngine}emitActionError(t,e){this.lastError=t;let s={step:e?{...e}:this.executionContext.currentStep,action:this.executionContext.currentAction},n={error:t,...s,context:this.getExecutionContext()};if(this.emitter.emit("actionerror",n),this.emitter.emit("error",n),this.deps.hooks?.onError)try{this.deps.hooks.onError(t,s)}catch(o){console.warn("[MermaidController] onError hook error:",o)}}};function W(r,t,e){let s=document.createElement("button");s.className="finsteps-control-btn",s.setAttribute("aria-label",t),s.title=t;let o={play:"\u25B6",pause:"\u23F8",prev:"\u25C0",next:"\u25B6",zoomIn:"+",zoomOut:"\u2212",fitAll:"\u229E"}[r]||r;return s.innerHTML=`<span class="finsteps-control-icon">${o}</span>`,s.style.cssText=`
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 50%;
    background: rgba(30, 41, 59, 0.9);
    color: #e2e8f0;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 16px;
    backdrop-filter: blur(8px);
  `,s.addEventListener("mouseenter",()=>{s.style.background="rgba(51, 65, 85, 0.95)",s.style.transform="scale(1.1)"}),s.addEventListener("mouseleave",()=>{s.style.background="rgba(30, 41, 59, 0.9)",s.style.transform="scale(1)"}),s.addEventListener("click",i=>{i.stopPropagation(),e()}),s}function Jn(r){let{controller:t,camera:e,position:s="bottom-right",showPlayPause:n=!0,showPrevNext:o=!0,showZoomControls:i=!0,showStepIndicator:a=!0,autoHide:l=!1,offset:c={x:20,y:20}}=r,p=document.createElement("div");p.className="finsteps-floating-controls",p.style.cssText=`
    position: fixed;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    background: rgba(15, 23, 42, 0.85);
    backdrop-filter: blur(12px);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    pointer-events: auto;
  `;let u={"bottom-right":{bottom:`${c.y}px`,right:`${c.x}px`},"bottom-left":{bottom:`${c.y}px`,left:`${c.x}px`},"top-right":{top:`${c.y}px`,right:`${c.x}px`},"top-left":{top:`${c.y}px`,left:`${c.x}px`},"bottom-center":{bottom:`${c.y}px`,left:"50%",transform:"translateX(-50%)"}};Object.assign(p.style,u[s]||u["bottom-right"]);let d=document.createElement("div");d.className="finsteps-control-group",d.style.cssText=`
    display: flex;
    gap: 8px;
    align-items: center;
  `;let m=!1,f=null,D=()=>{f&&(clearInterval(f),f=null),m=!1,h()},k=()=>{(t.getSteps?.()||[]).length!==0&&(m=!0,h(),f=setInterval(()=>{let S=t.getState();S.stepIndex<S.stepCount-1?t.next().catch(()=>D()):D()},3e3))},w=n?W("play","Play/Pause",()=>{m?D():k()}):null,h=()=>{if(!w)return;let A=w.querySelector(".finsteps-control-icon");A&&(A.textContent=m?"\u23F8":"\u25B6"),w.title=m?"Pause":"Play"},b=o?W("prev","Previous Step",()=>{D(),t.prev().catch(()=>{})}):null,y=o?W("next","Next Step",()=>{D(),t.next().catch(()=>{})}):null;b&&d.appendChild(b),w&&d.appendChild(w),y&&d.appendChild(y);let E=a?document.createElement("div"):null;if(E&&(E.className="finsteps-step-indicator",E.style.cssText=`
      padding: 6px 12px;
      background: rgba(30, 41, 59, 0.9);
      border-radius: 8px;
      color: #94a3b8;
      font-size: 12px;
      font-family: monospace;
      text-align: center;
      min-width: 80px;
    `,d.appendChild(E)),p.appendChild(d),i&&e){let A=document.createElement("div");A.className="finsteps-control-group",A.style.cssText=`
      display: flex;
      gap: 8px;
      align-items: center;
      border-top: 1px solid rgba(51, 65, 85, 0.5);
      padding-top: 8px;
    `;let S=W("zoomOut","Zoom Out",()=>{e.zoom&&e.zoom(.8)}),N=W("zoomIn","Zoom In",()=>{e.zoom&&e.zoom(1.2)}),g=W("fitAll","Fit All",()=>{e.fitAll&&e.fitAll()});A.appendChild(S),A.appendChild(N),A.appendChild(g),p.appendChild(A)}document.body.appendChild(p);let T=A=>{E&&(E.textContent=`Step ${A.stepIndex+1} / ${A.stepCount}`),b&&(b.disabled=A.stepIndex<=0,b.style.opacity=A.stepIndex<=0?"0.5":"1",b.style.cursor=A.stepIndex<=0?"not-allowed":"pointer"),y&&(y.disabled=A.stepIndex>=A.stepCount-1,y.style.opacity=A.stepIndex>=A.stepCount-1?"0.5":"1",y.style.cursor=A.stepIndex>=A.stepCount-1?"not-allowed":"pointer"),m&&A.stepIndex>=A.stepCount-1&&D()},M=t.on("stepchange",A=>{A&&typeof A=="object"&&"state"in A?T(A.state):A&&typeof A=="object"&&"stepIndex"in A&&T(A)});T(t.getState());let V=null;if(l){let A=()=>{V&&clearTimeout(V),p.style.opacity="1",V=setTimeout(()=>{p.style.opacity="0.3"},3e3)};p.addEventListener("mouseenter",()=>{p.style.opacity="1",V&&clearTimeout(V)}),p.addEventListener("mouseleave",A),A()}return{show(){p.style.display="flex"},hide(){p.style.display="none"},updateState:T,destroy(){D(),M(),V&&clearTimeout(V),p.remove()}}}var ts=r=>{let t=r.parentElement??document.body;return{getRoot:()=>r,getContainer:()=>t,resolveTarget:e=>F({getRoot:()=>r},e),destroy:()=>{r.remove()}}},ns=()=>({fit:()=>{},reset:()=>{},destroy:()=>{}}),ss=()=>({showBubble:()=>{},hideBubble:()=>{},destroy:()=>{}});var Je=new Set(["mpd","deck","meta","let","use","diagram","mermaid","config","assets","runtime","camera","overlay","navigation","performance","selectors","styles","scene","step","as","focus","pad","align","lock","id","do","assert","else","binding","priority","on","target","when","node","edge","subgraph","css","text","group","union","intersect","except","true","false","null","or","and","viewport","container","svg","engine","options","bounds","strategy","fallback","classes","spotlight","theme","keys","wheelZoom","dragPan","tapToAdvance","progressUI","startAt","click","dblclick","hover","mouseenter","mouseleave","wheel","scroll","key","timer","custom","any"]),Me=new Set(["==","!=","<=",">=","<",">","+","-","*","/","%","!"]),Qe=new Set(["{","}","(",")","[","]",":",";",",",".","=","$"]),et=/^[+-]?(?:\d+(?:\.\d+)?|\.\d+)/,tt=/^\d+/,$e=/^[A-Za-z_][A-Za-z0-9_-]*/,nt=/^#[0-9A-Fa-f]{3}(?:[0-9A-Fa-f]{3})?/;function O(r,t){let{line:e,column:s,offset:n}=r;for(let o of t)n+=1,o===`
`?(e+=1,s=1):s+=1;return{line:e,column:s,offset:n}}function st(r,t){return{start:r,end:t}}function _e(r){let t=[],e=[],s={offset:0,line:1,column:1},n=0,o=(i,a,l,c,p,u)=>{t.push({type:i,value:a,start:c,end:p,image:l,heredoc:u})};for(;n<r.length;){let i=r[n];if(i===" "||i==="	"||i==="\r"||i===`
`){let u=/^[ \t\r\n]+/.exec(r.slice(n));if(u){let d=u[0];s=O(s,d),n+=d.length;continue}}if(i==="#"||i==="/"&&r[n+1]==="/"){let u=/^(#|\/\/)[^\n\r]*/.exec(r.slice(n));if(u){let d=u[0];s=O(s,d),n+=d.length;continue}}if(r.startsWith("<<<",n)){let u=at(r,n);if(u){let{image:d,tag:m,body:f}=u,D=s,k=O(s,d);o("heredoc",d,d,D,k,{tag:m,body:f}),s=k,n+=d.length;continue}}if(i==='"'||i==="'"){let{image:u,value:d}=rt(r,n,s,e),m=s,f=O(s,u);o("string",d,u,m,f),s=f,n+=u.length;continue}if(i==="#"){let u=nt.exec(r.slice(n));if(u){let d=u[0],m=s,f=O(s,d);o("color",d,d,m,f),s=f,n+=d.length;continue}}let a=et.exec(r.slice(n));if(a){let u=a[0],d=r.slice(n+u.length),m=/^(ms|s|m)/.exec(d);if(m){let k=u+m[0],w=s,h=O(s,k);o("duration",k,k,w,h),s=h,n+=k.length;continue}if(d.startsWith("%")){let k=`${u}%`,w=s,h=O(s,k);o("percent",k,k,w,h),s=h,n+=k.length;continue}let f=s,D=O(s,u);o("number",u,u,f,D),s=D,n+=u.length;continue}let l=tt.exec(r.slice(n));if(l){let u=l[0],d=s,m=O(s,u);o("int",u,u,d,m),s=m,n+=u.length;continue}let c=$e.exec(r.slice(n));if(c){let u=c[0],d=s,m=O(s,u);u==="true"||u==="false"?o("boolean",u,u,d,m):u==="null"?o("null",u,u,d,m):Je.has(u)?o("keyword",u,u,d,m):o("identifier",u,u,d,m),s=m,n+=u.length;continue}let p=r.slice(n,n+2);if(Me.has(p)){let u=s,d=O(s,p);o("operator",p,p,u,d),s=d,n+=p.length;continue}if(Me.has(i)){let u=s,d=O(s,i);o("operator",i,i,u,d),s=d,n+=1;continue}if(Qe.has(i)){let u=s,d=O(s,i);o("punct",i,i,u,d),s=d,n+=1;continue}e.push({message:`Unexpected character '${i}'.`,severity:"error",span:st(s,O(s,i)),code:"lex/unexpected-character"}),s=O(s,i),n+=1}return t.push({type:"eof",value:"<eof>",start:s,end:s,image:""}),{tokens:t,diagnostics:e}}function rt(r,t,e,s){let n=r[t],o=t+1,i="";for(;o<r.length;){let l=r[o];if(l===n)return{image:r.slice(t,o+1),value:i};if(l==="\\"){let c=r[o+1];if(c==="n"){i+=`
`,o+=2;continue}if(c==="t"){i+="	",o+=2;continue}if(c==="r"){i+="\r",o+=2;continue}if(c===n){i+=n,o+=2;continue}i+=c??"",o+=2;continue}i+=l,o+=1}let a=r.slice(t,o);return s.push({message:"Unterminated string literal.",severity:"error",span:{start:e,end:O(e,a)},code:"lex/unterminated-string"}),{image:a,value:i}}function at(r,t){let e=$e.exec(r.slice(t+3));if(!e)return null;let s=e[0],n=t+3+s.length;if(r[n]!==`
`)return null;let i=`
${s}>>>`,a=r.indexOf(i,n+1);if(a===-1)return null;let l=r.slice(t,a+i.length),c=r.slice(n+1,a);return{image:l,tag:s,body:c}}var Re="1.0";function Ne(r){let t=_e(r),e=new Ae(r,t.tokens,t.diagnostics),s=e.parseProgram(),n=e.diagnostics;return s&&n.push(...it(s)),{ast:s,diagnostics:n}}var Ee=class Ee{constructor(t,e,s){this.source=t;this.tokens=e;this.index=0;this.diagnostics=s.slice()}parseProgram(){let t=this.peek();if(!this.consumeKeyword("mpd"))return null;let e=this.parseVersion();if(!e)return null;let s=[];if(this.matchKeyword("deck")){let o=this.parseDeck();o&&s.push(o)}else for(;!this.isAtEnd();){let o=this.parseTopLevelItem();if(!o)break;s.push(o)}let n=this.previous();return{type:"Program",version:e.value,body:s,span:x(t,n)}}parseDeck(){let t=this.consumeKeyword("deck");if(!t)return null;let e=this.parseOptionalName(),{items:s,end:n}=this.parseBlock(()=>this.parseDeckItem());return{type:"Deck",name:e??void 0,items:s,span:x(t,n)}}parseTopLevelItem(){return this.parseDeckItemInternal(!0)}parseDeckItem(){return this.parseDeckItemInternal(!1)}parseDeckItemInternal(t){if(this.isAtEnd())return null;let e=this.peek();if(e.type==="keyword"){let s=Ee.KEYWORD_ITEM_PARSERS[e.value];if(s)return s(this)}return e.type==="identifier"?this.parseUnknownBlock():(t&&this.error(e,"top-level declaration"),null)}parseUnknownBlock(){let t=this.consume("identifier");if(!t)return null;let e=this.consumePunct("{");if(!e)return null;let s=1;for(;!this.isAtEnd()&&s>0;){let i=this.peek();i.type==="punct"&&i.value==="{"?s+=1:i.type==="punct"&&i.value==="}"&&(s-=1),this.advance()}let n=this.previous(),o=this.source.slice(e.start.offset,n.end.offset);return{type:"UnknownBlock",name:t.value,content:o,span:x(t,n)}}parseMetaDecl(){let t=this.consumeKeyword("meta");if(!t)return null;let e=[];for(this.consumePunct("{");!this.isAtEnd()&&!this.matchPunct("}");){let n=this.parseMetaEntry();n&&e.push(n),this.matchPunct(",")&&this.consumePunct(",")}let s=this.consumePunct("}")??this.previous();return{type:"MetaDecl",entries:e,span:x(t,s)}}parseMetaEntry(){let t=this.consume("identifier");if(!t)return null;this.consumePunct(":");let e=this.parseExpr();return e?{type:"MetaEntry",key:t.value,value:e,span:x(t,this.previous())}:null}parseConstDecl(){let t=this.consumeKeyword("let");if(!t)return null;let e=this.consume("identifier");if(!e)return null;this.consumePunct("=");let s=this.parseExpr();return this.consumePunct(";"),{type:"ConstDecl",name:e.value,value:s??this.emptyLiteral(e),span:x(t,this.previous())}}parsePluginDecl(){let t=this.consumeKeyword("use");if(!t)return null;let e=this.parseName(),s;return this.peek().type==="punct"&&this.peek().value==="{"&&(s=this.parseObjectExpr()),this.consumePunct(";"),{type:"PluginDecl",ref:e,options:s,span:x(t,this.previous())}}parseDiagramDecl(){let t=this.consumeKeyword("diagram");if(!t)return null;let e=this.parseName(),{items:s,end:n}=this.parseBlock(()=>this.parseDiagramItem());return{type:"DiagramDecl",id:e,items:s.filter(o=>o!==null),span:x(t,n)}}parseDiagramItem(){let t=this.peek();if(t.type==="keyword")switch(t.value){case"mermaid":return this.parseMermaidSourceDecl();case"config":return this.parseMermaidConfigDecl();case"assets":return this.parseDiagramAssetsDecl();case"meta":return this.parseMetaDecl();default:break}return null}parseMermaidSourceDecl(){let t=this.consumeKeyword("mermaid");if(!t)return null;let e=this.consume("heredoc");return!e||!e.heredoc?null:(this.consumePunct(";"),{type:"MermaidSourceDecl",source:e.heredoc.body,tag:e.heredoc.tag,span:x(t,this.previous())})}parseMermaidConfigDecl(){let t=this.consumeKeyword("config");if(!t)return null;let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"MermaidConfigDecl",config:e,span:x(t,this.previous())}}parseDiagramAssetsDecl(){let t=this.consumeKeyword("assets");if(!t)return null;let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"DiagramAssetsDecl",assets:e,span:x(t,this.previous())}}parseRuntimeDecl(){let t=this.consumeKeyword("runtime");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseRuntimeItem());return{type:"RuntimeDecl",items:e.filter(n=>n!==null),span:x(t,s)}}parseRuntimeItem(){let t=this.peek();if(t.type==="keyword")switch(t.value){case"camera":return this.parseCameraDecl();case"overlay":return this.parseOverlayDecl();case"navigation":return this.parseNavigationDecl();case"controls":return this.parseControlsDecl();case"performance":return this.parsePerformanceDecl();case"meta":return this.parseMetaDecl();default:break}return null}parseCameraDecl(){let t=this.consumeKeyword("camera");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseCameraItem());return{type:"CameraDecl",items:e.filter(n=>n!==null),span:x(t,s)}}parseCameraItem(){if(this.matchKeyword("engine")){let t=this.consumeKeyword("engine");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"CameraEngine",name:e,span:x(t,this.previous())}}if(this.matchKeyword("options")){let t=this.consumeKeyword("options");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"CameraOptions",options:e,span:x(t,this.previous())}}if(this.matchKeyword("bounds")){let t=this.consumeKeyword("bounds");this.consumePunct(":");let s=this.consume("keyword")?.value??"viewport";return this.consumePunct(";"),{type:"CameraBounds",bounds:s,span:x(t,this.previous())}}return null}parseOverlayDecl(){let t=this.consumeKeyword("overlay");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseOverlayItem());return{type:"OverlayDecl",items:e.filter(n=>n!==null),span:x(t,s)}}parseOverlayItem(){if(this.matchKeyword("engine")){let t=this.consumeKeyword("engine");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"OverlayEngine",name:e,span:x(t,this.previous())}}if(this.matchKeyword("options")){let t=this.consumeKeyword("options");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"OverlayOptions",options:e,span:x(t,this.previous())}}return null}parseNavigationDecl(){let t=this.consumeKeyword("navigation");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseNavigationItem());return{type:"NavigationDecl",items:e.filter(n=>n!==null),span:x(t,s)}}parseNavigationItem(){if(this.matchKeyword("keys")){let t=this.consumeKeyword("keys");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"NavigationKeys",options:e,span:x(t,this.previous())}}if(this.matchKeyword("wheelZoom")){let t=this.consumeKeyword("wheelZoom");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"NavigationWheelZoom",value:e,span:x(t,this.previous())}}if(this.matchKeyword("dragPan")){let t=this.consumeKeyword("dragPan");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"NavigationDragPan",value:e,span:x(t,this.previous())}}if(this.matchKeyword("tapToAdvance")){let t=this.consumeKeyword("tapToAdvance");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"NavigationTapToAdvance",value:e,span:x(t,this.previous())}}if(this.matchKeyword("progressUI")){let t=this.consumeKeyword("progressUI");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"NavigationProgressUI",value:e,span:x(t,this.previous())}}if(this.matchKeyword("startAt")){let t=this.consumeKeyword("startAt");this.consumePunct(":");let e=this.peek(),s=0;return e.type==="int"||e.type==="number"?(this.advance(),s=Number(e.value)):e.type==="string"?(this.advance(),s=e.value):this.error(e,"number or string"),this.consumePunct(";"),{type:"NavigationStartAt",value:s,span:x(t,this.previous())}}return null}parseControlsDecl(){let t=this.consumeKeyword("controls");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseControlsItem());return{type:"ControlsDecl",items:e.filter(n=>n!==null),span:x(t,s)}}parseControlsItem(){if(this.matchKeyword("mode")){let t=this.consumeKeyword("mode");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"ControlsMode",mode:e??{type:"Name",value:"floating",kind:"identifier",span:x(t,this.previous())},span:x(t,this.previous())}}if(this.matchKeyword("position")){let t=this.consumeKeyword("position");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"ControlsPosition",position:e??{type:"Name",value:"bottom-right",kind:"identifier",span:x(t,this.previous())},span:x(t,this.previous())}}if(this.matchKeyword("showPlayPause")){let t=this.consumeKeyword("showPlayPause");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsShowPlayPause",value:e,span:x(t,this.previous())}}if(this.matchKeyword("showPrevNext")){let t=this.consumeKeyword("showPrevNext");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsShowPrevNext",value:e,span:x(t,this.previous())}}if(this.matchKeyword("showZoomControls")){let t=this.consumeKeyword("showZoomControls");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsShowZoomControls",value:e,span:x(t,this.previous())}}if(this.matchKeyword("showStepIndicator")){let t=this.consumeKeyword("showStepIndicator");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsShowStepIndicator",value:e,span:x(t,this.previous())}}if(this.matchKeyword("autoHide")){let t=this.consumeKeyword("autoHide");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsAutoHide",value:e,span:x(t,this.previous())}}if(this.matchKeyword("offset")){let t=this.consumeKeyword("offset");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"ControlsOffset",offset:e,span:x(t,this.previous())}}return null}parsePerformanceDecl(){let t=this.consumeKeyword("performance");if(!t)return null;let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"PerformanceDecl",options:e,span:x(t,this.previous())}}parseSelectorsDecl(){let t=this.consumeKeyword("selectors");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseSelectorsItem());return{type:"SelectorsDecl",items:e.filter(n=>n!==null),span:x(t,s)}}parseSelectorsItem(){if(this.matchKeyword("strategy")){let t=this.consumeKeyword("strategy");this.consumePunct(":");let s=this.consume("keyword")?.value??"css";return this.consumePunct(";"),{type:"SelectorsStrategy",strategy:s,span:x(t,this.previous())}}if(this.matchKeyword("fallback")){let t=this.consumeKeyword("fallback");this.consumePunct(":");let e=this.parseArrayExpr();return this.consumePunct(";"),{type:"SelectorsFallback",fallback:e,span:x(t,this.previous())}}if(this.matchKeyword("node")){let t=this.consumeKeyword("node");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"SelectorsNode",spec:e,span:x(t,this.previous())}}if(this.matchKeyword("edge")){let t=this.consumeKeyword("edge");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"SelectorsEdge",spec:e,span:x(t,this.previous())}}if(this.matchKeyword("subgraph")){let t=this.consumeKeyword("subgraph");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"SelectorsSubgraph",spec:e,span:x(t,this.previous())}}return this.matchKeyword("meta")?this.parseMetaDecl():null}parseStylesDecl(){let t=this.consumeKeyword("styles");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseStylesItem());return{type:"StylesDecl",items:e.filter(n=>n!==null),span:x(t,s)}}parseStylesItem(){if(this.matchKeyword("classes")){let t=this.consumeKeyword("classes");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"StylesClasses",classes:e,span:x(t,this.previous())}}if(this.matchKeyword("spotlight")){let t=this.consumeKeyword("spotlight");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"StylesSpotlight",spotlight:e,span:x(t,this.previous())}}if(this.matchKeyword("theme")){let t=this.consumeKeyword("theme");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"StylesTheme",theme:e,span:x(t,this.previous())}}return this.matchKeyword("meta")?this.parseMetaDecl():null}parseSceneDecl(){let t=this.consumeKeyword("scene");if(!t)return null;let e=this.parseName(),s;this.matchKeyword("diagram")&&(this.consumeKeyword("diagram"),s=this.parseName());let{items:n,end:o}=this.parseBlock(()=>this.parseSceneItem());return{type:"SceneDecl",name:e,diagram:s,items:n.filter(i=>i!==null),span:x(t,o)}}parseSceneItem(){let t=this.peek();if(t.type==="keyword")switch(t.value){case"step":return this.parseStepDecl();case"binding":return this.parseBindingDecl();case"meta":return this.parseMetaDecl();case"let":return this.parseConstDecl();default:break}return null}parseStepDecl(){let t=this.consumeKeyword("step");if(!t)return null;let e=this.parseName(),s;this.matchKeyword("as")&&(this.consumeKeyword("as"),s=this.consume("identifier")?.value);let{items:n,end:o}=this.parseBlock(()=>this.parseStepStmt());return{type:"StepDecl",name:e,alias:s,statements:n.filter(i=>i!==null),span:x(t,o)}}parseStepStmt(){let t=this.peek();if(t.type==="keyword")switch(t.value){case"focus":return this.parseFocusStmt();case"do":return this.parseDoStmt();case"let":return this.parseLetStmt();case"assert":return this.parseAssertStmt();case"meta":return this.parseMetaDecl();default:break}if(t.type==="identifier"||t.type==="keyword"){if(t.type==="keyword"&&(t.value==="focus"||t.value==="let"||t.value==="assert"||t.value==="meta"))return null;let e=this.parseActionCall();if(e)return{type:"DoStmt",action:e,span:e.span}}return null}parseFocusStmt(){let t=this.consumeKeyword("focus");if(!t)return null;let e=this.parseTargetExpr(),s={};for(;;){if(this.matchKeyword("pad")){this.consumeKeyword("pad");let n=this.parseNumber();s.pad=n;continue}if(this.matchKeyword("align")){this.consumeKeyword("align");let n=this.consume("keyword");s.align=n?.value??"center";continue}if(this.matchKeyword("lock")){this.consumeKeyword("lock");let n=this.consume("keyword");s.lock=n?.value??"none";continue}if(this.matchKeyword("id")){this.consumeKeyword("id");let n=this.consume("identifier");n&&(s.id=n.value);continue}break}return this.consumePunct(";"),{type:"FocusStmt",target:e??this.emptyTarget(t),options:s,span:x(t,this.previous())}}parseDoStmt(){let t=this.consumeKeyword("do");if(!t)return null;let e=this.parseActionCall();return this.consumePunct(";"),{type:"DoStmt",action:e??this.emptyAction(t),span:x(t,this.previous())}}parseLetStmt(){let t=this.consumeKeyword("let");if(!t)return null;let e=this.consume("identifier");this.consumePunct("=");let s=this.parseExpr();return this.consumePunct(";"),{type:"LetStmt",name:e?.value??"",value:s??this.emptyLiteral(t),span:x(t,this.previous())}}parseAssertStmt(){let t=this.consumeKeyword("assert");if(!t)return null;let e=this.parseExpr(),s;return this.matchKeyword("else")&&(this.consumeKeyword("else"),s=this.consume("string")?.value),this.consumePunct(";"),{type:"AssertStmt",condition:e??this.emptyLiteral(t),message:s,span:x(t,this.previous())}}parseBindingDecl(){let t=this.consumeKeyword("binding");if(!t)return null;let e;(this.peek().type==="identifier"||this.peek().type==="string")&&(e=this.parseName());let s;if(this.matchKeyword("priority")){this.consumeKeyword("priority");let i=this.consume("int");s=i?Number(i.value):void 0,this.consumePunct(";")}let{items:n,end:o}=this.parseBlock(()=>this.parseBindingRule());return{type:"BindingDecl",name:e,priority:s,rules:n.filter(i=>i!==null),span:x(t,o)}}parseBindingRule(){let t=this.consumeKeyword("on");if(!t)return null;let e=this.parseEventSpec(),s;this.matchKeyword("target")&&(this.consumeKeyword("target"),this.matchKeyword("any")?(this.consumeKeyword("any"),s="any"):s=this.parseTargetExpr()??void 0);let n;this.matchKeyword("when")&&(this.consumeKeyword("when"),n=this.parseExpr()??void 0);let{items:o,end:i}=this.parseBlock(()=>this.parseBindingStmt());return{type:"BindingRule",event:e??this.emptyEvent(t),target:s,when:n,statements:o.filter(a=>a!==null),span:x(t,i)}}parseBindingStmt(){return this.matchKeyword("do")?this.parseDoStmt():this.matchKeyword("let")?this.parseLetStmt():this.matchKeyword("assert")?this.parseAssertStmt():null}parseEventSpec(){let t=this.consume("keyword");if(!t)return null;if(t.value==="key")return{type:"EventSpec",kind:"key",value:this.consume("string")?.value,span:x(t,this.previous())};if(t.value==="timer"){let e=this.consume("duration");return{type:"EventSpec",kind:"timer",value:e?Oe(e.value):void 0,span:x(t,this.previous())}}return t.value==="custom"?{type:"EventSpec",kind:"custom",value:this.parseName().value,span:x(t,this.previous())}:{type:"EventSpec",kind:t.value,span:x(t,t)}}parseActionCall(){let t=this.peek(),e=[],s=this.consumeNamePart();if(!s)return null;for(e.push(s.value);!this.isAtEnd();){if(this.matchPunct(".")){this.consumePunct(".");let i=this.consumeNamePart();i&&e.push(i.value);continue}let o=this.peek();if(o.type==="identifier"||o.type==="keyword"){let i=this.peekNext();if(i.type==="punct"&&i.value==="("){let l=this.consumeNamePart();l&&e.push(l.value);break}let a=this.consumeNamePart();a&&e.push(a.value);continue}break}this.consumePunct("(");let n=[];if(!this.matchPunct(")"))do{let o=this.parseActionArg();o&&n.push(o)}while(this.matchPunct(",")&&this.advance());return this.consumePunct(")"),{type:"ActionCall",name:e.join(" "),args:n,span:x(t,this.previous())}}parseActionArg(){let t=this.peek(),e=this.peek();if((e.type==="identifier"||e.type==="keyword")&&this.peekNext().type==="punct"&&this.peekNext().value===":"){let n=this.advance();this.consumePunct(":");let o=this.parseExpr();return{type:"ActionArg",key:n?.value,value:o??this.emptyLiteral(t),span:x(t,this.previous())}}return{type:"ActionArg",value:this.parseExpr()??this.emptyLiteral(t),span:x(t,this.previous())}}parseExpr(){return this.parseOrExpr()}parseOrExpr(){let t=this.parseAndExpr();for(;this.matchKeyword("or");){let e=this.consumeKeyword("or"),s=this.parseAndExpr();t={type:"BinaryExpr",operator:"or",left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:x(e,this.previous())}}return t}parseAndExpr(){let t=this.parseEqExpr();for(;this.matchKeyword("and");){let e=this.consumeKeyword("and"),s=this.parseEqExpr();t={type:"BinaryExpr",operator:"and",left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:x(e,this.previous())}}return t}parseEqExpr(){let t=this.parseRelExpr();for(;this.matchOperator("==")||this.matchOperator("!=");){let e=this.consume("operator"),s=this.parseRelExpr();t={type:"BinaryExpr",operator:e.value,left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:x(e,this.previous())}}return t}parseRelExpr(){let t=this.parseAddExpr();for(;this.matchOperator("<")||this.matchOperator("<=")||this.matchOperator(">")||this.matchOperator(">=");){let e=this.consume("operator"),s=this.parseAddExpr();t={type:"BinaryExpr",operator:e.value,left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:x(e,this.previous())}}return t}parseAddExpr(){let t=this.parseMulExpr();for(;this.matchOperator("+")||this.matchOperator("-");){let e=this.consume("operator"),s=this.parseMulExpr();t={type:"BinaryExpr",operator:e.value,left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:x(e,this.previous())}}return t}parseMulExpr(){let t=this.parseUnaryExpr();for(;this.matchOperator("*")||this.matchOperator("/")||this.matchOperator("%");){let e=this.consume("operator"),s=this.parseUnaryExpr();t={type:"BinaryExpr",operator:e.value,left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:x(e,this.previous())}}return t}parseUnaryExpr(){if(this.matchOperator("!")||this.matchOperator("-")){let t=this.consume("operator"),e=this.parseUnaryExpr();return{type:"UnaryExpr",operator:t.value,argument:e??this.emptyLiteral(t),span:x(t,this.previous())}}return this.parsePrimaryExpr()}parsePrimaryExpr(){let t=this.peek();if(t.type==="number"||t.type==="int"||t.type==="duration"||t.type==="percent"||t.type==="boolean"||t.type==="null"||t.type==="string"||t.type==="color")return this.advance(),this.literalFromToken(t);if(t.type==="punct"&&t.value==="{")return this.parseObjectExpr();if(t.type==="punct"&&t.value==="[")return this.parseArrayExpr();if(t.type==="punct"&&t.value==="("){let e=this.consumePunct("("),s=this.parseExpr();return this.consumePunct(")"),s?{...s,span:x(e,this.previous())}:null}return t.type==="punct"&&t.value==="$"?this.parseVarRef():this.isTargetKeyword(t)?this.parseTargetExpr():t.type==="identifier"?this.parseCallExpr():null}parseVarRef(){let t=this.consumePunct("$"),e=[],s=this.consume("identifier");for(s&&e.push(s.value);this.matchPunct(".");){this.consumePunct(".");let n=this.consume("identifier");n&&e.push(n.value)}return{type:"VarRef",path:e,span:x(t,this.previous())}}parseCallExpr(){let t=this.peek(),e=this.consume("identifier");if(!e)return null;this.consumePunct("(");let s=[];if(!this.matchPunct(")"))do{let n=this.parseActionArg();n&&s.push(n)}while(this.matchPunct(",")&&this.advance());return this.consumePunct(")"),{type:"CallExpr",name:e.value,args:s,span:x(t,this.previous())}}parseObjectExpr(){let t=this.consumePunct("{"),e=[];if(!this.matchPunct("}"))do{let s=this.peek(),n=s.type==="identifier"||s.type==="keyword"?this.advance():this.consume("string");if(!n)break;this.consumePunct(":");let o=this.parseExpr(),i=n.type==="string"?n.value.slice(1,-1):n.value;e.push({type:"ObjectEntry",key:i,value:o??this.emptyLiteral(n),span:x(n,this.previous())})}while(this.matchPunct(",")&&this.advance());return this.consumePunct("}"),{type:"ObjectExpr",entries:e,span:x(t,this.previous())}}parseArrayExpr(){let t=this.consumePunct("["),e=[];if(!this.matchPunct("]"))do{let s=this.parseExpr();s&&e.push(s)}while(this.matchPunct(",")&&this.advance());return this.consumePunct("]"),{type:"ArrayExpr",items:e,span:x(t,this.previous())}}parseTargetExpr(){let t=this.peek();if(!this.isTargetKeyword(t))return this.error(t,"target expression"),null;let e=this.consume("keyword");if(!e)return null;switch(e.value){case"node":return this.parseTargetUnary(e,"TargetNode",()=>this.parseNodeRef());case"edge":return this.parseTargetUnary(e,"TargetEdge",()=>this.parseEdgeRef());case"subgraph":return this.parseTargetUnary(e,"TargetSubgraph",()=>this.parseSubgraphRef());case"css":return this.parseTargetString(e,"TargetCss");case"id":return this.parseTargetString(e,"TargetId");case"text":return this.parseTargetString(e,"TargetText");case"group":return this.parseTargetList(e,"TargetGroup");case"union":return this.parseTargetList(e,"TargetUnion");case"intersect":return this.parseTargetList(e,"TargetIntersect");case"except":return this.parseTargetExcept(e);default:return null}}parseTargetUnary(t,e,s){this.consumePunct("(");let n=s();return this.consumePunct(")"),{type:e,ref:n,span:x(t,this.previous())}}parseTargetString(t,e){this.consumePunct("(");let s=this.consume("string");this.consumePunct(")");let n=s?.value??"";return e==="TargetCss"?{type:"TargetCss",selector:n,span:x(t,this.previous())}:e==="TargetId"?{type:"TargetId",id:n,span:x(t,this.previous())}:{type:"TargetText",text:n,span:x(t,this.previous())}}parseTargetList(t,e){this.consumePunct("(");let s=[];if(!this.matchPunct(")"))do{let o=this.parseTargetExpr();o&&s.push(o)}while(this.matchPunct(",")&&this.advance());return this.consumePunct(")"),{type:e,targets:s,span:x(t,this.previous())}}parseTargetExcept(t){this.consumePunct("(");let e=this.parseTargetExpr();this.consumePunct(",");let s=this.parseTargetExpr();return this.consumePunct(")"),{type:"TargetExcept",left:e??this.emptyTarget(t),right:s??this.emptyTarget(t),span:x(t,this.previous())}}parseNodeRef(){if(this.matchOperator("*"))return this.consume("operator"),"*";if(this.peek().type==="string"){let e=this.consume("string");return this.makeName(e)}let t=this.consume("identifier");return t?this.makeName(t):"*"}parseEdgeRef(){let t=this.peek(),e=this.parseNodeRef();if(this.matchPunct(",")){this.consumePunct(",");let s=this.parseNodeRef();return{from:e,to:s}}return e==="*"?{type:"Name",value:"*",kind:"identifier",span:x(t,this.previous())}:e}parseSubgraphRef(){if(this.matchOperator("*"))return this.consume("operator"),"*";if(this.peek().type==="string"){let e=this.consume("string");return this.makeName(e)}let t=this.consume("identifier");return t?this.makeName(t):"*"}parseQualifiedName(){let t=[],e=this.consumeNamePart();for(e&&t.push(e.value);this.matchPunct(".");){this.consumePunct(".");let s=this.consumeNamePart();s&&t.push(s.value)}return t.join(".")}consumeNamePart(){let t=this.peek();return t.type==="identifier"||t.type==="keyword"?this.advance():(this.error(t,"identifier"),null)}parseName(){let t=this.peek();if(t.type==="string")return this.advance(),{type:"Name",value:t.value,kind:"string",span:x(t,t)};let e=this.consume("identifier");return{type:"Name",value:e?.value??"",kind:"identifier",span:x(e??t,this.previous())}}parseOptionalName(){let t=this.peek();return t.type==="identifier"||t.type==="string"?this.parseName():null}parseNumber(){let t=this.consume("number")??this.consume("int");return t?Number(t.value):0}parseBoolean(){let t=this.consume("boolean");return t?t.value==="true":!1}parseVersion(){let t=this.consume("number")??this.consume("int");if(!t)return null;let e=[t.value];for(;this.matchPunct(".");){this.consumePunct(".");let s=this.consume("number")??this.consume("int");if(!s)break;e.push(s.value)}return{value:e.join("."),end:this.previous()}}parseBlock(t){let e=[],s=this.consumePunct("{");for(;!this.isAtEnd()&&!this.matchPunct("}");){let o=t();o?e.push(o):this.advance()}let n=this.consumePunct("}")??this.previous();return{items:e,end:n??s}}literalFromToken(t){let e=t.value;return t.type==="boolean"?{type:"Literal",literalType:"boolean",value:t.value==="true",raw:e,span:x(t,t)}:t.type==="null"?{type:"Literal",literalType:"null",value:null,raw:e,span:x(t,t)}:t.type==="string"?{type:"Literal",literalType:"string",value:t.value,raw:e,span:x(t,t)}:t.type==="color"?{type:"Literal",literalType:"color",value:t.value,raw:e,span:x(t,t)}:t.type==="duration"?{type:"Literal",literalType:"duration",value:Oe(t.value),raw:e,span:x(t,t)}:t.type==="percent"?{type:"Literal",literalType:"percent",value:Number(t.value.replace("%","")),raw:e,span:x(t,t)}:{type:"Literal",literalType:t.type==="int"?"int":"number",value:Number(t.value),raw:e,span:x(t,t)}}emptyLiteral(t){return{type:"Literal",literalType:"null",value:null,raw:"null",span:x(t,t)}}emptyTarget(t){return{type:"TargetNode",ref:"*",span:x(t,t)}}emptyAction(t){return{type:"ActionCall",name:"",args:[],span:x(t,t)}}emptyEvent(t){return{type:"EventSpec",kind:"click",span:x(t,t)}}makeName(t){return{type:"Name",value:t.value,kind:t.type==="string"?"string":"identifier",span:x(t,t)}}isTargetKeyword(t){return t.type==="keyword"&&["node","edge","subgraph","css","id","text","group","union","intersect","except"].includes(t.value)}matchKeyword(t){let e=this.peek();return e.type==="keyword"&&e.value===t}matchOperator(t){let e=this.peek();return e.type==="operator"&&e.value===t}matchPunct(t){let e=this.peek();return e.type==="punct"&&e.value===t}consumeKeyword(t){let e=this.peek();return e.type==="keyword"&&e.value===t?this.advance():(this.error(e,`keyword '${t}'`),null)}consumePunct(t){let e=this.peek();return e.type==="punct"&&e.value===t?this.advance():(this.error(e,`symbol '${t}'`),null)}consume(t){let e=this.peek();return e.type===t?this.advance():(this.error(e,t),null)}error(t,e){if(t.type==="eof"){this.diagnostics.push({message:`Unexpected end of input, expected ${e}.`,severity:"error",span:x(t,t),code:"parse/unexpected-eof"});return}this.diagnostics.push({message:`Unexpected '${t.image||t.value}', expected ${e}.`,severity:"error",span:x(t,t),code:"parse/unexpected-token"})}advance(){return this.isAtEnd()||(this.index+=1),this.tokens[this.index-1]}peek(){return this.tokens[this.index]}peekNext(){return this.tokens[this.index+1]}previous(){return this.tokens[Math.max(0,this.index-1)]}isAtEnd(){return this.peek().type==="eof"}};Ee.KEYWORD_ITEM_PARSERS={diagram:t=>t.parseDiagramDecl(),runtime:t=>t.parseRuntimeDecl(),selectors:t=>t.parseSelectorsDecl(),styles:t=>t.parseStylesDecl(),let:t=>t.parseConstDecl(),scene:t=>t.parseSceneDecl(),binding:t=>t.parseBindingDecl(),use:t=>t.parsePluginDecl(),meta:t=>t.parseMetaDecl()};var Ae=Ee;function x(r,t){return{start:r.start,end:t.end}}function Oe(r){return r.endsWith("ms")?Number(r.replace("ms","")):r.endsWith("s")?Number(r.replace("s",""))*1e3:r.endsWith("m")?Number(r.replace("m",""))*6e4:Number(r)}function it(r){let t=[];r.version!==Re&&r.version!=="1"&&t.push({message:`MPD version '${r.version}' differs from supported version ${Re}.`,severity:"warning",span:r.span,code:"validate/version-mismatch"});for(let n of r.body){if(n.type==="SceneDecl"){let o=new Set;for(let i of n.items)if(i.type==="StepDecl"){let a=i.name.value;o.has(a)?t.push({message:`Duplicate step name '${a}' in scene '${n.name.value}'.`,severity:"error",span:i.span,code:"validate/duplicate-step"}):o.add(a)}}n.type==="UnknownBlock"&&t.push({message:`Unknown block '${n.name}'.`,severity:"warning",span:n.span,code:"validate/unknown-block"})}let e=n=>{switch(n.type){case"TargetEdge":{let o=n.ref;typeof o=="object"&&(o.from==="*"||o.to==="*")&&t.push({message:"Edge target cannot use '*' in edge tuple.",severity:"error",span:n.span,code:"validate/malformed-target"});break}case"TargetCss":case"TargetId":case"TargetText":{(n.selector??n.id??n.text??"")||t.push({message:"Target string cannot be empty.",severity:"error",span:n.span,code:"validate/malformed-target"});break}case"TargetGroup":case"TargetUnion":case"TargetIntersect":n.targets.forEach(e);break;case"TargetExcept":e(n.left),e(n.right);break;case"BinaryExpr":e(n.left),e(n.right);break;case"UnaryExpr":e(n.argument);break;case"ObjectExpr":n.entries.forEach(o=>e(o.value));break;case"ArrayExpr":n.items.forEach(e);break;case"CallExpr":n.args.forEach(o=>e(o.value));break;case"Literal":case"VarRef":case"TargetNode":case"TargetSubgraph":break;default:break}},s=n=>{if(!n||typeof n!="object")return;switch(n.type){case"StepDecl":{n.statements.forEach(s);break}case"SceneDecl":{n.items.forEach(s);break}case"FocusStmt":e(n.target);break;case"LetStmt":e(n.value);break;case"AssertStmt":e(n.condition);break;case"DoStmt":n.action.args.forEach(i=>e(i.value));break;case"BindingDecl":n.rules.forEach(s);break;case"BindingRule":{let i=n;i.when&&e(i.when),i.statements.forEach(s);break}case"ConstDecl":e(n.value);break;case"MetaDecl":n.entries.forEach(i=>e(i.value));break;default:break}};return r.body.forEach(s),t}function ot(r){return r.length?r.map(t=>{let e=t.span?`(${t.span.start.line}:${t.span.start.column})`:"",s=t.code?` [${t.code}]`:"";return`${t.severity.toUpperCase()}: ${t.message} ${e}${s}`.trim()}).join(`
`):"No diagnostics."}var ct=r=>{if(r.ast)return r.ast;if(r.mpdText&&r.options?.parseMpd)return r.options.parseMpd(r.mpdText);throw new L("presentMermaid requires ast or mpdText with parseMpd","MPF_INVALID_PRESENT_OPTIONS",{hasAst:!!r.ast,hasMpdText:!!r.mpdText,hasParseMpd:!!r.options?.parseMpd})},lt=async r=>{let t=ct(r),s=await(r.options?.diagram??Ve()).render({mountEl:r.mountEl,mermaidText:r.mermaidText}),n=r.options?.camera??Te(s),o=r.options?.overlay??Ie(),i=new xe({diagram:s,camera:n,overlay:o,ast:t,actionHandlers:r.options?.actionHandlers,errorPolicy:r.options?.errorPolicy??"haltOnError",hooks:r.options?.hooks});return await i.init({diagram:s}),r.options?.controls&&r.options.controls.updateState(i.getState()),i};function fs(r){let t=Ne(r),e=t.diagnostics.filter(o=>o.severity==="error"),s=t.diagnostics.filter(o=>o.severity==="warning");return{valid:t.ast!==null&&e.length===0,ast:t.ast,errors:e,warnings:s}}var ys=lt;export{Z as ActionError,L as MPFError,we as ParseError,Te as createBasicCameraHandle,Ie as createBasicOverlayHandle,Jn as createFloatingControls,Ve as createMermaidDiagramAdapter,ns as createMockCameraHandle,ts as createMockDiagramHandle,ss as createMockOverlayHandle,ys as default,ot as formatDiagnostics,Ne as parseMPD,lt as presentMermaid,fs as validateMPD};
