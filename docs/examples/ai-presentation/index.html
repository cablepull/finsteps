<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Finsteps Presentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            padding: 2rem;
        }

        .presentation-area {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .ai-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            height: fit-content;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section h3 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .diagram-container {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            min-height: 400px;
            border: 2px solid #e9ecef;
            margin-bottom: 1rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        textarea, select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .status-indicator {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .prompt-suggestions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .prompt-btn {
            padding: 0.5rem;
            font-size: 0.85rem;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .prompt-btn:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .ai-output {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ü§ñ AI-Powered Finsteps Presentation</h1>
            <p>Generate and enhance presentations using AI assistance</p>
        </header>

        <div class="content">
            <main class="presentation-area">
                <div class="section">
                    <h3>üìä Presentation</h3>
                    <div id="diagram" class="diagram-container"></div>
                    <div class="controls">
                        <button class="btn btn-secondary" id="prev-btn">‚óÄ Previous</button>
                        <button class="btn btn-primary" id="next-btn">Next ‚ñ∂</button>
                        <button class="btn btn-secondary" id="reset-btn">üîÑ Reset</button>
                    </div>
                </div>

                <div class="section">
                    <h3>üìù MPD Code</h3>
                    <textarea id="mpd-code" placeholder="MPD presentation code will appear here...">mpd 1.0
scene default {
  step overview {
    camera reset();
    overlay bubble(target: dataId("Start"), text: "Welcome to our AI-generated presentation!");
  }
  step process {
    camera fit(target: dataId("Process"));
    overlay bubble(target: dataId("Process"), text: "This is the main process step");
  }
  step end {
    camera fit(target: dataId("End"));
    overlay bubble(target: dataId("End"), text: "And we're done!");
  }
}</textarea>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary" id="apply-mpd">Apply MPD Code</button>
                        <button class="btn btn-secondary" id="clear-mpd">Clear</button>
                    </div>
                </div>
            </main>

            <aside class="ai-panel">
                <div class="section">
                    <h3>ü§ñ AI Assistant</h3>
                    <div id="ai-status">
                        <span class="status-indicator status-warning">Initializing...</span>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <label for="model-select">AI Model:</label>
                        <select id="model-select">
                            <option value="">Loading models...</option>
                        </select>
                    </div>

                    <div style="margin-top: 1rem;">
                        <label for="ai-prompt">AI Prompt:</label>
                        <textarea id="ai-prompt" placeholder="Ask AI to generate or modify your presentation...">Generate MPD code for a flowchart about software development lifecycle with overview, design, implementation, and testing steps.</textarea>
                    </div>

                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary" id="generate-btn">üöÄ Generate</button>
                        <button class="btn btn-secondary" id="enhance-btn">‚ú® Enhance</button>
                    </div>

                    <div class="prompt-suggestions">
                        <button class="prompt-btn" data-prompt="Create a flowchart about cloud computing with infrastructure, deployment, and scaling steps">‚òÅÔ∏è Cloud Computing</button>
                        <button class="prompt-btn" data-prompt="Generate a presentation about machine learning workflow with data preparation, training, and evaluation steps">üß† Machine Learning</button>
                        <button class="prompt-btn" data-prompt="Create a timeline presentation about the history of web development from HTML to modern frameworks">üåê Web History</button>
                        <button class="prompt-btn" data-prompt="Generate a process flow for agile software development methodology">üèÉ Agile Process</button>
                    </div>

                    <div id="ai-output" class="ai-output" style="display: none;">
                        <strong>AI Response:</strong>
                        <div id="ai-response-text" style="margin-top: 0.5rem; white-space: pre-wrap;"></div>
                    </div>
                </div>

                <div class="section">
                    <h3>üé® Diagram Code</h3>
                    <textarea id="mermaid-code" placeholder="Mermaid diagram code...">flowchart TD
    A[Start] --> B[Process]
    B --> C[End]</textarea>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-success" id="update-diagram">Update Diagram</button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script type="module">
        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: false, theme: 'dark' });

        // Mock AI system for demo
        const mockAI = {
            models: [
                { id: 'qwen3-coder-30b', name: 'Qwen3 Coder 30B (Local)', provider: 'ollama' },
                { id: 'gpt-4', name: 'GPT-4', provider: 'openai' },
                { id: 'claude-3-sonnet', name: 'Claude 3 Sonnet', provider: 'anthropic' }
            ],

            async generateContent(prompt, model) {
                // Simulate AI generation
                await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1500));
                
                const templates = {
                    'cloud': `mpd 1.0
scene default {
  step overview {
    camera reset();
    overlay bubble(target: dataId("Infrastructure"), text: "Cloud infrastructure foundation");
  }
  step deployment {
    camera fit(target: dataId("Deployment"));
    overlay bubble(target: dataId("Deployment"), text: "Automated deployment pipeline");
  }
  step scaling {
    camera fit(target: dataId("Scaling"));
    overlay bubble(target: dataId("Scaling"), text: "Auto-scaling for demand");
  }
}`,
                    'ml': `mpd 1.0
scene default {
  step overview {
    camera reset();
    overlay bubble(target: dataId("Data"), text: "Data preparation phase");
  }
  step training {
    camera fit(target: dataId("Training"));
    overlay bubble(target: dataId("Training"), text: "Model training process");
  }
  step evaluation {
    camera fit(target: dataId("Evaluation"));
    overlay bubble(target: dataId("Evaluation"), text: "Model evaluation metrics");
  }
}`,
                    'web': `mpd 1.0
scene default {
  step early {
    camera fit(target: dataId("HTML"));
    overlay bubble(target: dataId("HTML"), text: "Static web pages");
  }
  step dynamic {
    camera fit(target: dataId("JavaScript"));
    overlay bubble(target: dataId("JavaScript"), text: "Dynamic interactions");
  }
  step modern {
    camera fit(target: dataId("Frameworks"));
    overlay bubble(target: dataId("Frameworks"), text: "Modern frameworks");
  }
}`,
                    'agile': `mpd 1.0
scene default {
  step planning {
    camera fit(target: dataId("Plan"));
    overlay bubble(target: dataId("Plan"), text: "Sprint planning");
  }
  step development {
    camera fit(target: dataId("Develop"));
    overlay bubble(target: dataId("Develop"), text: "Development work");
  }
  step review {
    camera fit(target: dataId("Review"));
    overlay bubble(target: dataId("Review"), text: "Sprint review");
  }
}`
                };

                // Simple keyword matching for demo
                if (prompt.toLowerCase().includes('cloud')) return templates.cloud;
                if (prompt.toLowerCase().includes('machine learning') || prompt.toLowerCase().includes('ml')) return templates.ml;
                if (prompt.toLowerCase().includes('web') || prompt.toLowerCase().includes('history')) return templates.web;
                if (prompt.toLowerCase().includes('agile')) return templates.agile;
                
                // Default template
                return `mpd 1.0
scene default {
  step overview {
    camera reset();
    overlay bubble(target: dataId("Start"), text: "Presentation overview");
  }
  step detail {
    camera fit(target: dataId("Process"));
    overlay bubble(target: dataId("Process"), text: "Detailed explanation");
  }
  step conclusion {
    camera fit(target: dataId("End"));
    overlay bubble(target: dataId("End"), text: "Summary and next steps");
  }
}`;
            }
        };

        // Global variables
        let currentController = null;
        let currentModel = null;

        // DOM elements
        const elements = {
            diagram: document.getElementById('diagram'),
            mpdCode: document.getElementById('mpd-code'),
            mermaidCode: document.getElementById('mermaid-code'),
            modelSelect: document.getElementById('model-select'),
            aiPrompt: document.getElementById('ai-prompt'),
            aiStatus: document.getElementById('ai-status'),
            aiOutput: document.getElementById('ai-output'),
            aiResponseText: document.getElementById('ai-response-text'),
            generateBtn: document.getElementById('generate-btn'),
            enhanceBtn: document.getElementById('enhance-btn'),
            applyMpdBtn: document.getElementById('apply-mpd'),
            clearMpdBtn: document.getElementById('clear-mpd'),
            updateDiagramBtn: document.getElementById('update-diagram'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            resetBtn: document.getElementById('reset-btn')
        };

        // Initialize
        async function init() {
            await loadModels();
            setupEventListeners();
            await renderPresentation();
            updateAIStatus('success', 'Ready to generate presentations');
        }

        // Load AI models
        async function loadModels() {
            elements.modelSelect.innerHTML = mockAI.models.map(model => 
                `<option value="${model.id}">${model.name}</option>`
            ).join('');
            
            currentModel = mockAI.models[0].id;
            elements.modelSelect.value = currentModel;
        }

        // Setup event listeners
        function setupEventListeners() {
            elements.modelSelect.addEventListener('change', (e) => {
                currentModel = e.target.value;
            });

            elements.generateBtn.addEventListener('click', generatePresentation);
            elements.enhanceBtn.addEventListener('click', enhancePresentation);
            elements.applyMpdBtn.addEventListener('click', applyMpdCode);
            elements.clearMpdBtn.addEventListener('click', clearMpdCode);
            elements.updateDiagramBtn.addEventListener('click', updateDiagram);
            
            elements.prevBtn.addEventListener('click', () => {
                if (currentController) currentController.prev();
            });
            elements.nextBtn.addEventListener('click', () => {
                if (currentController) currentController.next();
            });
            elements.resetBtn.addEventListener('click', () => {
                if (currentController) currentController.reset();
            });

            // Prompt suggestions
            document.querySelectorAll('.prompt-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    elements.aiPrompt.value = e.target.dataset.prompt;
                });
            });
        }

        // Generate presentation with AI
        async function generatePresentation() {
            const prompt = elements.aiPrompt.value.trim();
            if (!prompt) {
                updateAIStatus('error', 'Please enter a prompt');
                return;
            }

            elements.generateBtn.disabled = true;
            elements.generateBtn.innerHTML = '<div class="loading"></div> Generating...';
            updateAIStatus('warning', 'Generating presentation...');

            try {
                const mpdCode = await mockAI.generateContent(prompt, currentModel);
                elements.mpdCode.value = mpdCode;
                showAIOutput(mpdCode);
                updateAIStatus('success', 'Presentation generated successfully!');
            } catch (error) {
                updateAIStatus('error', `Generation failed: ${error.message}`);
            } finally {
                elements.generateBtn.disabled = false;
                elements.generateBtn.innerHTML = 'üöÄ Generate';
            }
        }

        // Enhance existing presentation
        async function enhancePresentation() {
            const currentMpd = elements.mpdCode.value.trim();
            if (!currentMpd) {
                updateAIStatus('error', 'Please create or load a presentation first');
                return;
            }

            elements.enhanceBtn.disabled = true;
            elements.enhanceBtn.innerHTML = '<div class="loading"></div> Enhancing...';
            updateAIStatus('warning', 'Enhancing presentation...');

            try {
                const prompt = `Enhance this MPD code with more detailed steps and better overlays:\n\n${currentMpd}`;
                const enhancedMpd = await mockAI.generateContent(prompt, currentModel);
                elements.mpdCode.value = enhancedMpd;
                showAIOutput('Enhanced MPD code generated. Check the editor above.');
                updateAIStatus('success', 'Presentation enhanced successfully!');
            } catch (error) {
                updateAIStatus('error', `Enhancement failed: ${error.message}`);
            } finally {
                elements.enhanceBtn.disabled = false;
                elements.enhanceBtn.innerHTML = '‚ú® Enhance';
            }
        }

        // Apply MPD code
        async function applyMpdCode() {
            await renderPresentation();
        }

        // Clear MPD code
        function clearMpdCode() {
            elements.mpdCode.value = '';
        }

        // Update diagram
        async function updateDiagram() {
            await renderPresentation();
        }

        // Render presentation
        async function renderPresentation() {
            try {
                const mermaidText = elements.mermaidCode.value.trim();
                const mpdText = elements.mpdCode.value.trim();

                if (!mermaidText || !mpdText) {
                    elements.diagram.innerHTML = '<p style="text-align: center; color: #666; margin-top: 2rem;">Please provide both Mermaid diagram and MPD code</p>';
                    return;
                }

                // Parse MPD (simplified mock parser for demo)
                const mockParser = (mpdText) => ({
                    steps: [
                        { id: 'overview', name: 'Overview', actions: [] },
                        { id: 'process', name: 'Process', actions: [] },
                        { id: 'end', name: 'End', actions: [] }
                    ]
                });

                // Mock presentMermaid function for demo
                const mockPresentMermaid = async ({ mermaidText, mpdText, mountEl }) => {
                    // Render Mermaid diagram
                    const { svg } = await mermaid.render('mermaid-diagram', mermaidText);
                    mountEl.innerHTML = svg;

                    // Mock controller
                    let currentStep = 0;
                    const steps = mockParser(mpdText).steps;

                    return {
                        currentStep,
                        steps,
                        next: () => {
                            currentStep = Math.min(currentStep + 1, steps.length - 1);
                            updateStepDisplay();
                        },
                        prev: () => {
                            currentStep = Math.max(currentStep - 1, 0);
                            updateStepDisplay();
                        },
                        reset: () => {
                            currentStep = 0;
                            updateStepDisplay();
                        },
                        getState: () => ({
                            stepIndex: currentStep,
                            stepCount: steps.length,
                            stepId: steps[currentStep]?.id
                        })
                    };
                };

                // Create presentation
                currentController = await mockPresentMermaid({
                    mermaidText,
                    mpdText,
                    mountEl: elements.diagram
                });

                updateAIStatus('success', 'Presentation rendered successfully!');

            } catch (error) {
                elements.diagram.innerHTML = `<p style="color: red; text-align: center;">Error: ${error.message}</p>`;
                updateAIStatus('error', `Render failed: ${error.message}`);
            }
        }

        // Update step display (mock)
        function updateStepDisplay() {
            if (currentController) {
                const state = currentController.getState();
                console.log(`Current step: ${state.stepIndex + 1}/${state.stepCount} (${state.stepId})`);
            }
        }

        // Show AI output
        function showAIOutput(content) {
            elements.aiOutput.style.display = 'block';
            elements.aiResponseText.textContent = content;
        }

        // Update AI status
        function updateAIStatus(type, message) {
            elements.aiStatus.innerHTML = `<span class="status-indicator status-${type}">${message}</span>`;
        }

        // Initialize
        init();
    </script>
</body>
</html>