var V=class{extractIdFromPatterns(t,e){for(let s of e){let n=t.match(s);if(n&&n[1])return n[1]}return null}getElementClassName(t){return typeof t.className=="string"?t.className:t.className.baseVal}hasTargetableClass(t){let e=this.getElementClassName(t);return this.getTargetableClasses().some(n=>e.includes(n))}escapeSelector(t){return typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(t):t.replace(/[^a-zA-Z0-9_-]/g,"\\$&")}};var K=class extends V{getDiagramType(){return"flowchart"}getTargetableClasses(){return["node"]}getTargetableTags(){return["g"]}extractNodeIds(t){let e=new Map,s=[/^[a-zA-Z0-9-]+-([A-Za-z0-9_]+)-\d+$/,/^[a-zA-Z0-9-]+-\d+-([A-Za-z0-9_]+)$/,/^node-([A-Za-z0-9_]+)$/,/^flowchart-([A-Za-z0-9_]+)-/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&l.includes("node")){c=a;break}}a=a.parentElement}c?e.set(i,c):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.node[data-id="${e}"]`,`g[class*="node"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n;try{let l=t.getBBox(),p=t.getAttribute("transform");if(p&&p.includes("translate")){let d=p.match(/translate\s*\(\s*([-\d.]+)\s*[, ]\s*([-\d.]+)\s*\)/);if(d){let u=parseFloat(d[1]),m=parseFloat(d[2]);n=new DOMRect(l.x+u,l.y+m,l.width,l.height)}else n=l}else n=l}catch{return[]}let o=n.x+n.width/2,i=n.y+n.height/2,a=Array.from(e.querySelectorAll('path.edge, path[class*="edge"], g.edge path, path[id*="edge"]')),c=new Set;for(let l of a)try{let p=l.getBBox(),d=p.x+p.width/2,u=p.y+p.height/2,m=Math.max(n.width,n.height)*1.5,f=Math.sqrt(Math.pow(d-o,2)+Math.pow(u-i,2)),D=p.x<n.x+n.width&&p.x+p.width>n.x&&p.y<n.y+n.height&&p.y+p.height>n.y,A=l.getAttribute("d"),E=!1;if(A){let g=A.match(/[ML]\s*([-\d.]+)\s+([-\d.]+)/g);if(g)for(let x of g){let h=x.match(/[ML]\s*([-\d.]+)\s+([-\d.]+)/);if(h){let b=parseFloat(h[1]),k=parseFloat(h[2]);if(Math.sqrt(Math.pow(b-o,2)+Math.pow(k-i,2))<m){E=!0;break}}}}if(D||E||f<m){let g=Array.from(e.querySelectorAll("g.node[data-id]"));for(let x of g)if(x!==t&&!c.has(x))try{let h=x.getBBox(),b=x.getAttribute("transform"),k=h;if(b&&b.includes("translate")){let G=b.match(/translate\s*\(\s*([-\d.]+)\s*[, ]\s*([-\d.]+)\s*\)/);if(G){let y=parseFloat(G[1]),v=parseFloat(G[2]);k=new DOMRect(h.x+y,h.y+v,h.width,h.height)}}let B=k.x+k.width/2,$=k.y+k.height/2,C=Math.sqrt(Math.pow(B-d,2)+Math.pow($-u,2));(k.x<p.x+p.width&&k.x+k.width>p.x&&k.y<p.y+p.height&&k.y+k.height>p.y||C<m)&&c.add(x)}catch{continue}}}catch{continue}return Array.from(c)}};var Ie={linear:r=>r,ease:r=>r<.5?2*r*r:-1+(4-2*r)*r,easeIn:r=>r*r,easeOut:r=>r*(2-r),easeInOut:r=>r<.5?2*r*r:-1+(4-2*r)*r,cubicIn:r=>r*r*r,cubicOut:r=>--r*r*r+1,cubicInOut:r=>r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1,quadIn:r=>r*r,quadOut:r=>r*(2-r),quadInOut:r=>r<.5?2*r*r:-1+(4-2*r)*r,quartIn:r=>r*r*r*r,quartOut:r=>1- --r*r*r*r,quartInOut:r=>r<.5?8*r*r*r*r:1-8*--r*r*r*r,quintIn:r=>r*r*r*r*r,quintOut:r=>1+--r*r*r*r*r,quintInOut:r=>r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r,sineIn:r=>1-Math.cos(r*Math.PI/2),sineOut:r=>Math.sin(r*Math.PI/2),sineInOut:r=>-(Math.cos(Math.PI*r)-1)/2,expoIn:r=>r===0?0:Math.pow(2,10*(r-1)),expoOut:r=>r===1?1:1-Math.pow(2,-10*r),expoInOut:r=>r===0?0:r===1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2,circIn:r=>1-Math.sqrt(1-r*r),circOut:r=>Math.sqrt(1- --r*r),circInOut:r=>r<.5?(1-Math.sqrt(1-4*r*r))/2:(Math.sqrt(1-4*(r-1)*(r-1))+1)/2,backIn:r=>2.70158*r*r*r-1.70158*r*r,backOut:r=>1+2.70158*Math.pow(r-1,3)+1.70158*Math.pow(r-1,2),backInOut:r=>{let e=2.5949095;return r<.5?Math.pow(2*r,2)*((e+1)*2*r-e)/2:(Math.pow(2*r-2,2)*((e+1)*(r*2-2)+e)+2)/2}};function We(r){return Ie[r]||Ie.easeOut}function we(r,t){if(r instanceof SVGGraphicsElement)try{let a=r.getBBox();if(a.width>0&&a.height>0)return a}catch{}let e=r.getBoundingClientRect(),s=t.getBoundingClientRect(),n=t.viewBox.baseVal;if(!n||s.width===0||s.height===0)return new DOMRect(0,0,0,0);let o=n.width/s.width,i=n.height/s.height;return new DOMRect((e.left-s.left)*o+n.x,(e.top-s.top)*i+n.y,e.width*o,e.height*i)}var Ve=r=>{let t=r.viewBox?.baseVal;return t&&t.width&&t.height?`${t.x} ${t.y} ${t.width} ${t.height}`:r.getAttribute("viewBox")};function Ue(r,t,e){return r instanceof SVGGraphicsElement?e.findAdjacentElements(r,t):[]}var ve=(r,t=40)=>{let e=r.getAttribute("data-initial-viewbox");if(e)return e;let s=null;for(let g of Array.from(r.children))if(g instanceof SVGGElement){s=g;break}let n=1/0,o=1/0,i=-1/0,a=-1/0;if(s)try{let g=s.getBBox();n=g.x,o=g.y,i=g.x+g.width,a=g.y+g.height}catch{}let c=i-n,l=a-o,p=Ve(r),d={width:0,height:0};if(p){let g=p.split(" ").map(Number);g.length===4&&(d={width:g[2],height:g[3]})}let u={width:0,height:0};if(e){let g=e.split(" ").map(Number);g.length===4&&(u={width:g[2],height:g[3]})}if(!isFinite(n)||!isFinite(o)||!isFinite(i)||!isFinite(a)||c<10||l<10||d.width>0&&c<d.width*.1||u.width>0&&c<u.width*.5){let g=[];for(let x of Array.from(r.children))x instanceof SVGGraphicsElement&&g.push(x);g.length===0&&g.push(...Array.from(r.querySelectorAll("g, rect, circle, ellipse, line, polyline, polygon, path, text"))),n=1/0,o=1/0,i=-1/0,a=-1/0;for(let x of g)try{let h=x.getBBox();isFinite(h.x)&&isFinite(h.y)&&isFinite(h.width)&&isFinite(h.height)&&h.width>0&&h.height>0&&(n=Math.min(n,h.x),o=Math.min(o,h.y),i=Math.max(i,h.x+h.width),a=Math.max(a,h.y+h.height))}catch{continue}}let f=i-n,D=a-o,A=u.width>0&&f<u.width*.7;if(!isFinite(n)||!isFinite(o)||!isFinite(i)||!isFinite(a)||f<10||D<10||d.width>0&&f<d.width*.1||A){if(e&&u.width>0&&u.height>0)return e;if(p)return p;let g=r.getAttribute("width"),x=r.getAttribute("height");if(g&&x){let h=parseFloat(g)||1e3,b=parseFloat(x)||1e3;return`0 0 ${h} ${b}`}return null}let E={x:n-t,y:o-t,width:f+t*2,height:D+t*2};return`${E.x} ${E.y} ${E.width} ${E.height}`};function Ye(r){if(!r)return null;let t=r.split(" ").map(Number);return t.length!==4||t.some(isNaN)?null:{x:t[0],y:t[1],width:t[2],height:t[3]}}function Xe(r,t,e,s,n){return new Promise(o=>{if(!t){r.setAttribute("viewBox",`${e.x} ${e.y} ${e.width} ${e.height}`),o();return}let i=performance.now(),a=c=>{let l=c-i,p=Math.min(l/s,1),d=n(p),u={x:t.x+(e.x-t.x)*d,y:t.y+(e.y-t.y)*d,width:t.width+(e.width-t.width)*d,height:t.height+(e.height-t.height)*d};r.setAttribute("viewBox",`${u.x} ${u.y} ${u.width} ${u.height}`),p<1?requestAnimationFrame(a):(r.setAttribute("viewBox",`${e.x} ${e.y} ${e.width} ${e.height}`),o())};requestAnimationFrame(a)})}var Pe=r=>{let t=r.getRoot(),e=r.getContainer(),s=Ve(t),n=!1,o=0,i=0,a=(u,m)=>{let f=t.viewBox?.baseVal;if(!f||!f.width||!f.height)return;let D={x:f.x,y:f.y,width:f.width,height:f.height},A=t.clientWidth||f.width,E=t.clientHeight||f.height,g=D.width/A,x=D.height/E,h=D.x-u*g,b=D.y-m*x;t.setAttribute("viewBox",`${h} ${b} ${D.width} ${D.height}`)},c=u=>{u.button===0&&(u.target?.closest("button")||u.target?.closest(".nav-btn")||u.target?.closest(".dataid-chip")||u.target?.closest("a")||(n=!0,o=u.clientX,i=u.clientY,e.style.cursor="grabbing",e.style.userSelect="none",u.preventDefault()))},l=u=>{if(!n)return;let m=u.clientX-o,f=u.clientY-i;a(m,f),o=u.clientX,i=u.clientY,u.preventDefault()},p=()=>{n&&(n=!1,e.style.cursor="grab",e.style.userSelect="")},d=()=>{n&&(n=!1,e.style.cursor="grab",e.style.userSelect="")};return e.style.cursor="grab",e.addEventListener("mousedown",c),document.addEventListener("mousemove",l),document.addEventListener("mouseup",p),e.addEventListener("mouseleave",d),{fit(u,m){if(u)try{let f=we(u,t),D=u instanceof SVGElement?u.getAttribute("transform"):null;if(u instanceof SVGGraphicsElement&&D&&D.includes("translate"))try{let G=D.match(/translate\s*\(\s*([-\d.]+)\s*[, ]\s*([-\d.]+)\s*\)/);if(G){let y=parseFloat(G[1]),v=parseFloat(G[2]);f=new DOMRect(f.x+y,f.y+v,f.width,f.height)}}catch{}let A=m?.padding??16,E=40;f.height<E&&(f=new DOMRect(f.x,f.y-E/2,f.width||E,E)),f.width<E&&(f=new DOMRect(f.x-E/2,f.y,E,f.height||E));let g=r.getStrategy?.()||new K,x=Ue(u,t,g),h=f;for(let G of x)try{let y=we(G,t),v=Math.min(h.x,y.x),N=Math.min(h.y,y.y),I=Math.max(h.x+h.width,y.x+y.width),P=Math.max(h.y+h.height,y.y+y.height);h=new DOMRect(v,N,I-v,P-N)}catch{continue}if(f=h,!isFinite(f.width)||!isFinite(f.height)||f.width<=0||f.height<=0){let G=u.parentElement;if(G){let y=we(G,t);if(isFinite(y.width)&&isFinite(y.height)&&y.width>0&&y.height>0){let v={x:y.x-A,y:y.y-A,width:y.width+A*2,height:y.height+A*2};t.setAttribute("viewBox",`${v.x} ${v.y} ${v.width} ${v.height}`);return}}return}let b=null;try{let G=Array.from(t.children).find(y=>y instanceof SVGGElement);G&&(b=G.getBBox())}catch{}if(b&&(f.x<b.x||f.y<b.y||f.x+f.width>b.x+b.width||f.y+f.height>b.y+b.height)){let G=Math.min(h.x,b.x),y=Math.min(h.y,b.y),v=Math.max(h.x+h.width,b.x+b.width),N=Math.max(h.y+h.height,b.y+b.height);h=new DOMRect(G,y,v-G,N-y)}let k=h,B={x:k.x-A,y:k.y-A,width:k.width+A*2,height:k.height+A*2},$=`${B.x} ${B.y} ${B.width} ${B.height}`,C=m?.duration??0,w=m?.easing??"easeOut";if(C<=0)t.setAttribute("viewBox",$);else{let G=Ye(t.getAttribute("viewBox")),y=B,v=We(w);return Xe(t,G,y,C,v)}}catch(f){console.warn("Failed to get bounding box for camera.fit:",f)}},reset(){let u=ve(t);u?t.setAttribute("viewBox",u):s&&t.setAttribute("viewBox",s)},zoom(u,m){let f=t.viewBox?.baseVal;if(!f||!f.width||!f.height)return;let D={x:f.x,y:f.y,width:f.width,height:f.height},A=m??{x:D.x+D.width/2,y:D.y+D.height/2},E=D.width/u,g=D.height/u,x=A.x-E/2,h=A.y-g/2;t.setAttribute("viewBox",`${x} ${h} ${E} ${g}`)},pan(u,m){let f=t.viewBox?.baseVal;if(!f||!f.width||!f.height)return;let D={x:f.x,y:f.y,width:f.width,height:f.height},A=t.clientWidth||f.width,E=t.clientHeight||f.height,g=D.width/A,x=D.height/E,h=D.x+u*g,b=D.y+m*x;t.setAttribute("viewBox",`${h} ${b} ${D.width} ${D.height}`)},fitAll(u=40){let m=ve(t,u);m&&t.setAttribute("viewBox",m)},destroy(){e.removeEventListener("mousedown",c),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",p),e.removeEventListener("mouseleave",d),e.style.cursor="",e.style.userSelect="";let u=ve(t);u?t.setAttribute("viewBox",u):s&&t.setAttribute("viewBox",s)}}};var Me=()=>{let r=document.createElement("div");r.className="finsteps-overlay",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="0",r.style.height="0",r.style.pointerEvents="none",document.body.appendChild(r);let t=new Map,e=()=>{for(let o of t.values()){let i=o.target.getBoundingClientRect(),a=o.element.getBoundingClientRect(),c=Math.max(8,i.top-a.height-8),l=Math.max(8,i.left+i.width/2-a.width/2);o.element.style.top=`${c}px`,o.element.style.left=`${l}px`}},s=()=>e(),n=()=>e();return window.addEventListener("scroll",s,!0),window.addEventListener("resize",n),{showBubble({id:o="default",target:i,text:a}){let c=t.get(o);if(!c){let l=document.createElement("div");l.className="finsteps-bubble",l.style.position="fixed",l.style.padding="8px 12px",l.style.borderRadius="8px",l.style.background="rgba(15, 23, 42, 0.95)",l.style.color="#fff",l.style.font="14px/1.4 sans-serif",l.style.maxWidth="240px",l.style.pointerEvents="none",r.appendChild(l),c={id:o,element:l,target:i},t.set(o,c)}c.target=i,c.element.textContent=a,requestAnimationFrame(e)},hideBubble(o="default"){let i=t.get(o);i&&(i.element.remove(),t.delete(o))},clear(){for(let o of t.values())o.element.remove();t.clear()},destroy(){window.removeEventListener("scroll",s,!0),window.removeEventListener("resize",n);for(let o of t.values())o.element.remove();t.clear(),r.remove()}}};function Je(r,t){switch(r){case"MPF_INVALID_PRESENT_OPTIONS":return['Ensure you provide either "ast" or both "mpdText" and "options.parseMpd"',"Example: presentMermaid({ mermaidText, mpdText, mountEl, options: { parseMpd } })","See API documentation: https://github.com/cablepull/finsteps#cdn-usage-jsdelivr"];case"MPF_MERMAID_UNAVAILABLE":return["Load Mermaid.js before importing Finsteps",'Add <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js"><\/script> in your HTML',"Ensure mermaid.initialize() is called before presentMermaid()"];case"MPF_MERMAID_RENDER_FAILED":return["Check your Mermaid diagram syntax is valid","Test your diagram at https://mermaid.live/","Verify the mermaidText is a valid string and not empty"];case"MPF_OVERLAY_DESTROYED":return["Do not call overlay methods after controller.destroy()","Check that the controller is still active before showing overlays","Ensure lifecycle hooks are not accessing destroyed overlays"];case"MPF_OVERLAY_TARGET_MISSING":return[`Verify the target element exists in the diagram${t?.target?` Target: ${JSON.stringify(t.target)}`:""}`,"Check that dataId, selector, or id matches an element in the rendered SVG","Use the live editor to see available data-id values: https://cablepull.github.io/finsteps/examples/editor/"];case"MPF_ACTION_UNKNOWN":return[`Check that the action type is spelled correctly${t?.actionType?` Action: ${t.actionType}`:""}`,"Common actions: camera.fit, camera.reset, overlay.bubble, style.highlight, nav.next, nav.prev","See grammar documentation: https://cablepull.github.io/finsteps/grammar.html"];case"MPF_ACTION_INVALID_ARGS":return["Verify the action payload structure matches the expected format",'Check required fields (e.g., camera.fit requires "target" in payload)',"Review action documentation in grammar: https://cablepull.github.io/finsteps/grammar.html"];case"MPF_PARSE_ERROR":return["Use formatDiagnostics(result.diagnostics) to see detailed parse errors","Check your MPD syntax against the EBNF grammar: https://cablepull.github.io/finsteps/ebnf/mpd.ebnf","Validate MPD with parseMPD() before passing to presentMermaid()"];default:return[]}}var q=class extends Error{constructor(t,e,s){super(t),this.name="MPFError",this.code=e,this.context=s,this.suggestions=Je(e,s)}},Ae=class extends q{constructor(t,e="MPF_PARSE_ERROR"){super(t,e),this.name="ParseError"}},Z=class extends q{constructor(t,e="MPF_ACTION_INVALID_ARGS",s){super(t,e,s),this.name="ActionError"}};var Be=r=>typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(r):r.replace(/[^a-zA-Z0-9_-]/g,"\\$&"),F=(r,t)=>{if(!t)return null;if(t.element)return t.element;let e=r.getRoot(),s=null;if(t.selector)s=e.querySelector(t.selector),!s&&typeof document<"u"&&(s=document.querySelector(t.selector));else if(t.id)s=e.querySelector(`#${Be(t.id)}`);else if(t.dataId){let o=(r.getStrategy?.()||new K).getTargetSelectors(t.dataId);for(let i of o)if(s=e.querySelector(i),s)break;!s&&e instanceof Element&&e.getAttribute("data-id")===t.dataId&&(s=e)}if(!s)return null;if(!(s instanceof SVGGraphicsElement)||s.tagName==="text"||s instanceof SVGElement&&(typeof s.className=="string"&&s.className.includes("flowchart-label")||typeof s.className!="string"&&s.className.baseVal.includes("flowchart-label"))){let n=s;for(;n;){let o=n.parentElement;if(!o||o===e)break;if(o instanceof SVGGraphicsElement){if(o.tagName==="g"){if((o instanceof SVGElement?typeof o.className=="string"?o.className:o.className.baseVal:"").includes("node")&&o!==e&&o.getAttribute("data-id")===t?.dataId)return o;let a=o.parentElement;if(a===e||a&&a.tagName==="svg"){n=o;continue}}if(o===e)break}n=o}if(n instanceof SVGGraphicsElement&&n!==e){let o=n.parentElement;if(o&&o.tagName!=="svg")return n}}if(s instanceof SVGGraphicsElement&&s.tagName!=="g"){let n=s.parentElement;if(n instanceof SVGGraphicsElement&&n.tagName==="g"&&(n instanceof SVGElement?typeof n.className=="string"?n.className:n.className.baseVal:"").includes("node")&&n.getAttribute("data-id")===t?.dataId)return n}if(s.tagName==="g"){let n=s.parentElement;if(n===e||n&&n.tagName==="svg"){let o=s.getAttribute("data-id"),i=s instanceof SVGElement?typeof s.className=="string"?s.className:s.className.baseVal:"";if(o!==t?.dataId||!i.includes("node")){let a=t?.dataId?Be(t.dataId):"",c=e.querySelector(`g.node[data-id="${a}"], [data-id="${a}"]`);if(c&&c!==s)return c}}}return s};function X(r){let t=r.trim(),e=t.split(`
`).map(o=>o.trim()),s=0;if(e[0]==="---"){for(let o=1;o<e.length;o++)if(e[o]==="---"){let i=o+1;for(;i<e.length&&e[i]==="";)i++;s=i;break}}let n=(e[s]||"").toLowerCase();return n.startsWith("flowchart")?"flowchart":n.startsWith("sequenceDiagram")||n.startsWith("sequencediagram")?"sequenceDiagram":n.startsWith("classDiagram")||n.startsWith("classdiagram")?"classDiagram":n.startsWith("stateDiagram-v2")||n.startsWith("statediagram-v2")?"stateDiagram-v2":n.startsWith("stateDiagram")||n.startsWith("statediagram")?"stateDiagram":n.startsWith("erDiagram")||n.startsWith("erdiagram")?"erDiagram":n.startsWith("gantt")?"gantt":n.startsWith("pie")?"pie":n.startsWith("journey")?"journey":n.startsWith("gitGraph")||n.startsWith("gitgraph")?"gitGraph":n.startsWith("timeline")?"timeline":n.startsWith("quadrantChart")||n.startsWith("quadrantchart")?"quadrantChart":n.startsWith("requirement")?"requirement":n.startsWith("C4Context")||n.startsWith("c4context")?"c4Context":n.startsWith("C4Container")||n.startsWith("c4container")?"c4Container":n.startsWith("C4Component")||n.startsWith("c4component")?"c4Component":n.startsWith("block-beta")||n.startsWith("blockBeta")||n.startsWith("blockbeta")||n.startsWith("blockDiagram")||n.startsWith("blockdiagram")?"block":n.startsWith("mindmap")?"mindmap":n.startsWith("kanban")?"kanban":n.startsWith("packet")?"packet":n.startsWith("radar")?"radar":n.startsWith("sankey")||n.startsWith("sankey-beta")||n.startsWith("sankeybeta")?"sankey":n.startsWith("treemap")||n.startsWith("treemap-beta")||n.startsWith("treemapbeta")?"treemap":n.startsWith("xychart")||n.startsWith("xychart-beta")||n.startsWith("xychartbeta")||n.startsWith("xy")?"xychart":n.startsWith("zenuml")?"zenuml":t.includes("graph")||t.includes("-->")||t.includes("---")?"flowchart":"unknown"}var Ne=class{constructor(){this.strategies=new Map;this.defaultStrategy=null}register(t,e){this.strategies.set(t,e)}get(t){return this.strategies.get(t)}getOrDefault(t){let e=this.strategies.get(t);if(e)return e;if(this.defaultStrategy)return this.defaultStrategy;throw new Error(`No strategy found for diagram type: ${t} and no default strategy set`)}setDefault(t){this.defaultStrategy=t}has(t){return this.strategies.has(t)}getRegisteredTypes(){return Array.from(this.strategies.keys())}},M=new Ne;var J=class extends V{getDiagramType(){return"gantt"}getTargetableClasses(){return["task","milestone","section"]}getTargetableTags(){return["g","rect","polygon"]}extractNodeIds(t){let e=new Map,s=[/^[a-zA-Z0-9-]+-([A-Za-z0-9_]+)-\d+$/,/^gantt-([A-Za-z0-9_]+)-/,/^task-([A-Za-z0-9_]+)/,/^([A-Za-z0-9_]+)$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(!i){let a=this.getElementClassName(n);a&&(a.includes("task")||a.includes("milestone"))&&!o.endsWith("-text")&&!o.endsWith("-Text")&&(i=o)}if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("task")||l.includes("milestone")||l.includes("section"))){c=a;break}}a=a.parentElement}if(c)e.set(i,c);else if(n.tagName==="g"&&this.hasTargetableClass(n))e.set(i,n);else if(n.tagName==="rect"){let l=this.getElementClassName(n);l&&(l.includes("task")||l.includes("milestone"))&&e.set(i,n)}else if(n.tagName==="polygon"){let l=this.getElementClassName(n);l&&l.includes("milestone")&&e.set(i,n)}}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.task[data-id="${e}"]`,`g.milestone[data-id="${e}"]`,`g[class*="task"][data-id="${e}"]`,`g[class*="milestone"][data-id="${e}"]`,`g[class*="section"][data-id="${e}"]`,`rect.task[data-id="${e}"]`,`rect[class*="task"][data-id="${e}"]`,`polygon.milestone[data-id="${e}"]`,`polygon[class*="milestone"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&n.includes("milestone"))return Array.from(e.querySelectorAll("[data-id]")).filter(p=>p!==t&&p instanceof SVGGraphicsElement);let i=null,a=t;for(;a&&a!==e;){if(a.tagName==="g"&&a instanceof SVGElement){let l=a,p=this.getElementClassName(l);if(p&&p.includes("section")){i=l;break}}a=a.parentElement}return i?Array.from(i.querySelectorAll('[data-id], g[class*="task"][data-id], polygon[class*="milestone"][data-id]')).filter(l=>l!==t):Array.from(e.querySelectorAll('[data-id], g[class*="task"][data-id], polygon[class*="milestone"][data-id]')).filter(p=>p!==t)}};var Q=class extends V{getDiagramType(){return"sequenceDiagram"}getTargetableClasses(){return["participant","message","activation","note"]}getTargetableTags(){return["g","rect","text"]}extractNodeIds(t){let e=new Map,s=[/^participant-([A-Za-z0-9_]+)-\d+$/,/^actor-([A-Za-z0-9_]+)-\d+$/,/^message-([A-Za-z0-9_]+)-\d+$/,/^activation-([A-Za-z0-9_]+)-\d+$/,/^note-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("participant")||l.includes("actor")||l.includes("message")||l.includes("activation")||l.includes("note"))){c=a;break}}a=a.parentElement}c?e.set(i,c):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.participant[data-id="${e}"]`,`g.actor[data-id="${e}"]`,`g.message[data-id="${e}"]`,`g.activation[data-id="${e}"]`,`g.note[data-id="${e}"]`,`line[data-id="${e}"]`,`text[data-id="${e}"]`,`g[class*="participant"][data-id="${e}"]`,`g[class*="actor"][data-id="${e}"]`,`g[class*="message"][data-id="${e}"]`,`g[class*="activation"][data-id="${e}"]`,`g[class*="note"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("participant")||n.includes("actor"))){let o=Array.from(e.querySelectorAll('g[class*="message"][data-id]')),i=[];for(let a of o)try{let c=t.getBBox(),l=a.getBBox();l.x<c.x+c.width&&l.x+l.width>c.x&&l.y<c.y+c.height&&l.y+l.height>c.y&&i.push(a)}catch{continue}return i}if(n&&n.includes("message")){let o=Array.from(e.querySelectorAll('g[class*="participant"][data-id], g[class*="actor"][data-id]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();a.x<l.x+l.width&&a.x+a.width>l.x&&a.y<l.y+l.height&&a.y+a.height>l.y&&i.push(c)}catch{continue}}catch{return[]}return i}if(n&&n.includes("activation")){let o=t.parentElement;for(;o&&o!==e;){if(o instanceof SVGGraphicsElement){let i=this.getElementClassName(o);if(i&&(i.includes("participant")||i.includes("actor")))return[o]}o=o.parentElement}}return[]}};var ee=class extends V{getDiagramType(){return"classDiagram"}getTargetableClasses(){return["class","classBox","relation","edge"]}getTargetableTags(){return["g","rect","path"]}extractNodeIds(t){let e=new Map,s=[/^classId-([A-Za-z0-9_]+)-\d+$/,/^class-([A-Za-z0-9_]+)-\d+$/,/^classBox-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("g.node[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);i&&!e.has(i)&&e.set(i,n)}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.class[data-id="${e}"]`,`g.classBox[data-id="${e}"]`,`g.relation[data-id="${e}"]`,`g.edge[data-id="${e}"]`,`g[class*="class"][data-id="${e}"]`,`g[class*="relation"][data-id="${e}"]`,`g[class*="edge"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("class")||n.includes("classBox"))){let o=Array.from(e.querySelectorAll('g[class*="relation"][data-id], g[class*="edge"][data-id], path[class*="edge"]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();if(l.x<a.x+a.width&&l.x+l.width>a.x&&l.y<a.y+a.height&&l.y+l.height>a.y){let d=Array.from(e.querySelectorAll('g[class*="class"][data-id], g[class*="classBox"][data-id]'));for(let u of d)if(u!==t&&!i.includes(u))try{let m=u.getBBox();l.x<m.x+m.width&&l.x+l.width>m.x&&l.y<m.y+m.height&&l.y+l.height>m.y&&i.push(u)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&(n.includes("relation")||n.includes("edge"))){let o=Array.from(e.querySelectorAll('g[class*="class"][data-id], g[class*="classBox"][data-id]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();a.x<l.x+l.width&&a.x+a.width>l.x&&a.y<l.y+l.height&&a.y+a.height>l.y&&i.push(c)}catch{continue}}catch{return[]}return i}return[]}};var U=class extends V{getDiagramType(){return"stateDiagram"}getTargetableClasses(){return["state","stateNode","transition","edge"]}getTargetableTags(){return["g","rect","ellipse","path"]}extractNodeIds(t){let e=new Map,s=[/^stateDiagram-([A-Za-z0-9_]+)-\d+$/,/^state-([A-Za-z0-9_]+)-\d+$/,/^stateNode-([A-Za-z0-9_]+)-\d+$/,/^node-([A-Za-z0-9_]+)-\d+$/,/^stateDiagram-([A-Za-z0-9_]+)$/,/^state-([A-Za-z0-9_]+)$/,/^([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)$/],n=t.querySelectorAll('g[class*="state"], g[class*="node"]');for(let i=0;i<n.length;i++){let a=n[i];if(!this.getElementClassName(a))continue;let l=a.querySelectorAll("text");for(let p=0;p<l.length;p++){let d=l[p],u=d.textContent?.trim();if(u&&/^[A-Za-z][A-Za-z0-9_]*$/.test(u)){let m=a;d.parentElement&&d.parentElement instanceof SVGElement&&(m=d.parentElement);let f=this.getElementClassName(m);f&&!f.includes("edgeLabel")&&!f.includes("label")&&(e.has(u)||e.set(u,a))}}}let o=[];for(let i of Array.from(t.querySelectorAll("[id]"))){let a=i.getAttribute("id");if(!a)continue;o.push(a);let c=this.extractIdFromPatterns(a,s);if(c&&!e.has(c)){let l=i,p=null;for(;l&&l!==t;){if(l instanceof SVGElement&&l.tagName==="g"){let d=this.getElementClassName(l);if(d&&(d.includes("state")||d.includes("node")||d.includes("transition")||d.includes("edge"))){p=l;break}}l=l.parentElement}p?e.set(c,p):i.tagName==="g"&&this.hasTargetableClass(i)&&e.set(c,i)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.state[data-id="${e}"]`,`g.stateNode[data-id="${e}"]`,`g.node[data-id="${e}"]`,`g.transition[data-id="${e}"]`,`g.edge[data-id="${e}"]`,`g[class*="state"][data-id="${e}"]`,`g[class*="node"][data-id="${e}"]`,`g[class*="transition"][data-id="${e}"]`,`g[class*="edge"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("state")||n.includes("stateNode"))){let o=Array.from(e.querySelectorAll('g[class*="transition"][data-id], g[class*="edge"][data-id], path[class*="edge"]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();if(l.x<a.x+a.width&&l.x+l.width>a.x&&l.y<a.y+a.height&&l.y+l.height>a.y){let d=Array.from(e.querySelectorAll('g[class*="state"][data-id], g[class*="stateNode"][data-id]'));for(let u of d)if(u!==t&&!i.includes(u))try{let m=u.getBBox();l.x<m.x+m.width&&l.x+l.width>m.x&&l.y<m.y+m.height&&l.y+l.height>m.y&&i.push(u)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&(n.includes("transition")||n.includes("edge"))){let o=Array.from(e.querySelectorAll('g[class*="state"][data-id], g[class*="stateNode"][data-id]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();a.x<l.x+l.width&&a.x+a.width>l.x&&a.y<l.y+l.height&&a.y+a.height>l.y&&i.push(c)}catch{continue}}catch{return[]}return i}return[]}};var te=class extends V{getDiagramType(){return"erDiagram"}getTargetableClasses(){return["entity","relationship","attribute","edge"]}getTargetableTags(){return["g","rect","path"]}extractNodeIds(t){let e=new Map,s=[/^entity-([A-Za-z0-9_]+)-\d+$/,/^relationship-([A-Za-z0-9_]+)-\d+$/,/^attribute-([A-Za-z0-9_]+)-\d+$/,/^edge-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("entity")||l.includes("relationship")||l.includes("attribute")||l.includes("edge"))){c=a;break}}a=a.parentElement}c?e.set(i,c):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.entity[data-id="${e}"]`,`g.relationship[data-id="${e}"]`,`g.attribute[data-id="${e}"]`,`g.edge[data-id="${e}"]`,`g[class*="entity"][data-id="${e}"]`,`g[class*="relationship"][data-id="${e}"]`,`g[class*="attribute"][data-id="${e}"]`,`g[class*="edge"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&n.includes("entity")){let o=Array.from(e.querySelectorAll('g[class*="relationship"][data-id], g[class*="edge"][data-id], path[class*="edge"]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();if(l.x<a.x+a.width&&l.x+l.width>a.x&&l.y<a.y+a.height&&l.y+l.height>a.y){let d=Array.from(e.querySelectorAll('g[class*="entity"][data-id]'));for(let u of d)if(u!==t&&!i.includes(u))try{let m=u.getBBox();l.x<m.x+m.width&&l.x+l.width>m.x&&l.y<m.y+m.height&&l.y+l.height>m.y&&i.push(u)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&(n.includes("relationship")||n.includes("edge"))){let o=Array.from(e.querySelectorAll('g[class*="entity"][data-id]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();a.x<l.x+l.width&&a.x+a.width>l.x&&a.y<l.y+l.height&&a.y+a.height>l.y&&i.push(c)}catch{continue}}catch{return[]}return i}return[]}};var ne=class extends V{getDiagramType(){return"pie"}getTargetableClasses(){return["slice","pie"]}getTargetableTags(){return["g","path","text"]}extractNodeIds(t){let e=new Map,s=[/^slice-([A-Za-z0-9_]+)-\d+$/,/^pie-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("slice")||l.includes("pie"))){c=a;break}}a=a.parentElement}c?e.set(i,c):(n.tagName==="g"&&this.hasTargetableClass(n)||n.tagName==="path"&&this.hasTargetableClass(n))&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.slice[data-id="${e}"]`,`g.pie[data-id="${e}"]`,`path.slice[data-id="${e}"]`,`path.pie[data-id="${e}"]`,`g[class*="slice"][data-id="${e}"]`,`g[class*="pie"][data-id="${e}"]`,`path[class*="slice"][data-id="${e}"]`,`path[class*="pie"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){return[]}};var se=class extends V{getDiagramType(){return"journey"}getTargetableClasses(){return["step","task","section"]}getTargetableTags(){return["g","rect","text"]}extractNodeIds(t){let e=new Map,s=[/^step-([A-Za-z0-9_]+)-\d+$/,/^task-([A-Za-z0-9_]+)-\d+$/,/^section-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("step")||l.includes("task")||l.includes("section"))){c=a;break}}a=a.parentElement}c?e.set(i,c):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.step[data-id="${e}"]`,`g.task[data-id="${e}"]`,`g.section[data-id="${e}"]`,`g[class*="step"][data-id="${e}"]`,`g[class*="task"][data-id="${e}"]`,`g[class*="section"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=Array.from(e.querySelectorAll('g[class*="step"][data-id], g[class*="task"][data-id]')),o=n.indexOf(t);if(o===-1)return[];let i=[];return o>0&&i.push(n[o-1]),o<n.length-1&&i.push(n[o+1]),i}};var re=class extends V{getDiagramType(){return"gitGraph"}getTargetableClasses(){return["commit","branch","merge"]}getTargetableTags(){return["g","circle","path","text"]}extractNodeIds(t){let e=new Map,s=[/^commit-([A-Za-z0-9_]+)-\d+$/,/^branch-([A-Za-z0-9_]+)-\d+$/,/^merge-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("commit")||l.includes("branch")||l.includes("merge"))){c=a;break}}a=a.parentElement}c?e.set(i,c):(n.tagName==="g"&&this.hasTargetableClass(n)||n.tagName==="circle"&&this.hasTargetableClass(n))&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.commit[data-id="${e}"]`,`g.branch[data-id="${e}"]`,`g.merge[data-id="${e}"]`,`circle.commit[data-id="${e}"]`,`circle.branch[data-id="${e}"]`,`g[class*="commit"][data-id="${e}"]`,`g[class*="branch"][data-id="${e}"]`,`g[class*="merge"][data-id="${e}"]`,`circle[class*="commit"][data-id="${e}"]`,`circle[class*="branch"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&n.includes("commit")){let o=Array.from(e.querySelectorAll('g[class*="branch"][data-id], path[class*="branch"], path[class*="edge"]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();if(l.x<a.x+a.width&&l.x+l.width>a.x&&l.y<a.y+a.height&&l.y+l.height>a.y){let d=Array.from(e.querySelectorAll('g[class*="commit"][data-id], circle[class*="commit"][data-id]'));for(let u of d)if(u!==t&&!i.includes(u))try{let m=u.getBBox();l.x<m.x+m.width&&l.x+m.width>m.x&&l.y<m.y+m.height&&l.y+m.height>m.y&&i.push(u)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&n.includes("branch")){let o=Array.from(e.querySelectorAll('g[class*="commit"][data-id], circle[class*="commit"][data-id]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();a.x<l.x+l.width&&a.x+a.width>l.x&&a.y<l.y+l.height&&a.y+l.height>l.y&&i.push(c)}catch{continue}}catch{return[]}return i}return[]}};var ae=class extends V{getDiagramType(){return"timeline"}getTargetableClasses(){return["section","event","timeline"]}getTargetableTags(){return["g","rect","text"]}extractNodeIds(t){let e=new Map,s=[/^section-([A-Za-z0-9_]+)-\d+$/,/^event-([A-Za-z0-9_]+)-\d+$/,/^timeline-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("section")||l.includes("event")||l.includes("timeline"))){c=a;break}}a=a.parentElement}c?e.set(i,c):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.section[data-id="${e}"]`,`g.event[data-id="${e}"]`,`g.timeline[data-id="${e}"]`,`g[class*="section"][data-id="${e}"]`,`g[class*="event"][data-id="${e}"]`,`g[class*="timeline"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&n.includes("section"))return Array.from(t.querySelectorAll('g[class*="event"][data-id]'));if(n&&n.includes("event")){let o=t.parentElement;for(;o&&o!==e;){let a=this.getElementClassName(o);if(a&&a.includes("section"))return Array.from(o.querySelectorAll('g[class*="event"][data-id]')).filter(l=>l!==t);o=o.parentElement}return Array.from(e.querySelectorAll('g[class*="event"][data-id]')).filter(a=>a!==t)}return[]}};var ie=class extends V{getDiagramType(){return"quadrantChart"}getTargetableClasses(){return["quadrant","point","data"]}getTargetableTags(){return["g","circle","rect","text"]}extractNodeIds(t){let e=new Map,s=[/^quadrant-([A-Za-z0-9_]+)-\d+$/,/^point-([A-Za-z0-9_]+)-\d+$/,/^data-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("quadrant")||l.includes("point")||l.includes("data"))){c=a;break}}a=a.parentElement}c?e.set(i,c):(n.tagName==="g"&&this.hasTargetableClass(n)||n.tagName==="circle"&&this.hasTargetableClass(n))&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.quadrant[data-id="${e}"]`,`g.point[data-id="${e}"]`,`g.data[data-id="${e}"]`,`circle.quadrant[data-id="${e}"]`,`circle.point[data-id="${e}"]`,`circle.data[data-id="${e}"]`,`g[class*="quadrant"][data-id="${e}"]`,`g[class*="point"][data-id="${e}"]`,`g[class*="data"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("point")||n.includes("data")))try{let o=t.getBBox(),i=o.x+o.width/2,a=o.y+o.height/2,c=Array.from(e.querySelectorAll('g[class*="quadrant"]'));for(let l of c)try{let p=l.getBBox();if(i>=p.x&&i<=p.x+p.width&&a>=p.y&&a<=p.y+p.height)return Array.from(l.querySelectorAll('g[class*="point"][data-id], circle[class*="point"][data-id], g[class*="data"][data-id], circle[class*="data"][data-id]')).filter(u=>u!==t)}catch{continue}}catch{return Array.from(e.querySelectorAll('g[class*="point"][data-id], circle[class*="point"][data-id], g[class*="data"][data-id], circle[class*="data"][data-id]')).filter(i=>i!==t)}return n&&n.includes("quadrant")?Array.from(t.querySelectorAll('g[class*="point"][data-id], circle[class*="point"][data-id], g[class*="data"][data-id], circle[class*="data"][data-id]')):[]}};var oe=class extends V{getDiagramType(){return"requirement"}getTargetableClasses(){return["requirement","function","relationship"]}getTargetableTags(){return["g","rect","path"]}extractNodeIds(t){let e=new Map,s=Array.from(t.querySelectorAll("g.node[id]"));for(let o of s){let i=o.getAttribute("id");i&&i.trim()&&e.set(i,o)}let n=Array.from(t.querySelectorAll("path[data-id].relationshipLine"));for(let o of n){let i=o.getAttribute("data-id");i&&i.trim()&&e.set(i,o)}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.node[id="${e}"]`,`[data-id="${e}"]`,`g:has([data-id="${e}"])`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("requirement")||n.includes("function"))){let o=Array.from(e.querySelectorAll('g[class*="relationship"][data-id], path[class*="relationship"]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();if(l.x<a.x+a.width&&l.x+l.width>a.x&&l.y<a.y+a.height&&l.y+l.height>a.y){let d=Array.from(e.querySelectorAll('g[class*="requirement"][data-id], g[class*="function"][data-id]'));for(let u of d)if(u!==t&&!i.includes(u))try{let m=u.getBBox();l.x<m.x+m.width&&l.x+l.width>m.x&&l.y<m.y+m.height&&l.y+l.height>m.y&&i.push(u)}catch{continue}}}catch{continue}}catch{return[]}return i}return[]}};var W=class extends V{constructor(t){super(),this.diagramType=t}getDiagramType(){return this.diagramType}getTargetableClasses(){return["c4","element","relationship","boundary"]}getTargetableTags(){return["g","rect","path","text"]}extractNodeIds(t){let e=new Map,s=[/^c4-([A-Za-z0-9_]+)-\d+$/,/^element-([A-Za-z0-9_]+)-\d+$/,/^relationship-([A-Za-z0-9_]+)-\d+$/,/^boundary-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)$/],n=[],o=Array.from(t.querySelectorAll("[id]"));for(let i of o){let a=i.getAttribute("id");if(!a)continue;n.push(a);let c=this.extractIdFromPatterns(a,s);if(c&&!e.has(c)){let l=i,p=null;for(;l&&l!==t;){if(l instanceof SVGElement&&l.tagName==="g"){let d=this.getElementClassName(l);if(d&&(d.includes("c4")||d.includes("element")||d.includes("relationship")||d.includes("boundary"))){p=l;break}}l=l.parentElement}p?e.set(c,p):i.tagName==="g"&&this.hasTargetableClass(i)&&e.set(c,i)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.c4[data-id="${e}"]`,`g.element[data-id="${e}"]`,`g.relationship[data-id="${e}"]`,`g.boundary[data-id="${e}"]`,`g[class*="c4"][data-id="${e}"]`,`g[class*="element"][data-id="${e}"]`,`g[class*="relationship"][data-id="${e}"]`,`g[class*="boundary"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("c4")||n.includes("element"))){let o=Array.from(e.querySelectorAll('g[class*="relationship"][data-id], path[class*="relationship"]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();if(l.x<a.x+a.width&&l.x+l.width>a.x&&l.y<a.y+a.height&&l.y+l.height>a.y){let d=Array.from(e.querySelectorAll('g[class*="c4"][data-id], g[class*="element"][data-id]'));for(let u of d)if(u!==t&&!i.includes(u))try{let m=u.getBBox();l.x<m.x+m.width&&l.x+l.width>m.x&&l.y<m.y+m.height&&l.y+l.height>m.y&&i.push(u)}catch{continue}}}catch{continue}}catch{return[]}return i}if(n&&n.includes("relationship")){let o=Array.from(e.querySelectorAll('g[class*="c4"][data-id], g[class*="element"][data-id]')),i=[];try{let a=t.getBBox();for(let c of o)try{let l=c.getBBox();a.x<l.x+l.width&&a.x+a.width>l.x&&a.y<l.y+l.height&&a.y+a.height>l.y&&i.push(c)}catch{continue}}catch{return[]}return i}return[]}};var le=class extends V{getDiagramType(){return"block"}getTargetableClasses(){return["block","node","edge"]}getTargetableTags(){return["g","rect","path"]}extractNodeIds(t){let e=new Map,s=[/^block-([A-Za-z0-9_]+)-\d+$/,/^node-([A-Za-z0-9_]+)-\d+$/,/^edge-([A-Za-z0-9_]+)-\d+$/,/^([A-Za-z0-9_]+)-\d+$/];for(let n of Array.from(t.querySelectorAll("[id]"))){let o=n.getAttribute("id");if(!o)continue;let i=this.extractIdFromPatterns(o,s);if(i&&!e.has(i)){let a=n,c=null;for(;a&&a!==t;){if(a instanceof SVGElement&&a.tagName==="g"){let l=this.getElementClassName(a);if(l&&(l.includes("block")||l.includes("node")||l.includes("edge"))){c=a;break}}a=a.parentElement}c?e.set(i,c):n.tagName==="g"&&this.hasTargetableClass(n)&&e.set(i,n)}}return e}getTargetSelectors(t){let e=this.escapeSelector(t);return[`g.block[data-id="${e}"]`,`g.node[data-id="${e}"]`,`g.edge[data-id="${e}"]`,`g[class*="block"][data-id="${e}"]`,`g[class*="node"][data-id="${e}"]`,`g[class*="edge"][data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){if(!t.getAttribute("data-id"))return[];let n=this.getElementClassName(t);if(n&&(n.includes("block")||n.includes("node"))){let o=Array.from(e.querySelectorAll('path.edge, path[class*="edge"], g.edge path, path[id*="edge"]')),i=[];try{let a=t.getBBox(),c=a.x+a.width/2,l=a.y+a.height/2;for(let p of o)try{let d=p.getBBox(),u=d.x+d.width/2,m=d.y+d.height/2,f=Math.max(a.width,a.height)*1.5,D=Math.sqrt(Math.pow(u-c,2)+Math.pow(m-l,2));if(d.x<a.x+a.width&&d.x+d.width>a.x&&d.y<a.y+a.height&&d.y+d.height>a.y||D<f){let E=Array.from(e.querySelectorAll("g.block[data-id], g.node[data-id]"));for(let g of E)if(g!==t&&!i.includes(g))try{let x=g.getBBox(),h=x.x+x.width/2,b=x.y+x.height/2,k=Math.sqrt(Math.pow(h-u,2)+Math.pow(b-m,2));(d.x<x.x+x.width&&d.x+d.width>x.x&&d.y<x.y+x.height&&d.y+d.height>x.y||k<f)&&i.push(g)}catch{continue}}}catch{continue}}catch{return[]}return i}return[]}};var ce=class extends V{getDiagramType(){return"mindmap"}getTargetableClasses(){return["node","mindmap-node"]}getTargetableTags(){return["g","path"]}extractNodeIds(t){let e=new Map,s=Array.from(t.querySelectorAll("g.mindmap-node"));for(let n of s){let o=n.textContent?.trim();if(!o)continue;let i=o.replace(/[()]/g,"").trim().replace(/\s+/g,"_");i&&e.set(i,n)}return e}getTargetSelectors(t){let e=t.replace(/"/g,'\\"');return[`g[data-id="${e}"]`,`g.mindmap-node[data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){return[]}};var Qe=r=>/^-?\d+(\.\d+)?$/.test(r),et=r=>{let t=r.trim();return t&&t.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_-]/g,"")||""},L=class extends V{constructor(e,s={}){super();this.diagramType=e;this.options=s}getDiagramType(){return this.diagramType}extractNodeIds(e){let s=new Map,n=new Map,o=this.options.maxTargets,i=Array.from(e.querySelectorAll("text"));for(let a of i){let c=(a.textContent??"").trim();if(!c||this.options.skipNumericLabels&&Qe(c))continue;let l=et(c);if(!l)continue;let p=this.findTargetGroupForText(a,e);if(!p)continue;let d=l,u=(n.get(d)??0)+1;if(n.set(d,u),u>1&&(l=`${d}_${u}`),s.has(l)||s.set(l,p),typeof o=="number"&&s.size>=o)break}return s}getTargetSelectors(e){let s=this.escapeSelector(e);return[`g[data-id="${s}"]`,`.node[data-id="${s}"]`,`.participant[data-id="${s}"]`,`.message[data-id="${s}"]`,`[data-id="${s}"]`]}findAdjacentElements(e,s){return[]}getTargetableClasses(){return["node","label","item","task","bar","slice"]}getTargetableTags(){return["g","rect","circle","ellipse","polygon","path","text"]}findTargetGroupForText(e,s){let n=e;for(;n&&n!==s;){let o=n.parentElement;if(!o||o===s)break;if(o.tagName.toLowerCase()==="g"){let i=o,a=typeof i.className=="string"?i.className:i.className.baseVal;if(!!o.querySelector("rect,circle,ellipse,polygon,path")||a.includes("node"))return i}n=o}for(n=e;n&&n!==s;){let o=n.parentElement;if(!o||o===s)break;let i=o.tagName.toLowerCase();if(i==="g"||i==="rect"||i==="circle"||i==="ellipse"||i==="polygon"||i==="path")return o;n=o}return null}};var de=class extends L{constructor(){super("xychart",{skipNumericLabels:!0,maxTargets:200})}};var ue=class extends V{getDiagramType(){return"kanban"}getTargetableClasses(){return["cluster","node","section"]}getTargetableTags(){return["g","rect"]}extractNodeIds(t){let e=new Map,s=Array.from(t.querySelectorAll("g[id]"));for(let n of s){let o=n.getAttribute("id"),i=n.getAttribute("class");o&&i&&(i.includes("cluster")||i.includes("node"))&&e.set(o,n)}return e}getTargetSelectors(t){let e=t.replace(/"/g,'\\"');return[`g[data-id="${e}"]`,`g[id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){return[]}};var pe=class extends V{getDiagramType(){return"packet"}getTargetableClasses(){return["packetBlock","packet"]}getTargetableTags(){return["g","rect","text"]}extractNodeIds(t){let e=new Map,s=new Map,n=Array.from(t.querySelectorAll("text.packetLabel"));for(let o of n){let i=o.textContent?.trim();if(!i)continue;let a=i.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_-]/g,"");if(!a)continue;let c=a,l=(s.get(c)??0)+1;s.set(c,l),l>1&&(a=`${c}_${l}`);let p=null,d=o.previousElementSibling;for(;d;){if(d.tagName.toLowerCase()==="rect"&&d.classList.contains("packetBlock")){p=d;break}d=d.previousElementSibling}if(p){let u=o.parentElement;if(u){let m=document.createElementNS("http://www.w3.org/2000/svg","g");m.setAttribute("data-id",a),u.insertBefore(m,p),m.appendChild(p),m.appendChild(o);let f=m.nextElementSibling;for(;f&&f.tagName.toLowerCase()==="text"&&f.classList.contains("packetByte");){let D=f;f=f.nextElementSibling,m.appendChild(D)}e.set(a,m)}}}return e}getTargetSelectors(t){let e=t.replace(/"/g,'\\"');return[`g[data-id="${e}"]`,`[data-id="${e}"]`]}findAdjacentElements(t,e){return[]}};var me=class extends L{constructor(){super("radar",{skipNumericLabels:!0,maxTargets:300})}};var he=class extends L{constructor(){super("sankey",{skipNumericLabels:!0,maxTargets:300})}};var ge=class extends L{constructor(){super("treemap",{skipNumericLabels:!0,maxTargets:300})}};var fe=class extends L{constructor(){super("zenuml",{skipNumericLabels:!0,maxTargets:300})}extractNodeIds(t){let e=new Map,s=Array.from(t.querySelectorAll("foreignObject"));for(let n of s){let o=Array.from(n.querySelectorAll(".participant, .message, .alias, .group"));for(let i of o){let a=(i.textContent??"").trim();if(!a||a.length>100)continue;let c=a.replace(/[«»<>]/g,"").replace(/Icon-[^\s]+/g,"").trim(),l=a.replace(/«[^»]*»/g,"").replace(/<<[^>]*>>/g,"").replace(/Icon-[^\s]+/g,"").trim(),p=new Set;p.add(a.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_-]/g,"")),p.add(c.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_-]/g,"")),p.add(l.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_-]/g,""));for(let d of p)!d||e.has(d)||e.set(d,i)}}return e.size===0?super.extractNodeIds(t):e}};M.register("flowchart",new K);M.register("gantt",new J);M.register("sequenceDiagram",new Q);M.register("classDiagram",new ee);M.register("stateDiagram",new U);M.register("stateDiagram-v2",new U);M.register("erDiagram",new te);M.register("pie",new ne);M.register("journey",new se);M.register("gitGraph",new re);M.register("timeline",new ae);M.register("quadrantChart",new ie);M.register("requirement",new oe);M.register("c4Context",new W("c4Context"));M.register("c4Container",new W("c4Container"));M.register("c4Component",new W("c4Component"));M.register("block",new le);M.register("mindmap",new ce);M.register("xychart",new de);M.register("kanban",new ue);M.register("packet",new pe);M.register("radar",new me);M.register("sankey",new he);M.register("treemap",new ge);M.register("zenuml",new fe);M.setDefault(new K);function tt(r,t,e){let s=t.extractNodeIds(r),n=t.getDiagramType(),o=e?st(e):new Set,i=new Set;if(n==="classDiagram"&&e){let E=/class\s+([A-Za-z0-9_]+)\s*[<{]/g,g;for(;(g=E.exec(e))!==null;)i.add(g[1]);let x=/class\s+([A-Za-z0-9_]+)(?:\s|$)/g;for(x.lastIndex=0;(g=x.exec(e))!==null;)i.add(g[1])}let a=new Set;if(n==="erDiagram"&&e){let E=/([A-Z][A-Z0-9_]+)\s*\{/g,g;for(;(g=E.exec(e))!==null;)a.add(g[1]);let x=/([A-Z][A-Z0-9_]+)\s*[|o]+--[|o]+/g;for(x.lastIndex=0;(g=x.exec(e))!==null;)a.add(g[1]);let h=/[|o]+--[|o]+\s*([A-Z][A-Z0-9_]+)/g;for(h.lastIndex=0;(g=h.exec(e))!==null;)a.add(g[1])}let c=new Set;if(n==="gitGraph"&&e){let E=/branch\s+([A-Za-z0-9_]+)/g,g;for(;(g=E.exec(e))!==null;)c.add(g[1]);let x=/checkout\s+([A-Za-z0-9_]+)/g;for(x.lastIndex=0;(g=x.exec(e))!==null;)c.add(g[1]);let h=/commit\s+id:\s*"([^"]+)"/g;for(h.lastIndex=0;(g=h.exec(e))!==null;)c.add(g[1]);let b=/merge\s+([A-Za-z0-9_]+)/g;for(b.lastIndex=0;(g=b.exec(e))!==null;)c.add(g[1]);c.add("merge")}let l=new Set;if(n==="journey"&&e){let E=e.split(`
`);for(let g of E){if(g.trim().startsWith("title")||g.trim().startsWith("section"))continue;let x=g.match(/^\s+([^:]+):\s*\d+:/);if(x&&x[1]){let h=x[1].trim();h&&!h.includes(`
`)&&l.add(h)}}}let p=new Set;if(n==="pie"&&e){let E=/"([^"]+)"\s*:\s*\d+\.?\d*/g,g;for(E.lastIndex=0;(g=E.exec(e))!==null;){let x=g[1].trim();x&&p.add(x)}}let d=new Set;if(n==="quadrantChart"&&e){let E=/"?([^":\n]+)"?\s*:\s*\[?[\d.]+\s*,\s*[\d.]+\]?/g,g;for(E.lastIndex=0;(g=E.exec(e))!==null;){let x=g[1].trim();x&&d.add(x)}}let u=new Set;if(n==="requirement"&&e){let E=/requirement\s+([A-Za-z0-9_]+)\s*\{/g,g;for(E.lastIndex=0;(g=E.exec(e))!==null;){let b=g[1].trim();b&&u.add(b)}let x=/element\s+([A-Za-z0-9_]+)\s*\{/g,h;for(x.lastIndex=0;(h=x.exec(e))!==null;){let b=h[1].trim();b&&u.add(b)}}let m=new Set;if(n==="sequenceDiagram"&&e){let E=/(?:participant|actor)\s+([A-Za-z0-9_]+)/g,g;for(E.lastIndex=0;(g=E.exec(e))!==null;){let b=g[1].trim();b&&m.add(b)}let x=/(?:->>|->|-->>|-->)\s*[A-Za-z0-9_]+\s*:\s*([^\n]+)/g,h;for(x.lastIndex=0;(h=x.exec(e))!==null;){let b=h[1].trim();b&&m.add(b)}}let f=new Set;if(n==="timeline"&&e){let E=/section\s+([^\n]+)/g,g;for(E.lastIndex=0;(g=E.exec(e))!==null;){let x=g[1].trim();x&&f.add(x)}}if(e&&((n==="c4Component"||n==="c4Container"||n==="c4Context")&&(s.size===0||s.size<o.size)||n==="classDiagram"&&(s.size===0||s.size<i.size)||n==="erDiagram"&&(s.size===0||s.size<a.size)||n==="gitGraph"&&(s.size===0||s.size<c.size)||n==="journey"&&(s.size===0||s.size<l.size)||n==="pie"&&(s.size===0||s.size<p.size)||n==="quadrantChart"&&(s.size===0||s.size<d.size)||n==="requirement"&&(s.size===0||s.size<u.size)||n==="sequenceDiagram"&&(s.size===0||s.size<m.size)||n==="timeline"&&(s.size===0||s.size<f.size))){let E={};if(n==="c4Container"||n==="c4Context"){let h=/(?:Container_Boundary|System_Boundary)\s*\(\s*([A-Za-z0-9_]+)\s*,[\s\S]*?\{([\s\S]*?)\}/g,b;for(h.lastIndex=0;(b=h.exec(e))!==null;){let k=b[1],B=b[2],$=[/Container\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/Component\s*\(\s*([A-Za-z0-9_]+)\s*,/g],C=[];for(let w of $){w.lastIndex=0;let G;for(;(G=w.exec(B))!==null;)C.push(G[1])}C.length>0&&(E[k]=C)}}let g=n==="classDiagram"?i:n==="erDiagram"?a:n==="gitGraph"?c:n==="journey"?l:n==="pie"?p:n==="quadrantChart"?d:n==="requirement"?u:n==="sequenceDiagram"?m:n==="timeline"?f:o,x=n==="erDiagram"||n==="gitGraph"||n==="journey"||n==="pie"||n==="quadrantChart"||n==="requirement"||n==="sequenceDiagram"?Array.from(g).sort((h,b)=>b.length!==h.length?b.length-h.length:h.localeCompare(b)):Array.from(g);for(let h of x){if(s.has(h)||E[h])continue;let b=h.toLowerCase(),B=Array.from(r.querySelectorAll("*")).filter(C=>{let w=C.textContent?.toLowerCase()||"";if(n==="erDiagram"){let v=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${v.replace(/_/g,"\\_")}\\b`,"i").test(w))return!0;let P=h.replace(/_/g,"").toLowerCase();if(w.trim().startsWith(P)||w.trim().endsWith(P)||new RegExp(`\\b${P}\\b`,"i").test(w)||w.trim().startsWith(b)||w.trim().endsWith(b))return!0}if(n==="gitGraph"){let v=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\b${v}\\b`,"i").test(w)||w.trim().startsWith(b)||w.trim().endsWith(b))return!0}if(n==="journey"){let v=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(v.replace(/\s+/g,"\\s+"),"i").test(w)||new RegExp(`\\b${v.replace(/\s+/g,"\\s+")}\\b`,"i").test(w)||w.trim().startsWith(b)||w.trim().endsWith(b))return!0}if(n==="timeline"){let v=w.replace(/\s+/g," ").trim().toLowerCase(),N=b.replace(/\s+/g," ").trim();if(v.includes(N))return!0;let I=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(I.replace(/\s+/g,"\\s+"),"i").test(w)||v.startsWith(N)||v.endsWith(N))return!0}if(n==="classDiagram"&&(new RegExp(`\\b${h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(w)||w.trim().startsWith(b)||w.trim().endsWith(b)))return!0;let G=b==="db"?/<<system_db>>/i:null;if(G&&G.test(w)||w.includes(b)&&(w.startsWith(b)||w.includes(" "+b)||w.includes(b+" ")||w.includes("<<"+b)||w.includes(b+">>")))return!0;let y=h.replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase();if(y!==b&&y.includes(" ")){let v=y.split(" ");if(v.length>1&&v.every(N=>w.includes(N))){let N=v.join("");if(w.includes(N)||v.every((I,P)=>{if(P===0)return w.includes(I);let R=v[P-1];return w.includes(R+" "+I)||w.includes(R+I)}))return!0}}if(b.length>3){let v=["app","api","ui","db","service","system","user"];for(let N of v)if(b.endsWith(N)&&b.length>N.length){let I=b.slice(0,-N.length);if(w.includes(I)&&(w.includes(N)||w.includes(N+"lication")||w.includes(N+"i"))&&(w.includes(I+" "+N)||w.includes(I+N)||w.includes(I)&&w.includes(N+"lication")))return!0}}return!1}),$=!1;for(let C of B){let w=C,G=null;if(n==="pie"){let y=null,v=C;for(;v&&v!==r;){if(v instanceof SVGElement&&v.tagName==="g"){let N=typeof v.className=="string"?v.className:v.className.baseVal;if(N&&N.includes("legend")){y=v;break}}v=v.parentElement}if(y){let N=Array.from(r.querySelectorAll("path")),I=Array.from(r.querySelectorAll("g")).filter(_=>{let z=typeof _.className=="string"?_.className:_.className.baseVal;return z&&z.includes("legend")}),P=y?I.indexOf(y):-1,R=N.filter(_=>{let z=_.getAttribute("d");return z&&z.includes("M")&&(z.includes("A")||z.includes("L"))});if(P>=0&&P<R.length){let _=R[P];if(_ instanceof SVGGraphicsElement){let z=String(h);if(!s.has(z)){s.set(z,_),$=!0;continue}}}}}if(n==="sequenceDiagram"&&C instanceof SVGElement){let y=typeof C.className=="string"?C.className:C.className.baseVal;if(y&&y.includes("message")){let v=null;try{if(C instanceof SVGGraphicsElement){let I=C.getBBox(),P=Array.from(r.querySelectorAll("line, path"));for(let R of P)try{let _=R.getBBox();if(Math.sqrt(Math.pow(I.x+I.width/2-(_.x+_.width/2),2)+Math.pow(I.y+I.height/2-(_.y+_.height/2),2))<150){let T=R.parentElement;for(;T&&T!==r;){if(T instanceof SVGElement&&T.tagName==="g"){let H=typeof T.className=="string"?T.className:T.className.baseVal;if(H&&(H.includes("message")||T.contains(C))){v=T;break}}T=T.parentElement}if(v)break;v=R;break}}catch{continue}}}catch{}let N=C;for(;N&&N!==r&&!v;){if(N instanceof SVGElement&&N.tagName==="g"){let I=typeof N.className=="string"?N.className:N.className.baseVal;if(I&&I.includes("message")){v=N;break}}N=N.parentElement}if(v?G=v:C instanceof SVGGraphicsElement&&(G=C),G){$=!0;let I=String(h),P=null;for(let[R,_]of s.entries())if(R===I){P=_;break}P&&P!==G&&s.delete(I),s.has(I)||s.set(I,G);continue}}}if(n==="quadrantChart"){let y=C;for(;y&&y!==r;){if(y instanceof SVGElement&&y.tagName==="g"){let v=typeof y.className=="string"?y.className:y.className.baseVal;if(v&&v.includes("data-point")&&!v.includes("data-points")&&!v.includes("main")&&y.querySelector("circle")){G=y,$=!0;let N=String(h),I=null;for(let[R,_]of s.entries())if(R===N){I=_;break}if(I){let R=typeof I.className=="string"?I.className:I.className.baseVal;R&&(R.includes("main")||R.includes("data-points"))&&s.delete(N)}let P=null;for(let[R,_]of s.entries())if(_===G){P=R;break}if(P&&N.length<=P.length){$=!1;break}P&&s.delete(P),s.set(N,G);break}}y=y.parentElement}if($&&G)continue}for(;w&&w!==r;){if(w instanceof SVGElement&&w.tagName==="g"){let y=w instanceof SVGElement?typeof w.className=="string"?w.className:w.className.baseVal:"",v=w.querySelector("rect, circle, ellipse, polygon, path");if(n==="pie"&&y&&y.includes("legend")){w=w.parentElement;continue}if(n==="quadrantChart"&&y&&(y.includes("main")||y.includes("data-points"))){w=w.parentElement;continue}if(n==="quadrantChart"&&y&&(y.includes("point")||y.includes("quadrant")||y.includes("data"))){if(y&&y.includes("data-point")&&!y.includes("data-points")){if(G=w,w.querySelector("circle"))break}else if(!G&&!y.includes("main")&&!y.includes("data-points")&&(G=w,w.querySelector("circle")))break}if((y&&(y.includes("c4")||y.includes("element")||y.includes("component")||y.includes("container")||y.includes("relationship")||y.includes("boundary")||y.includes("branch")||y.includes("commit")||y.includes("merge")||y.includes("branchLabel")||y.includes("label")||y.includes("step")||y.includes("task")||y.includes("section")||y.includes("journey")||y.includes("slice")||y.includes("segment")||y.includes("pie")||y.includes("quadrant")||y.includes("point")||y.includes("timeline")||y.includes("event"))||v||!G)&&(G=w,v||y&&(y.includes("branchLabel")||y.includes("label")||y.includes("step")||y.includes("task")||y.includes("slice")||y.includes("point")||y.includes("quadrant"))))break}w=w.parentElement}if(G){let y=String(h);if(n==="quadrantChart"){let v=s.get(y);if(v){let N=typeof v.className=="string"?v.className:v.className.baseVal;if(N&&(N.includes("main")||N.includes("data-points"))||N&&N.includes("data-point")&&!N.includes("data-points"))continue}}if(n==="erDiagram"||n==="gitGraph"||n==="journey"||n==="pie"||n==="quadrantChart"){let v=null;for(let[N,I]of s.entries())if(I===G){v=N;break}if(v&&y.length<=v.length)continue;v&&s.delete(v)}s.has(y)||(s.set(y,G),$=!0);break}}}for(let[h,b]of Object.entries(E)){if(s.has(h))continue;let k=[];for(let B of b)if(s.has(B))k.push(s.get(B));else{let $=r.querySelector(`[data-id="${B}"]`);$&&$ instanceof SVGElement&&k.push($)}if(k.length>=Math.min(2,b.length)){let B=Array.from(r.querySelectorAll("g")),$=[];for(let w of B){let G=!0;for(let y of k)if(!w.contains(y)){G=!1;break}G&&$.push(w)}let C=null;if($.length===0){let w=!0;for(let G of k)if(!r.contains(G)){w=!1;break}w&&(C=r)}else for(let w of $){let G=w instanceof SVGElement?typeof w.className=="string"?w.className:w.className.baseVal:"";if(!!w.querySelector("rect, circle, ellipse, polygon, path")||G.includes("boundary")||G.includes("container")||G.includes("system")){C=w;break}C||(C=w)}C&&!s.has(h)&&s.set(h,C)}}}let A=new Map;if(n==="gitGraph"&&e){let E=/merge\s+([A-Za-z0-9_]+)/g,g=e.split(`
`);E.lastIndex=0;let x;for(;(x=E.exec(e))!==null;){let h=g.findIndex(b=>b.includes(x[0]));if(h>=0&&h<g.length-1){let k=g[h+1].match(/commit\s+id:\s*"([^"]+)"/);k&&k[1]&&s.has(k[1])&&(A.has("merge")||A.set("merge",k[1]))}}}for(let[E,g]of s)g.setAttribute("data-id",E);for(let[E,g]of A.entries()){let x=s.get(g);x&&(s.set(E,x),x.setAttribute("data-id",E))}for(let[E,g]of A.entries()){let x=s.get(g);x&&(x.setAttribute("data-id-merge",E),s.has(E)||(s.set(E,x),x.setAttribute("data-id",E)))}}var nt=(r,t,e)=>({getRoot:()=>t,getContainer:()=>r,resolveTarget:s=>F({getRoot:()=>t,getStrategy:()=>e},s),getStrategy:()=>e,destroy:()=>{r.innerHTML=""}});function st(r){let t=new Set,e=[/Component\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/Container\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/Person\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/System\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/System_Ext\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/SystemDb\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/Container_Boundary\s*\(\s*([A-Za-z0-9_]+)\s*,/g,/System_Boundary\s*\(\s*([A-Za-z0-9_]+)\s*,/g];for(let s of e){s.lastIndex=0;let n;for(;(n=s.exec(r))!==null;)t.add(n[1])}return t}var $e=()=>({async render({mountEl:r,mermaidText:t}){let e=window.mermaid;if(!e||typeof e.render!="function")throw new q("Mermaid is not available on window.mermaid","MPF_MERMAID_UNAVAILABLE",{mermaidAvailable:typeof window.mermaid<"u"});let s=`finsteps-${Math.random().toString(36).slice(2,8)}`,n;if(X(t)==="zenuml"){console.log("[MermaidAdapter] ZenUML detected, checking registry...");let u=e.diagrams||{};console.log("[MermaidAdapter] Registered diagrams:",Object.keys(u))}try{n=await e.render(s,t)}catch(u){let m=X(t);throw new q(`Failed to render Mermaid diagram (type: ${m}): ${u}`,"MPF_MERMAID_RENDER_FAILED",{mermaidTextLength:t?.length||0,detectedType:m,errorMessage:u instanceof Error?u.message:String(u)})}let{svg:o}=n;r.innerHTML="";let i=document.createElement("div");i.className="finsteps-diagram",i.tabIndex=0,i.setAttribute("role","application"),i.innerHTML=o,r.appendChild(i);let a=i.querySelector("svg");if(!a)throw new q("Mermaid render did not return an SVG element","MPF_MERMAID_RENDER_FAILED");let c=X(t),l=M.getOrDefault(c);c==="zenuml"&&await new Promise(u=>setTimeout(u,100)),tt(a,l,t),a.removeAttribute("width"),a.removeAttribute("height"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.getAttribute("preserveAspectRatio")||a.setAttribute("preserveAspectRatio","xMidYMid meet");let p=a.getAttribute("viewBox"),d=p;if(!p||p==="0 0 0 0"){let u=a.querySelector("g");if(u)try{let m=u.getBBox();m.width>0&&m.height>0&&(d=`${m.x-40} ${m.y-40} ${m.width+40*2} ${m.height+40*2}`,a.setAttribute("viewBox",d))}catch{let m=a.getAttribute("width"),f=a.getAttribute("height");if(m&&f){let D=parseFloat(m)||1e3,A=parseFloat(f)||1e3;d=`0 0 ${D} ${A}`,a.setAttribute("viewBox",d)}}}return d&&a.setAttribute("data-initial-viewbox",d),nt(i,a,l)}});var ye=class{constructor(t){this.handlers=t}async run(t,e,s){let n=[];for(let o of t){let i=this.handlers[o.type];if(!i){let a=new Z(`Unknown action: ${o.type}`,"MPF_ACTION_UNKNOWN",{actionType:o.type});if(s==="haltOnError")throw a;n.push(a);continue}try{await i(e,o)}catch(a){if(a instanceof Error){if(s==="haltOnError")throw a;n.push(a)}else if(s==="haltOnError")throw a}}return n}};var Re=(r,t,e)=>{for(let s of r.elements)s.classList.remove(r.className);r.elements.clear(),r.className=e;for(let s of t)s.classList.add(e),r.elements.add(s)},rt=(r,t)=>{if(!t)return[];let e=F(r.diagram,t);return e?[e]:[]},_e=()=>{let r={className:"finsteps-highlight",elements:new Set};return{"nav.next":async({controller:e})=>{await e.next()},"nav.prev":async({controller:e})=>{await e.prev()},"nav.goto":async({controller:e},s)=>{let n=s.payload?.index,o=s.payload?.id;if(typeof n=="number"){await e.goto(n);return}if(typeof o=="string"){await e.goto(o);return}throw new Z("nav.goto requires index or id","MPF_ACTION_INVALID_ARGS")},"nav.reset":async({controller:e})=>{await e.reset()},"camera.fit":async(e,s)=>{if(!e.camera)return;let n=s.payload?.target,o=F(e.diagram,n);if(!o)throw new Z("camera.fit missing target","MPF_ACTION_INVALID_ARGS",{target:n?JSON.stringify(n):void 0});let a=s.payload?.durationMs??s.payload?.duration,c=s.payload?.easing;await e.camera.fit(o,{padding:typeof s.payload?.padding=="number"?s.payload.padding:void 0,duration:typeof a=="number"?a:void 0,easing:typeof c=="string"?c:void 0})},"camera.reset":({camera:e})=>{e?.reset()},"camera.fitAll":(e,s)=>{if(!e.camera)return;let n=typeof s.payload?.padding=="number"?s.payload.padding:void 0;e.camera.fitAll?e.camera.fitAll(n):e.camera.reset&&e.camera.reset()},"overlay.bubble":(e,s)=>{if(!e.overlay)return;let n=s.payload?.target,o=F(e.diagram,n);if(!o)throw new Z("overlay.bubble missing target","MPF_ACTION_INVALID_ARGS",{target:n?JSON.stringify(n):void 0});let i=String(s.payload?.text??"");e.overlay.showBubble({id:typeof s.payload?.id=="string"?s.payload.id:void 0,target:o,text:i})},"overlay.hide":(e,s)=>{e.overlay?.hideBubble(typeof s.payload?.id=="string"?s.payload.id:void 0)},"style.highlight":(e,s)=>{let n=s.payload?.target,o=typeof s.payload?.className=="string"?s.payload.className:"finsteps-highlight",i=rt(e,n);Re(r,i,o)},"style.clear":()=>{Re(r,[],r.className)},wait:async(e,s)=>{let n=typeof s.payload?.ms=="number"?s.payload.ms:typeof s.payload?.duration=="number"?s.payload.duration:0;await new Promise(o=>window.setTimeout(o,n))}}};var Y=class{constructor(){this.disposers=[];this.timeouts=[]}bind(t,e){for(let s of t){if(s.event==="timer"){let c=window.setTimeout(async()=>{let l=await e.actionEngine.run(s.actions,{controller:e.controller,diagram:e.diagram,event:{type:"timer",target:null,currentTarget:null,originalEvent:null,timeStamp:Date.now()},camera:e.camera,overlay:e.overlay},e.errorPolicy);for(let p of l)e.onError(p)},s.delayMs??0);this.timeouts.push(c);continue}let n=s.event==="key"?e.diagram.getContainer():e.diagram.getRoot(),o=F(e.diagram,s.target)??n,i=s.event==="click"?"click":s.event==="hover"?"mouseenter":s.event==="key"?"keydown":s.eventName??s.event,a=async c=>{if(s.event==="key"&&s.key&&c.key!==s.key)return;let l=at(c,i),p=await e.actionEngine.run(s.actions,{controller:e.controller,diagram:e.diagram,event:l,camera:e.camera,overlay:e.overlay},e.errorPolicy);for(let d of p)e.onError(d)};o.addEventListener(i,a),this.disposers.push(()=>o.removeEventListener(i,a))}}destroy(){for(let t of this.disposers)t();for(let t of this.timeouts)window.clearTimeout(t);this.disposers=[],this.timeouts=[]}},at=(r,t)=>r instanceof MouseEvent?{type:t,target:r.target,currentTarget:r.currentTarget,clientX:r.clientX,clientY:r.clientY,timeStamp:r.timeStamp,originalEvent:r}:r instanceof KeyboardEvent?{type:t,target:r.target,currentTarget:r.currentTarget,key:r.key,timeStamp:r.timeStamp,originalEvent:r}:{type:t,target:r.target,currentTarget:r.currentTarget,timeStamp:r.timeStamp,originalEvent:r};var Se=class{constructor(){this.listeners=new Map}on(t,e){let s=this.listeners.get(t)??new Set;return s.add(e),this.listeners.set(t,s),()=>{s.delete(e)}}emit(t,e){let s=this.listeners.get(t);if(s)for(let n of s)n(e)}clear(){this.listeners.clear()}};var xe=class{constructor(t){this.deps=t;this.emitter=new Se;this.bindingEngine=new Y;this.stepBindingEngine=new Y;this.currentStepIndex=-1;this.previousStepIndex=-1;this.lastError=null;this.failedStepIndex=null;this.executionContext={};let e={..._e(),...t.actionHandlers??{}};this.actionEngine=new ye(e),this.steps=t.ast.steps??[]}async init(t){if(t&&this.emitter.emit("render",t),this.deps.ast.bindings?.length&&this.bindingEngine.bind(this.deps.ast.bindings,{diagram:this.deps.diagram,actionEngine:this.actionEngine,errorPolicy:this.deps.errorPolicy,controller:this,camera:this.deps.camera,overlay:this.deps.overlay,onError:e=>this.emitActionError(e)}),this.steps.length>0&&await this.goto(0),this.deps.hooks?.onInit)try{await this.deps.hooks.onInit(this)}catch(e){console.warn("[MermaidController] onInit hook error:",e)}}async next(){await this.goto(this.currentStepIndex+1)}async prev(){await this.goto(this.currentStepIndex-1)}async goto(t){let e=typeof t=="number"?t:this.steps.findIndex(p=>p.id===t);if(e<0||e>=this.steps.length)return;let s=this.steps[e],n=s.errorPolicy??this.deps.errorPolicy;this.previousStepIndex=this.currentStepIndex;let o=this.previousStepIndex>=0?this.steps[this.previousStepIndex]:void 0;this.executionContext.previousStep=o,this.executionContext.currentStep=s,this.stepBindingEngine.destroy(),this.deps.overlay?.clear&&this.deps.overlay.clear();let i=s.actions.length>0&&(s.actions[0].type==="camera.fit"||s.actions[0].type==="camera.reset"||s.actions[0].type==="camera.fitAll");this.deps.camera&&!i&&this.deps.camera.reset(),await this.actionEngine.run([{type:"style.clear"}],{controller:this,diagram:this.deps.diagram,camera:this.deps.camera,overlay:this.deps.overlay},"continueOnError"),await new Promise(p=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>p())})});let a=[],c=!1;try{for(let d of s.actions){this.executionContext.currentAction=d;let u={action:{...d},step:{...s},context:this.getExecutionContext()};if(this.emitter.emit("actionstart",u),this.deps.hooks?.onActionStart)try{this.deps.hooks.onActionStart(d,s)}catch(m){console.warn("[MermaidController] onActionStart hook error:",m)}}let p=await this.actionEngine.run(s.actions,{controller:this,diagram:this.deps.diagram,camera:this.deps.camera,overlay:this.deps.overlay},n);a=p;for(let d of s.actions){let u=p.find(D=>D instanceof Error&&D.message.includes(d.type)),m={success:!u,error:u},f={action:{...d},result:m,step:{...s},context:this.getExecutionContext()};if(this.emitter.emit("actioncomplete",f),this.deps.hooks?.onActionComplete)try{this.deps.hooks.onActionComplete(d,m)}catch(D){console.warn("[MermaidController] onActionComplete hook error:",D)}}for(let d of p)this.emitActionError(d,s)}catch(p){c=!0;let d=p instanceof Error?p:new Error(String(p));if(this.lastError=d,this.failedStepIndex=e,this.emitActionError(d,s),n==="haltOnError"){this.currentStepIndex=e,this.emitter.emit("stepchange",{state:this.getState(),previousState:{stepIndex:this.previousStepIndex,stepId:this.steps[this.previousStepIndex]?.id,stepCount:this.steps.length},step:{...s},previousStep:o?{...o}:void 0});return}}!c&&a.length===0&&(this.lastError=null,this.failedStepIndex=null),this.currentStepIndex=e,s.bindings?.length&&this.stepBindingEngine.bind(s.bindings,{diagram:this.deps.diagram,actionEngine:this.actionEngine,errorPolicy:n,controller:this,camera:this.deps.camera,overlay:this.deps.overlay,onError:p=>this.emitActionError(p,s)}),this.executionContext.currentAction=void 0;let l={state:this.getState(),previousState:{stepIndex:this.previousStepIndex,stepId:this.steps[this.previousStepIndex]?.id,stepCount:this.steps.length},step:{...s},previousStep:o?{...o}:void 0};if(this.emitter.emit("stepchange",l),this.deps.hooks?.onStepChange)try{await this.deps.hooks.onStepChange(this.getState(),s)}catch(p){console.warn("[MermaidController] onStepChange hook error:",p)}}async reset(){await this.goto(0)}async retry(){this.failedStepIndex!==null&&this.failedStepIndex>=0?await this.goto(this.failedStepIndex):this.currentStepIndex>=0&&await this.goto(this.currentStepIndex)}clearError(){this.lastError=null,this.failedStepIndex=null}async updateAst(t,e){let s=e?.preserveState??!1,n=this.getState(),o=this.steps[this.currentStepIndex]?.id;if(this.deps.ast=t,this.steps=t.steps??[],this.bindingEngine.destroy(),t.bindings?.length&&this.bindingEngine.bind(t.bindings,{diagram:this.deps.diagram,actionEngine:this.actionEngine,errorPolicy:this.deps.errorPolicy,controller:this,camera:this.deps.camera,overlay:this.deps.overlay,onError:i=>this.emitActionError(i)}),s&&o){let i=this.steps.findIndex(a=>a.id===o);i>=0?(this.currentStepIndex=i,await this.goto(i)):this.steps.length>0?await this.goto(0):this.currentStepIndex=-1}else this.steps.length>0?await this.goto(0):this.currentStepIndex=-1;this.emitter.emit("astchange",{previousState:n,newState:this.getState(),previousSteps:n.stepCount,newSteps:this.steps.length})}destroy(){this.bindingEngine.destroy(),this.stepBindingEngine.destroy(),this.deps.camera?.destroy(),this.deps.overlay?.destroy(),this.deps.diagram.destroy(),this.emitter.clear()}getState(){return{stepIndex:this.currentStepIndex,stepId:this.steps[this.currentStepIndex]?.id,stepCount:this.steps.length,errorState:this.lastError?{hasError:!0,lastError:this.lastError,failedStep:this.failedStepIndex??void 0}:void 0}}getExecutionContext(){return{currentAction:this.executionContext.currentAction?{...this.executionContext.currentAction}:void 0,currentStep:this.executionContext.currentStep?{...this.executionContext.currentStep}:void 0,previousStep:this.executionContext.previousStep?{...this.executionContext.previousStep}:void 0}}async setState(t){if(typeof t.stepIndex=="number"){await this.goto(t.stepIndex);return}typeof t.stepId=="string"&&await this.goto(t.stepId)}on(t,e){return this.emitter.on(t,e)}getDeps(){return{diagram:this.deps.diagram,camera:this.deps.camera,overlay:this.deps.overlay}}getSteps(){return this.steps.map(t=>({...t}))}getCurrentStep(){return this.currentStepIndex<0||this.currentStepIndex>=this.steps.length?null:{...this.steps[this.currentStepIndex]}}getActionEngine(){return this.actionEngine}emitActionError(t,e){this.lastError=t;let s={step:e?{...e}:this.executionContext.currentStep,action:this.executionContext.currentAction},n={error:t,...s,context:this.getExecutionContext()};if(this.emitter.emit("actionerror",n),this.emitter.emit("error",n),this.deps.hooks?.onError)try{this.deps.hooks.onError(t,s)}catch(o){console.warn("[MermaidController] onError hook error:",o)}}};var it={compact:{button:28,fontSize:12,gap:4,padding:6,borderRadius:6},normal:{button:40,fontSize:16,gap:8,padding:12,borderRadius:50},large:{button:52,fontSize:20,gap:12,padding:16,borderRadius:50}},ot={dark:{containerBg:"rgba(15, 23, 42, 0.85)",buttonBg:"rgba(30, 41, 59, 0.9)",buttonHoverBg:"rgba(51, 65, 85, 0.95)",buttonColor:"#e2e8f0",indicatorColor:"#94a3b8",borderColor:"rgba(51, 65, 85, 0.5)"},light:{containerBg:"rgba(255, 255, 255, 0.9)",buttonBg:"rgba(241, 245, 249, 0.95)",buttonHoverBg:"rgba(226, 232, 240, 1)",buttonColor:"#334155",indicatorColor:"#64748b",borderColor:"rgba(203, 213, 225, 0.5)"}};function lt(r){return r==="auto"?typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark":r}function j(r,t,e,s){let n=document.createElement("button");n.className="finsteps-control-btn",n.setAttribute("aria-label",t),n.title=t;let i={play:"\u25B6",pause:"\u23F8",prev:"\u25C0",next:"\u25B6",zoomIn:"+",zoomOut:"\u2212",fitAll:"\u229E",reset:"\u21BA"}[r]||r;n.innerHTML=`<span class="finsteps-control-icon">${i}</span>`;let{size:a,theme:c}=s;return n.style.cssText=`
    display: flex;
    align-items: center;
    justify-content: center;
    width: ${a.button}px;
    height: ${a.button}px;
    border: none;
    border-radius: ${a.borderRadius}px;
    background: ${c.buttonBg};
    color: ${c.buttonColor};
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: ${a.fontSize}px;
    backdrop-filter: blur(8px);
  `,n.addEventListener("mouseenter",()=>{n.style.background=c.buttonHoverBg,n.style.transform="scale(1.1)"}),n.addEventListener("mouseleave",()=>{n.style.background=c.buttonBg,n.style.transform="scale(1)"}),n.addEventListener("click",l=>{l.stopPropagation(),e()}),n}function ze(r){let{controller:t,camera:e,position:s="bottom-right",showPlayPause:n=!0,showPrevNext:o=!0,showZoomControls:i=!0,showStepIndicator:a=!0,autoHide:c=!1,offset:l={x:20,y:20},size:p="normal",theme:d="dark",playbackSpeed:u=3e3,showReset:m=!1,orientation:f="vertical"}=r,D=it[p],A=lt(d),E=ot[A],g={size:D,theme:E},x=f==="horizontal",h=document.createElement("div");h.className="finsteps-floating-controls",h.style.cssText=`
    position: fixed;
    z-index: 10000;
    display: flex;
    flex-direction: ${x?"row":"column"};
    gap: ${D.gap}px;
    padding: ${D.padding}px;
    background: ${E.containerBg};
    backdrop-filter: blur(12px);
    border-radius: ${p==="compact"?"8px":"16px"};
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    pointer-events: auto;
  `;let b={"bottom-right":{bottom:`${l.y}px`,right:`${l.x}px`},"bottom-left":{bottom:`${l.y}px`,left:`${l.x}px`},"top-right":{top:`${l.y}px`,right:`${l.x}px`},"top-left":{top:`${l.y}px`,left:`${l.x}px`},"bottom-center":{bottom:`${l.y}px`,left:"50%",transform:"translateX(-50%)"}};Object.assign(h.style,b[s]||b["bottom-right"]);let k=document.createElement("div");k.className="finsteps-control-group",k.style.cssText=`
    display: flex;
    gap: ${D.gap}px;
    align-items: center;
  `;let B=!1,$=null,C=()=>{$&&(clearInterval($),$=null),B=!1,y()},w=()=>{(t.getSteps?.()||[]).length!==0&&(B=!0,y(),$=setInterval(()=>{let H=t.getState();H.stepIndex<H.stepCount-1?t.next().catch(()=>C()):C()},u))},G=n?j("play","Play/Pause",()=>{B?C():w()},g):null,y=()=>{if(!G)return;let T=G.querySelector(".finsteps-control-icon");T&&(T.textContent=B?"\u23F8":"\u25B6"),G.title=B?"Pause":"Play"},v=o?j("prev","Previous Step",()=>{C(),t.prev().catch(()=>{})},g):null,N=o?j("next","Next Step",()=>{C(),t.next().catch(()=>{})},g):null,I=m?j("reset","Reset",()=>{C(),t.reset().catch(()=>{})},g):null;v&&k.appendChild(v),G&&k.appendChild(G),N&&k.appendChild(N),I&&k.appendChild(I);let P=a?document.createElement("div"):null;if(P){P.className="finsteps-step-indicator";let T=p==="compact"?10:p==="large"?14:12,H=p==="compact"?"4px 8px":"6px 12px",be=p==="compact"?"40px":"80px";P.style.cssText=`
      padding: ${H};
      background: ${E.buttonBg};
      border-radius: ${p==="compact"?"4px":"8px"};
      color: ${E.indicatorColor};
      font-size: ${T}px;
      font-family: monospace;
      text-align: center;
      min-width: ${be};
    `,k.appendChild(P)}if(h.appendChild(k),i&&e){let T=document.createElement("div");T.className="finsteps-control-group";let H=x?`border-left: 1px solid ${E.borderColor}; padding-left: ${D.gap}px;`:`border-top: 1px solid ${E.borderColor}; padding-top: ${D.gap}px;`;T.style.cssText=`
      display: flex;
      gap: ${D.gap}px;
      align-items: center;
      ${H}
    `;let be=j("zoomOut","Zoom Out",()=>{e.zoom&&e.zoom(.8)},g),Ze=j("zoomIn","Zoom In",()=>{e.zoom&&e.zoom(1.2)},g),je=j("fitAll","Fit All",()=>{e.fitAll&&e.fitAll()},g);T.appendChild(be),T.appendChild(Ze),T.appendChild(je),h.appendChild(T)}document.body.appendChild(h);let R=T=>{P&&(P.textContent=p==="compact"?`${T.stepIndex+1}/${T.stepCount}`:`Step ${T.stepIndex+1} / ${T.stepCount}`),v&&(v.disabled=T.stepIndex<=0,v.style.opacity=T.stepIndex<=0?"0.5":"1",v.style.cursor=T.stepIndex<=0?"not-allowed":"pointer"),N&&(N.disabled=T.stepIndex>=T.stepCount-1,N.style.opacity=T.stepIndex>=T.stepCount-1?"0.5":"1",N.style.cursor=T.stepIndex>=T.stepCount-1?"not-allowed":"pointer"),B&&T.stepIndex>=T.stepCount-1&&C()},_=t.on("stepchange",T=>{T&&typeof T=="object"&&"state"in T?R(T.state):T&&typeof T=="object"&&"stepIndex"in T&&R(T)});R(t.getState());let z=null;if(c){let T=()=>{z&&clearTimeout(z),h.style.opacity="1",z=setTimeout(()=>{h.style.opacity="0.3"},3e3)};h.addEventListener("mouseenter",()=>{h.style.opacity="1",z&&clearTimeout(z)}),h.addEventListener("mouseleave",T),T()}return{show(){h.style.display="flex"},hide(){h.style.display="none"},updateState:R,destroy(){C(),_(),z&&clearTimeout(z),h.remove()}}}var gs=r=>{let t=r.parentElement??document.body;return{getRoot:()=>r,getContainer:()=>t,resolveTarget:e=>F({getRoot:()=>r},e),destroy:()=>{r.remove()}}},fs=()=>({fit:()=>{},reset:()=>{},destroy:()=>{}}),ys=()=>({showBubble:()=>{},hideBubble:()=>{},destroy:()=>{}});var ct=new Set(["mpd","deck","meta","let","use","diagram","mermaid","config","assets","runtime","camera","overlay","navigation","performance","selectors","styles","scene","step","as","focus","pad","align","lock","id","do","assert","else","binding","priority","on","target","when","node","edge","subgraph","css","text","group","union","intersect","except","true","false","null","or","and","viewport","container","svg","engine","options","bounds","strategy","fallback","classes","spotlight","theme","keys","wheelZoom","dragPan","tapToAdvance","progressUI","startAt","click","dblclick","hover","mouseenter","mouseleave","wheel","scroll","key","timer","custom","any"]),Oe=new Set(["==","!=","<=",">=","<",">","+","-","*","/","%","!"]),dt=new Set(["{","}","(",")","[","]",":",";",",",".","=","$"]),ut=/^[+-]?(?:\d+(?:\.\d+)?|\.\d+)/,pt=/^\d+/,Le=/^[A-Za-z_][A-Za-z0-9_-]*/,mt=/^#[0-9A-Fa-f]{3}(?:[0-9A-Fa-f]{3})?/;function O(r,t){let{line:e,column:s,offset:n}=r;for(let o of t)n+=1,o===`
`?(e+=1,s=1):s+=1;return{line:e,column:s,offset:n}}function ht(r,t){return{start:r,end:t}}function qe(r){let t=[],e=[],s={offset:0,line:1,column:1},n=0,o=(i,a,c,l,p,d)=>{t.push({type:i,value:a,start:l,end:p,image:c,heredoc:d})};for(;n<r.length;){let i=r[n];if(i===" "||i==="	"||i==="\r"||i===`
`){let d=/^[ \t\r\n]+/.exec(r.slice(n));if(d){let u=d[0];s=O(s,u),n+=u.length;continue}}if(i==="#"||i==="/"&&r[n+1]==="/"){let d=/^(#|\/\/)[^\n\r]*/.exec(r.slice(n));if(d){let u=d[0];s=O(s,u),n+=u.length;continue}}if(r.startsWith("<<<",n)){let d=ft(r,n);if(d){let{image:u,tag:m,body:f}=d,D=s,A=O(s,u);o("heredoc",u,u,D,A,{tag:m,body:f}),s=A,n+=u.length;continue}}if(i==='"'||i==="'"){let{image:d,value:u}=gt(r,n,s,e),m=s,f=O(s,d);o("string",u,d,m,f),s=f,n+=d.length;continue}if(i==="#"){let d=mt.exec(r.slice(n));if(d){let u=d[0],m=s,f=O(s,u);o("color",u,u,m,f),s=f,n+=u.length;continue}}let a=ut.exec(r.slice(n));if(a){let d=a[0],u=r.slice(n+d.length),m=/^(ms|s|m)/.exec(u);if(m){let A=d+m[0],E=s,g=O(s,A);o("duration",A,A,E,g),s=g,n+=A.length;continue}if(u.startsWith("%")){let A=`${d}%`,E=s,g=O(s,A);o("percent",A,A,E,g),s=g,n+=A.length;continue}let f=s,D=O(s,d);o("number",d,d,f,D),s=D,n+=d.length;continue}let c=pt.exec(r.slice(n));if(c){let d=c[0],u=s,m=O(s,d);o("int",d,d,u,m),s=m,n+=d.length;continue}let l=Le.exec(r.slice(n));if(l){let d=l[0],u=s,m=O(s,d);d==="true"||d==="false"?o("boolean",d,d,u,m):d==="null"?o("null",d,d,u,m):ct.has(d)?o("keyword",d,d,u,m):o("identifier",d,d,u,m),s=m,n+=d.length;continue}let p=r.slice(n,n+2);if(Oe.has(p)){let d=s,u=O(s,p);o("operator",p,p,d,u),s=u,n+=p.length;continue}if(Oe.has(i)){let d=s,u=O(s,i);o("operator",i,i,d,u),s=u,n+=1;continue}if(dt.has(i)){let d=s,u=O(s,i);o("punct",i,i,d,u),s=u,n+=1;continue}e.push({message:`Unexpected character '${i}'.`,severity:"error",span:ht(s,O(s,i)),code:"lex/unexpected-character"}),s=O(s,i),n+=1}return t.push({type:"eof",value:"<eof>",start:s,end:s,image:""}),{tokens:t,diagnostics:e}}function gt(r,t,e,s){let n=r[t],o=t+1,i="";for(;o<r.length;){let c=r[o];if(c===n)return{image:r.slice(t,o+1),value:i};if(c==="\\"){let l=r[o+1];if(l==="n"){i+=`
`,o+=2;continue}if(l==="t"){i+="	",o+=2;continue}if(l==="r"){i+="\r",o+=2;continue}if(l===n){i+=n,o+=2;continue}i+=l??"",o+=2;continue}i+=c,o+=1}let a=r.slice(t,o);return s.push({message:"Unterminated string literal.",severity:"error",span:{start:e,end:O(e,a)},code:"lex/unterminated-string"}),{image:a,value:i}}function ft(r,t){let e=Le.exec(r.slice(t+3));if(!e)return null;let s=e[0],n=t+3+s.length;if(r[n]!==`
`)return null;let i=`
${s}>>>`,a=r.indexOf(i,n+1);if(a===-1)return null;let c=r.slice(t,a+i.length),l=r.slice(n+1,a);return{image:c,tag:s,body:l}}var Fe="1.0";function De(r){let t=qe(r),e=new Ge(r,t.tokens,t.diagnostics),s=e.parseProgram(),n=e.diagnostics;return s&&n.push(...yt(s)),{ast:s,diagnostics:n}}var Ee=class Ee{constructor(t,e,s){this.source=t;this.tokens=e;this.index=0;this.diagnostics=s.slice()}parseProgram(){let t=this.peek();if(!this.consumeKeyword("mpd"))return null;let e=this.parseVersion();if(!e)return null;let s=[];if(this.matchKeyword("deck")){let o=this.parseDeck();o&&s.push(o)}else for(;!this.isAtEnd();){let o=this.parseTopLevelItem();if(!o)break;s.push(o)}let n=this.previous();return{type:"Program",version:e.value,body:s,span:S(t,n)}}parseDeck(){let t=this.consumeKeyword("deck");if(!t)return null;let e=this.parseOptionalName(),{items:s,end:n}=this.parseBlock(()=>this.parseDeckItem());return{type:"Deck",name:e??void 0,items:s,span:S(t,n)}}parseTopLevelItem(){return this.parseDeckItemInternal(!0)}parseDeckItem(){return this.parseDeckItemInternal(!1)}parseDeckItemInternal(t){if(this.isAtEnd())return null;let e=this.peek();if(e.type==="keyword"){let s=Ee.KEYWORD_ITEM_PARSERS[e.value];if(s)return s(this)}return e.type==="identifier"?this.parseUnknownBlock():(t&&this.error(e,"top-level declaration"),null)}parseUnknownBlock(){let t=this.consume("identifier");if(!t)return null;let e=this.consumePunct("{");if(!e)return null;let s=1;for(;!this.isAtEnd()&&s>0;){let i=this.peek();i.type==="punct"&&i.value==="{"?s+=1:i.type==="punct"&&i.value==="}"&&(s-=1),this.advance()}let n=this.previous(),o=this.source.slice(e.start.offset,n.end.offset);return{type:"UnknownBlock",name:t.value,content:o,span:S(t,n)}}parseMetaDecl(){let t=this.consumeKeyword("meta");if(!t)return null;let e=[];for(this.consumePunct("{");!this.isAtEnd()&&!this.matchPunct("}");){let n=this.parseMetaEntry();n&&e.push(n),this.matchPunct(",")&&this.consumePunct(",")}let s=this.consumePunct("}")??this.previous();return{type:"MetaDecl",entries:e,span:S(t,s)}}parseMetaEntry(){let t=this.consume("identifier");if(!t)return null;this.consumePunct(":");let e=this.parseExpr();return e?{type:"MetaEntry",key:t.value,value:e,span:S(t,this.previous())}:null}parseConstDecl(){let t=this.consumeKeyword("let");if(!t)return null;let e=this.consume("identifier");if(!e)return null;this.consumePunct("=");let s=this.parseExpr();return this.consumePunct(";"),{type:"ConstDecl",name:e.value,value:s??this.emptyLiteral(e),span:S(t,this.previous())}}parsePluginDecl(){let t=this.consumeKeyword("use");if(!t)return null;let e=this.parseName(),s;return this.peek().type==="punct"&&this.peek().value==="{"&&(s=this.parseObjectExpr()),this.consumePunct(";"),{type:"PluginDecl",ref:e,options:s,span:S(t,this.previous())}}parseDiagramDecl(){let t=this.consumeKeyword("diagram");if(!t)return null;let e=this.parseName(),{items:s,end:n}=this.parseBlock(()=>this.parseDiagramItem());return{type:"DiagramDecl",id:e,items:s.filter(o=>o!==null),span:S(t,n)}}parseDiagramItem(){let t=this.peek();if(t.type==="keyword")switch(t.value){case"mermaid":return this.parseMermaidSourceDecl();case"config":return this.parseMermaidConfigDecl();case"assets":return this.parseDiagramAssetsDecl();case"meta":return this.parseMetaDecl();default:break}return null}parseMermaidSourceDecl(){let t=this.consumeKeyword("mermaid");if(!t)return null;let e=this.consume("heredoc");return!e||!e.heredoc?null:(this.consumePunct(";"),{type:"MermaidSourceDecl",source:e.heredoc.body,tag:e.heredoc.tag,span:S(t,this.previous())})}parseMermaidConfigDecl(){let t=this.consumeKeyword("config");if(!t)return null;let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"MermaidConfigDecl",config:e,span:S(t,this.previous())}}parseDiagramAssetsDecl(){let t=this.consumeKeyword("assets");if(!t)return null;let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"DiagramAssetsDecl",assets:e,span:S(t,this.previous())}}parseRuntimeDecl(){let t=this.consumeKeyword("runtime");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseRuntimeItem());return{type:"RuntimeDecl",items:e.filter(n=>n!==null),span:S(t,s)}}parseRuntimeItem(){let t=this.peek();if(t.type==="keyword")switch(t.value){case"camera":return this.parseCameraDecl();case"overlay":return this.parseOverlayDecl();case"navigation":return this.parseNavigationDecl();case"controls":return this.parseControlsDecl();case"performance":return this.parsePerformanceDecl();case"meta":return this.parseMetaDecl();default:break}return null}parseCameraDecl(){let t=this.consumeKeyword("camera");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseCameraItem());return{type:"CameraDecl",items:e.filter(n=>n!==null),span:S(t,s)}}parseCameraItem(){if(this.matchKeyword("engine")){let t=this.consumeKeyword("engine");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"CameraEngine",name:e,span:S(t,this.previous())}}if(this.matchKeyword("options")){let t=this.consumeKeyword("options");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"CameraOptions",options:e,span:S(t,this.previous())}}if(this.matchKeyword("bounds")){let t=this.consumeKeyword("bounds");this.consumePunct(":");let s=this.consume("keyword")?.value??"viewport";return this.consumePunct(";"),{type:"CameraBounds",bounds:s,span:S(t,this.previous())}}return null}parseOverlayDecl(){let t=this.consumeKeyword("overlay");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseOverlayItem());return{type:"OverlayDecl",items:e.filter(n=>n!==null),span:S(t,s)}}parseOverlayItem(){if(this.matchKeyword("engine")){let t=this.consumeKeyword("engine");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"OverlayEngine",name:e,span:S(t,this.previous())}}if(this.matchKeyword("options")){let t=this.consumeKeyword("options");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"OverlayOptions",options:e,span:S(t,this.previous())}}return null}parseNavigationDecl(){let t=this.consumeKeyword("navigation");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseNavigationItem());return{type:"NavigationDecl",items:e.filter(n=>n!==null),span:S(t,s)}}parseNavigationItem(){if(this.matchKeyword("keys")){let t=this.consumeKeyword("keys");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"NavigationKeys",options:e,span:S(t,this.previous())}}if(this.matchKeyword("wheelZoom")){let t=this.consumeKeyword("wheelZoom");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"NavigationWheelZoom",value:e,span:S(t,this.previous())}}if(this.matchKeyword("dragPan")){let t=this.consumeKeyword("dragPan");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"NavigationDragPan",value:e,span:S(t,this.previous())}}if(this.matchKeyword("tapToAdvance")){let t=this.consumeKeyword("tapToAdvance");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"NavigationTapToAdvance",value:e,span:S(t,this.previous())}}if(this.matchKeyword("progressUI")){let t=this.consumeKeyword("progressUI");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"NavigationProgressUI",value:e,span:S(t,this.previous())}}if(this.matchKeyword("startAt")){let t=this.consumeKeyword("startAt");this.consumePunct(":");let e=this.peek(),s=0;return e.type==="int"||e.type==="number"?(this.advance(),s=Number(e.value)):e.type==="string"?(this.advance(),s=e.value):this.error(e,"number or string"),this.consumePunct(";"),{type:"NavigationStartAt",value:s,span:S(t,this.previous())}}return null}parseControlsDecl(){let t=this.consumeKeyword("controls");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseControlsItem());return{type:"ControlsDecl",items:e.filter(n=>n!==null),span:S(t,s)}}parseControlsItem(){if(this.matchKeyword("mode")){let t=this.consumeKeyword("mode");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"ControlsMode",mode:e??{type:"Name",value:"floating",kind:"identifier",span:S(t,this.previous())},span:S(t,this.previous())}}if(this.matchKeyword("position")){let t=this.consumeKeyword("position");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"ControlsPosition",position:e??{type:"Name",value:"bottom-right",kind:"identifier",span:S(t,this.previous())},span:S(t,this.previous())}}if(this.matchKeyword("showPlayPause")){let t=this.consumeKeyword("showPlayPause");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsShowPlayPause",value:e,span:S(t,this.previous())}}if(this.matchKeyword("showPrevNext")){let t=this.consumeKeyword("showPrevNext");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsShowPrevNext",value:e,span:S(t,this.previous())}}if(this.matchKeyword("showZoomControls")){let t=this.consumeKeyword("showZoomControls");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsShowZoomControls",value:e,span:S(t,this.previous())}}if(this.matchKeyword("showStepIndicator")){let t=this.consumeKeyword("showStepIndicator");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsShowStepIndicator",value:e,span:S(t,this.previous())}}if(this.matchKeyword("autoHide")){let t=this.consumeKeyword("autoHide");this.consumePunct(":");let e=this.parseBoolean();return this.consumePunct(";"),{type:"ControlsAutoHide",value:e,span:S(t,this.previous())}}if(this.matchKeyword("offset")){let t=this.consumeKeyword("offset");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"ControlsOffset",offset:e,span:S(t,this.previous())}}return null}parsePerformanceDecl(){let t=this.consumeKeyword("performance");if(!t)return null;let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"PerformanceDecl",options:e,span:S(t,this.previous())}}parseSelectorsDecl(){let t=this.consumeKeyword("selectors");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseSelectorsItem());return{type:"SelectorsDecl",items:e.filter(n=>n!==null),span:S(t,s)}}parseSelectorsItem(){if(this.matchKeyword("strategy")){let t=this.consumeKeyword("strategy");this.consumePunct(":");let s=this.consume("keyword")?.value??"css";return this.consumePunct(";"),{type:"SelectorsStrategy",strategy:s,span:S(t,this.previous())}}if(this.matchKeyword("fallback")){let t=this.consumeKeyword("fallback");this.consumePunct(":");let e=this.parseArrayExpr();return this.consumePunct(";"),{type:"SelectorsFallback",fallback:e,span:S(t,this.previous())}}if(this.matchKeyword("node")){let t=this.consumeKeyword("node");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"SelectorsNode",spec:e,span:S(t,this.previous())}}if(this.matchKeyword("edge")){let t=this.consumeKeyword("edge");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"SelectorsEdge",spec:e,span:S(t,this.previous())}}if(this.matchKeyword("subgraph")){let t=this.consumeKeyword("subgraph");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"SelectorsSubgraph",spec:e,span:S(t,this.previous())}}return this.matchKeyword("meta")?this.parseMetaDecl():null}parseStylesDecl(){let t=this.consumeKeyword("styles");if(!t)return null;let{items:e,end:s}=this.parseBlock(()=>this.parseStylesItem());return{type:"StylesDecl",items:e.filter(n=>n!==null),span:S(t,s)}}parseStylesItem(){if(this.matchKeyword("classes")){let t=this.consumeKeyword("classes");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"StylesClasses",classes:e,span:S(t,this.previous())}}if(this.matchKeyword("spotlight")){let t=this.consumeKeyword("spotlight");this.consumePunct(":");let e=this.parseObjectExpr();return this.consumePunct(";"),{type:"StylesSpotlight",spotlight:e,span:S(t,this.previous())}}if(this.matchKeyword("theme")){let t=this.consumeKeyword("theme");this.consumePunct(":");let e=this.parseName();return this.consumePunct(";"),{type:"StylesTheme",theme:e,span:S(t,this.previous())}}return this.matchKeyword("meta")?this.parseMetaDecl():null}parseSceneDecl(){let t=this.consumeKeyword("scene");if(!t)return null;let e=this.parseName(),s;this.matchKeyword("diagram")&&(this.consumeKeyword("diagram"),s=this.parseName());let{items:n,end:o}=this.parseBlock(()=>this.parseSceneItem());return{type:"SceneDecl",name:e,diagram:s,items:n.filter(i=>i!==null),span:S(t,o)}}parseSceneItem(){let t=this.peek();if(t.type==="keyword")switch(t.value){case"step":return this.parseStepDecl();case"binding":return this.parseBindingDecl();case"meta":return this.parseMetaDecl();case"let":return this.parseConstDecl();default:break}return null}parseStepDecl(){let t=this.consumeKeyword("step");if(!t)return null;let e=this.parseName(),s;this.matchKeyword("as")&&(this.consumeKeyword("as"),s=this.consume("identifier")?.value);let{items:n,end:o}=this.parseBlock(()=>this.parseStepStmt());return{type:"StepDecl",name:e,alias:s,statements:n.filter(i=>i!==null),span:S(t,o)}}parseStepStmt(){let t=this.peek();if(t.type==="keyword")switch(t.value){case"focus":return this.parseFocusStmt();case"do":return this.parseDoStmt();case"let":return this.parseLetStmt();case"assert":return this.parseAssertStmt();case"meta":return this.parseMetaDecl();default:break}if(t.type==="identifier"||t.type==="keyword"){if(t.type==="keyword"&&(t.value==="focus"||t.value==="let"||t.value==="assert"||t.value==="meta"))return null;let e=this.parseActionCall();if(e)return{type:"DoStmt",action:e,span:e.span}}return null}parseFocusStmt(){let t=this.consumeKeyword("focus");if(!t)return null;let e=this.parseTargetExpr(),s={};for(;;){if(this.matchKeyword("pad")){this.consumeKeyword("pad");let n=this.parseNumber();s.pad=n;continue}if(this.matchKeyword("align")){this.consumeKeyword("align");let n=this.consume("keyword");s.align=n?.value??"center";continue}if(this.matchKeyword("lock")){this.consumeKeyword("lock");let n=this.consume("keyword");s.lock=n?.value??"none";continue}if(this.matchKeyword("id")){this.consumeKeyword("id");let n=this.consume("identifier");n&&(s.id=n.value);continue}break}return this.consumePunct(";"),{type:"FocusStmt",target:e??this.emptyTarget(t),options:s,span:S(t,this.previous())}}parseDoStmt(){let t=this.consumeKeyword("do");if(!t)return null;let e=this.parseActionCall();return this.consumePunct(";"),{type:"DoStmt",action:e??this.emptyAction(t),span:S(t,this.previous())}}parseLetStmt(){let t=this.consumeKeyword("let");if(!t)return null;let e=this.consume("identifier");this.consumePunct("=");let s=this.parseExpr();return this.consumePunct(";"),{type:"LetStmt",name:e?.value??"",value:s??this.emptyLiteral(t),span:S(t,this.previous())}}parseAssertStmt(){let t=this.consumeKeyword("assert");if(!t)return null;let e=this.parseExpr(),s;return this.matchKeyword("else")&&(this.consumeKeyword("else"),s=this.consume("string")?.value),this.consumePunct(";"),{type:"AssertStmt",condition:e??this.emptyLiteral(t),message:s,span:S(t,this.previous())}}parseBindingDecl(){let t=this.consumeKeyword("binding");if(!t)return null;let e;(this.peek().type==="identifier"||this.peek().type==="string")&&(e=this.parseName());let s;if(this.matchKeyword("priority")){this.consumeKeyword("priority");let i=this.consume("int");s=i?Number(i.value):void 0,this.consumePunct(";")}let{items:n,end:o}=this.parseBlock(()=>this.parseBindingRule());return{type:"BindingDecl",name:e,priority:s,rules:n.filter(i=>i!==null),span:S(t,o)}}parseBindingRule(){let t=this.consumeKeyword("on");if(!t)return null;let e=this.parseEventSpec(),s;this.matchKeyword("target")&&(this.consumeKeyword("target"),this.matchKeyword("any")?(this.consumeKeyword("any"),s="any"):s=this.parseTargetExpr()??void 0);let n;this.matchKeyword("when")&&(this.consumeKeyword("when"),n=this.parseExpr()??void 0);let{items:o,end:i}=this.parseBlock(()=>this.parseBindingStmt());return{type:"BindingRule",event:e??this.emptyEvent(t),target:s,when:n,statements:o.filter(a=>a!==null),span:S(t,i)}}parseBindingStmt(){return this.matchKeyword("do")?this.parseDoStmt():this.matchKeyword("let")?this.parseLetStmt():this.matchKeyword("assert")?this.parseAssertStmt():null}parseEventSpec(){let t=this.consume("keyword");if(!t)return null;if(t.value==="key")return{type:"EventSpec",kind:"key",value:this.consume("string")?.value,span:S(t,this.previous())};if(t.value==="timer"){let e=this.consume("duration");return{type:"EventSpec",kind:"timer",value:e?He(e.value):void 0,span:S(t,this.previous())}}return t.value==="custom"?{type:"EventSpec",kind:"custom",value:this.parseName().value,span:S(t,this.previous())}:{type:"EventSpec",kind:t.value,span:S(t,t)}}parseActionCall(){let t=this.peek(),e=[],s=this.consumeNamePart();if(!s)return null;for(e.push(s.value);!this.isAtEnd();){if(this.matchPunct(".")){this.consumePunct(".");let i=this.consumeNamePart();i&&e.push(i.value);continue}let o=this.peek();if(o.type==="identifier"||o.type==="keyword"){let i=this.peekNext();if(i.type==="punct"&&i.value==="("){let c=this.consumeNamePart();c&&e.push(c.value);break}let a=this.consumeNamePart();a&&e.push(a.value);continue}break}this.consumePunct("(");let n=[];if(!this.matchPunct(")"))do{let o=this.parseActionArg();o&&n.push(o)}while(this.matchPunct(",")&&this.advance());return this.consumePunct(")"),{type:"ActionCall",name:e.join(" "),args:n,span:S(t,this.previous())}}parseActionArg(){let t=this.peek(),e=this.peek();if((e.type==="identifier"||e.type==="keyword")&&this.peekNext().type==="punct"&&this.peekNext().value===":"){let n=this.advance();this.consumePunct(":");let o=this.parseExpr();return{type:"ActionArg",key:n?.value,value:o??this.emptyLiteral(t),span:S(t,this.previous())}}return{type:"ActionArg",value:this.parseExpr()??this.emptyLiteral(t),span:S(t,this.previous())}}parseExpr(){return this.parseOrExpr()}parseOrExpr(){let t=this.parseAndExpr();for(;this.matchKeyword("or");){let e=this.consumeKeyword("or"),s=this.parseAndExpr();t={type:"BinaryExpr",operator:"or",left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:S(e,this.previous())}}return t}parseAndExpr(){let t=this.parseEqExpr();for(;this.matchKeyword("and");){let e=this.consumeKeyword("and"),s=this.parseEqExpr();t={type:"BinaryExpr",operator:"and",left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:S(e,this.previous())}}return t}parseEqExpr(){let t=this.parseRelExpr();for(;this.matchOperator("==")||this.matchOperator("!=");){let e=this.consume("operator"),s=this.parseRelExpr();t={type:"BinaryExpr",operator:e.value,left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:S(e,this.previous())}}return t}parseRelExpr(){let t=this.parseAddExpr();for(;this.matchOperator("<")||this.matchOperator("<=")||this.matchOperator(">")||this.matchOperator(">=");){let e=this.consume("operator"),s=this.parseAddExpr();t={type:"BinaryExpr",operator:e.value,left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:S(e,this.previous())}}return t}parseAddExpr(){let t=this.parseMulExpr();for(;this.matchOperator("+")||this.matchOperator("-");){let e=this.consume("operator"),s=this.parseMulExpr();t={type:"BinaryExpr",operator:e.value,left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:S(e,this.previous())}}return t}parseMulExpr(){let t=this.parseUnaryExpr();for(;this.matchOperator("*")||this.matchOperator("/")||this.matchOperator("%");){let e=this.consume("operator"),s=this.parseUnaryExpr();t={type:"BinaryExpr",operator:e.value,left:t??this.emptyLiteral(e),right:s??this.emptyLiteral(e),span:S(e,this.previous())}}return t}parseUnaryExpr(){if(this.matchOperator("!")||this.matchOperator("-")){let t=this.consume("operator"),e=this.parseUnaryExpr();return{type:"UnaryExpr",operator:t.value,argument:e??this.emptyLiteral(t),span:S(t,this.previous())}}return this.parsePrimaryExpr()}parsePrimaryExpr(){let t=this.peek();if(t.type==="number"||t.type==="int"||t.type==="duration"||t.type==="percent"||t.type==="boolean"||t.type==="null"||t.type==="string"||t.type==="color")return this.advance(),this.literalFromToken(t);if(t.type==="punct"&&t.value==="{")return this.parseObjectExpr();if(t.type==="punct"&&t.value==="[")return this.parseArrayExpr();if(t.type==="punct"&&t.value==="("){let e=this.consumePunct("("),s=this.parseExpr();return this.consumePunct(")"),s?{...s,span:S(e,this.previous())}:null}return t.type==="punct"&&t.value==="$"?this.parseVarRef():this.isTargetKeyword(t)?this.parseTargetExpr():t.type==="identifier"?this.parseCallExpr():null}parseVarRef(){let t=this.consumePunct("$"),e=[],s=this.consume("identifier");for(s&&e.push(s.value);this.matchPunct(".");){this.consumePunct(".");let n=this.consume("identifier");n&&e.push(n.value)}return{type:"VarRef",path:e,span:S(t,this.previous())}}parseCallExpr(){let t=this.peek(),e=this.consume("identifier");if(!e)return null;this.consumePunct("(");let s=[];if(!this.matchPunct(")"))do{let n=this.parseActionArg();n&&s.push(n)}while(this.matchPunct(",")&&this.advance());return this.consumePunct(")"),{type:"CallExpr",name:e.value,args:s,span:S(t,this.previous())}}parseObjectExpr(){let t=this.consumePunct("{"),e=[];if(!this.matchPunct("}"))do{let s=this.peek(),n=s.type==="identifier"||s.type==="keyword"?this.advance():this.consume("string");if(!n)break;this.consumePunct(":");let o=this.parseExpr(),i=n.type==="string"?n.value.slice(1,-1):n.value;e.push({type:"ObjectEntry",key:i,value:o??this.emptyLiteral(n),span:S(n,this.previous())})}while(this.matchPunct(",")&&this.advance());return this.consumePunct("}"),{type:"ObjectExpr",entries:e,span:S(t,this.previous())}}parseArrayExpr(){let t=this.consumePunct("["),e=[];if(!this.matchPunct("]"))do{let s=this.parseExpr();s&&e.push(s)}while(this.matchPunct(",")&&this.advance());return this.consumePunct("]"),{type:"ArrayExpr",items:e,span:S(t,this.previous())}}parseTargetExpr(){let t=this.peek();if(!this.isTargetKeyword(t))return this.error(t,"target expression"),null;let e=this.consume("keyword");if(!e)return null;switch(e.value){case"node":return this.parseTargetUnary(e,"TargetNode",()=>this.parseNodeRef());case"edge":return this.parseTargetUnary(e,"TargetEdge",()=>this.parseEdgeRef());case"subgraph":return this.parseTargetUnary(e,"TargetSubgraph",()=>this.parseSubgraphRef());case"css":return this.parseTargetString(e,"TargetCss");case"id":return this.parseTargetString(e,"TargetId");case"text":return this.parseTargetString(e,"TargetText");case"group":return this.parseTargetList(e,"TargetGroup");case"union":return this.parseTargetList(e,"TargetUnion");case"intersect":return this.parseTargetList(e,"TargetIntersect");case"except":return this.parseTargetExcept(e);default:return null}}parseTargetUnary(t,e,s){this.consumePunct("(");let n=s();return this.consumePunct(")"),{type:e,ref:n,span:S(t,this.previous())}}parseTargetString(t,e){this.consumePunct("(");let s=this.consume("string");this.consumePunct(")");let n=s?.value??"";return e==="TargetCss"?{type:"TargetCss",selector:n,span:S(t,this.previous())}:e==="TargetId"?{type:"TargetId",id:n,span:S(t,this.previous())}:{type:"TargetText",text:n,span:S(t,this.previous())}}parseTargetList(t,e){this.consumePunct("(");let s=[];if(!this.matchPunct(")"))do{let o=this.parseTargetExpr();o&&s.push(o)}while(this.matchPunct(",")&&this.advance());return this.consumePunct(")"),{type:e,targets:s,span:S(t,this.previous())}}parseTargetExcept(t){this.consumePunct("(");let e=this.parseTargetExpr();this.consumePunct(",");let s=this.parseTargetExpr();return this.consumePunct(")"),{type:"TargetExcept",left:e??this.emptyTarget(t),right:s??this.emptyTarget(t),span:S(t,this.previous())}}parseNodeRef(){if(this.matchOperator("*"))return this.consume("operator"),"*";if(this.peek().type==="string"){let e=this.consume("string");return this.makeName(e)}let t=this.consume("identifier");return t?this.makeName(t):"*"}parseEdgeRef(){let t=this.peek(),e=this.parseNodeRef();if(this.matchPunct(",")){this.consumePunct(",");let s=this.parseNodeRef();return{from:e,to:s}}return e==="*"?{type:"Name",value:"*",kind:"identifier",span:S(t,this.previous())}:e}parseSubgraphRef(){if(this.matchOperator("*"))return this.consume("operator"),"*";if(this.peek().type==="string"){let e=this.consume("string");return this.makeName(e)}let t=this.consume("identifier");return t?this.makeName(t):"*"}parseQualifiedName(){let t=[],e=this.consumeNamePart();for(e&&t.push(e.value);this.matchPunct(".");){this.consumePunct(".");let s=this.consumeNamePart();s&&t.push(s.value)}return t.join(".")}consumeNamePart(){let t=this.peek();return t.type==="identifier"||t.type==="keyword"?this.advance():(this.error(t,"identifier"),null)}parseName(){let t=this.peek();if(t.type==="string")return this.advance(),{type:"Name",value:t.value,kind:"string",span:S(t,t)};let e=this.consume("identifier");return{type:"Name",value:e?.value??"",kind:"identifier",span:S(e??t,this.previous())}}parseOptionalName(){let t=this.peek();return t.type==="identifier"||t.type==="string"?this.parseName():null}parseNumber(){let t=this.consume("number")??this.consume("int");return t?Number(t.value):0}parseBoolean(){let t=this.consume("boolean");return t?t.value==="true":!1}parseVersion(){let t=this.consume("number")??this.consume("int");if(!t)return null;let e=[t.value];for(;this.matchPunct(".");){this.consumePunct(".");let s=this.consume("number")??this.consume("int");if(!s)break;e.push(s.value)}return{value:e.join("."),end:this.previous()}}parseBlock(t){let e=[],s=this.consumePunct("{");for(;!this.isAtEnd()&&!this.matchPunct("}");){let o=t();o?e.push(o):this.advance()}let n=this.consumePunct("}")??this.previous();return{items:e,end:n??s}}literalFromToken(t){let e=t.value;return t.type==="boolean"?{type:"Literal",literalType:"boolean",value:t.value==="true",raw:e,span:S(t,t)}:t.type==="null"?{type:"Literal",literalType:"null",value:null,raw:e,span:S(t,t)}:t.type==="string"?{type:"Literal",literalType:"string",value:t.value,raw:e,span:S(t,t)}:t.type==="color"?{type:"Literal",literalType:"color",value:t.value,raw:e,span:S(t,t)}:t.type==="duration"?{type:"Literal",literalType:"duration",value:He(t.value),raw:e,span:S(t,t)}:t.type==="percent"?{type:"Literal",literalType:"percent",value:Number(t.value.replace("%","")),raw:e,span:S(t,t)}:{type:"Literal",literalType:t.type==="int"?"int":"number",value:Number(t.value),raw:e,span:S(t,t)}}emptyLiteral(t){return{type:"Literal",literalType:"null",value:null,raw:"null",span:S(t,t)}}emptyTarget(t){return{type:"TargetNode",ref:"*",span:S(t,t)}}emptyAction(t){return{type:"ActionCall",name:"",args:[],span:S(t,t)}}emptyEvent(t){return{type:"EventSpec",kind:"click",span:S(t,t)}}makeName(t){return{type:"Name",value:t.value,kind:t.type==="string"?"string":"identifier",span:S(t,t)}}isTargetKeyword(t){return t.type==="keyword"&&["node","edge","subgraph","css","id","text","group","union","intersect","except"].includes(t.value)}matchKeyword(t){let e=this.peek();return e.type==="keyword"&&e.value===t}matchOperator(t){let e=this.peek();return e.type==="operator"&&e.value===t}matchPunct(t){let e=this.peek();return e.type==="punct"&&e.value===t}consumeKeyword(t){let e=this.peek();return e.type==="keyword"&&e.value===t?this.advance():(this.error(e,`keyword '${t}'`),null)}consumePunct(t){let e=this.peek();return e.type==="punct"&&e.value===t?this.advance():(this.error(e,`symbol '${t}'`),null)}consume(t){let e=this.peek();return e.type===t?this.advance():(this.error(e,t),null)}error(t,e){if(t.type==="eof"){this.diagnostics.push({message:`Unexpected end of input, expected ${e}.`,severity:"error",span:S(t,t),code:"parse/unexpected-eof"});return}this.diagnostics.push({message:`Unexpected '${t.image||t.value}', expected ${e}.`,severity:"error",span:S(t,t),code:"parse/unexpected-token"})}advance(){return this.isAtEnd()||(this.index+=1),this.tokens[this.index-1]}peek(){return this.tokens[this.index]}peekNext(){return this.tokens[this.index+1]}previous(){return this.tokens[Math.max(0,this.index-1)]}isAtEnd(){return this.peek().type==="eof"}};Ee.KEYWORD_ITEM_PARSERS={diagram:t=>t.parseDiagramDecl(),runtime:t=>t.parseRuntimeDecl(),selectors:t=>t.parseSelectorsDecl(),styles:t=>t.parseStylesDecl(),let:t=>t.parseConstDecl(),scene:t=>t.parseSceneDecl(),binding:t=>t.parseBindingDecl(),use:t=>t.parsePluginDecl(),meta:t=>t.parseMetaDecl()};var Ge=Ee;function S(r,t){return{start:r.start,end:t.end}}function He(r){return r.endsWith("ms")?Number(r.replace("ms","")):r.endsWith("s")?Number(r.replace("s",""))*1e3:r.endsWith("m")?Number(r.replace("m",""))*6e4:Number(r)}function yt(r){let t=[];r.version!==Fe&&r.version!=="1"&&t.push({message:`MPD version '${r.version}' differs from supported version ${Fe}.`,severity:"warning",span:r.span,code:"validate/version-mismatch"});for(let n of r.body){if(n.type==="SceneDecl"){let o=new Set;for(let i of n.items)if(i.type==="StepDecl"){let a=i.name.value;o.has(a)?t.push({message:`Duplicate step name '${a}' in scene '${n.name.value}'.`,severity:"error",span:i.span,code:"validate/duplicate-step"}):o.add(a)}}n.type==="UnknownBlock"&&t.push({message:`Unknown block '${n.name}'.`,severity:"warning",span:n.span,code:"validate/unknown-block"})}let e=n=>{switch(n.type){case"TargetEdge":{let o=n.ref;typeof o=="object"&&(o.from==="*"||o.to==="*")&&t.push({message:"Edge target cannot use '*' in edge tuple.",severity:"error",span:n.span,code:"validate/malformed-target"});break}case"TargetCss":case"TargetId":case"TargetText":{(n.selector??n.id??n.text??"")||t.push({message:"Target string cannot be empty.",severity:"error",span:n.span,code:"validate/malformed-target"});break}case"TargetGroup":case"TargetUnion":case"TargetIntersect":n.targets.forEach(e);break;case"TargetExcept":e(n.left),e(n.right);break;case"BinaryExpr":e(n.left),e(n.right);break;case"UnaryExpr":e(n.argument);break;case"ObjectExpr":n.entries.forEach(o=>e(o.value));break;case"ArrayExpr":n.items.forEach(e);break;case"CallExpr":n.args.forEach(o=>e(o.value));break;case"Literal":case"VarRef":case"TargetNode":case"TargetSubgraph":break;default:break}},s=n=>{if(!n||typeof n!="object")return;switch(n.type){case"StepDecl":{n.statements.forEach(s);break}case"SceneDecl":{n.items.forEach(s);break}case"FocusStmt":e(n.target);break;case"LetStmt":e(n.value);break;case"AssertStmt":e(n.condition);break;case"DoStmt":n.action.args.forEach(i=>e(i.value));break;case"BindingDecl":n.rules.forEach(s);break;case"BindingRule":{let i=n;i.when&&e(i.when),i.statements.forEach(s);break}case"ConstDecl":e(n.value);break;case"MetaDecl":n.entries.forEach(i=>e(i.value));break;default:break}};return r.body.forEach(s),t}function St(r){return r.length?r.map(t=>{let e=t.span?`(${t.span.start.line}:${t.span.start.column})`:"",s=t.code?` [${t.code}]`:"";return`${t.severity.toUpperCase()}: ${t.message} ${e}${s}`.trim()}).join(`
`):"No diagnostics."}function Te(r){let t=[];return r.querySelectorAll("[data-finsteps]").forEach(s=>{let n=xt(s);n&&t.push(n)}),t}function xt(r){let t=r.querySelector(".finsteps-mermaid, pre.mermaid, .mermaid");if(!t)return console.warn("[finsteps] No mermaid element found in",r),null;let e=t.textContent?.trim();if(!e)return console.warn("[finsteps] Empty mermaid text in",r),null;let s=Et(r);if(!s)return console.warn("[finsteps] No valid AST configuration found in",r),null;let n=bt(r.dataset.finstepsControls),o=wt(r.dataset.finstepsControlsSize),i=vt(r.dataset.finstepsControlsTheme);return{element:r,mermaidElement:t,mermaidText:e,ast:s,controlsPosition:n,controlsSize:o,controlsTheme:i}}function Et(r){let t=r.querySelector('script[type="application/finsteps+json"], script[type="application/json"]');if(t?.textContent)try{let s=JSON.parse(t.textContent);if(s.steps&&Array.isArray(s.steps))return{steps:s.steps,bindings:s.bindings};if(s.ast?.steps&&Array.isArray(s.ast.steps))return s.ast}catch(s){console.warn("[finsteps] Failed to parse AST from script tag:",s)}let e=r.dataset.finstepsAst;if(e)try{let s=JSON.parse(e);if(s.steps&&Array.isArray(s.steps))return{steps:s.steps,bindings:s.bindings}}catch(s){console.warn("[finsteps] Failed to parse AST from data attribute:",s)}return null}function bt(r){return["bottom-right","bottom-left","top-right","top-left","bottom-center"].includes(r||"")?r:void 0}function wt(r){return["compact","normal","large"].includes(r||"")?r:void 0}function vt(r){return["dark","light","auto"].includes(r||"")?r:void 0}function ke(r){let{reveal:t,slideElement:e,controller:s}=r,n=e.querySelectorAll("[data-finsteps-step]");if(n.length===0)return{destroy:()=>{}};let o=new Map;n.forEach((c,l)=>{let p=c.dataset.finstepsStep;if(p){let d=parseInt(p,10);isNaN(d)||o.set(l,d)}});let i=c=>{if(!c.fragment||!e.contains(c.fragment))return;let l=c.fragment.dataset.finstepsStep;if(l){let p=parseInt(l,10);isNaN(p)||s.goto(p).catch(()=>{})}},a=c=>{if(!c.fragment||!e.contains(c.fragment))return;let l=c.fragment.dataset.finstepsStep;if(l){let p=parseInt(l,10);!isNaN(p)&&p>0&&s.goto(p-1).catch(()=>{})}};return t.on("fragmentshown",i),t.on("fragmenthidden",a),{destroy(){t.off("fragmentshown",i),t.off("fragmenthidden",a)}}}function Ke(r={}){let{defaultControlsPosition:t="bottom-right",defaultControlsSize:e="compact",defaultControlsTheme:s="auto",showControls:n=!0,syncWithFragments:o=!1,resetOnSlideChange:i=!0}=r,a=new Map,c=new Map,l=null,p=null;async function d(A){try{let E=A.mermaidElement,g=await Ce({mountEl:E,mermaidText:A.mermaidText,ast:A.ast}),x;return n&&(x=ze({controller:g,position:A.controlsPosition??t,size:A.controlsSize??e,theme:A.controlsTheme??s,showZoomControls:!1,showReset:!0,offset:{x:10,y:10}}),l&&l.getCurrentSlide()!==u(A.element)&&x.hide()),{element:A.element,controller:g,controlsHandle:x}}catch(E){return console.error("[finsteps] Failed to initialize diagram:",E),null}}function u(A){return A.closest("section")}function m(A){let E=A.controller.getDeps?.();E?.overlay?.clear?E.overlay.clear():E?.overlay?.hideBubble&&E.overlay.hideBubble()}function f(A){let{currentSlide:E,previousSlide:g}=A;if(p=E,g)for(let[x,h]of a)g.contains(x)&&(h.controlsHandle?.hide(),m(h));for(let[x,h]of a)E.contains(x)&&(h.controlsHandle?.show(),i&&h.controller.reset().catch(()=>{}))}function D(A){if(!(!o||!l)){for(let[E,g]of a)if(A.contains(E)){if(c.has(E))continue;let x=ke({reveal:l,slideElement:A,controller:g.controller});c.set(E,x)}}}return{id:"finsteps",async init(A){l=A;let E=document.querySelector(".reveal .slides");if(!E){console.warn("[finsteps] No Reveal.js slides container found");return}let g=Te(E);for(let x of g){let h=await d(x);h&&a.set(x.element,h)}if(l.on("slidechanged",f),o){l.on("slidechanged",h=>{D(h.currentSlide)});let x=l.getCurrentSlide();x&&D(x)}if(p=l.getCurrentSlide(),p)for(let[x,h]of a)p.contains(x)?h.controlsHandle?.show():m(h)},destroy(){for(let A of c.values())A.destroy();c.clear();for(let A of a.values())A.controlsHandle?.destroy(),A.controller.destroy();a.clear(),l=null,p=null}}}var At=r=>{if(r.ast)return r.ast;if(r.mpdText&&r.options?.parseMpd)return r.options.parseMpd(r.mpdText);throw new q("presentMermaid requires ast or mpdText with parseMpd","MPF_INVALID_PRESENT_OPTIONS",{hasAst:!!r.ast,hasMpdText:!!r.mpdText,hasParseMpd:!!r.options?.parseMpd})},Ce=async r=>{let t=At(r),s=await(r.options?.diagram??$e()).render({mountEl:r.mountEl,mermaidText:r.mermaidText}),n=r.options?.camera??Pe(s),o=r.options?.overlay??Me(),i=new xe({diagram:s,camera:n,overlay:o,ast:t,actionHandlers:r.options?.actionHandlers,errorPolicy:r.options?.errorPolicy??"haltOnError",hooks:r.options?.hooks});return await i.init({diagram:s}),r.options?.controls&&r.options.controls.updateState(i.getState()),i};function Fs(r){let t=De(r),e=t.diagnostics.filter(o=>o.severity==="error"),s=t.diagnostics.filter(o=>o.severity==="warning");return{valid:t.ast!==null&&e.length===0,ast:t.ast,errors:e,warnings:s}}var Hs=Ce;export{Z as ActionError,Ke as FinstepsRevealPlugin,q as MPFError,Ae as ParseError,it as SIZE_PRESETS,ot as THEME_PRESETS,Pe as createBasicCameraHandle,Me as createBasicOverlayHandle,ze as createFloatingControls,$e as createMermaidDiagramAdapter,fs as createMockCameraHandle,gs as createMockDiagramHandle,ys as createMockOverlayHandle,Hs as default,St as formatDiagnostics,De as parseMPD,Ce as presentMermaid,Fs as validateMPD};
